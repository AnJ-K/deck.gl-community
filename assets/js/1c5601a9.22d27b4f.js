"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[7061],{8740:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>G,contentTitle:()=>N,default:()=>W,frontMatter:()=>O,metadata:()=>q,toc:()=>U});var n=o(4848),i=o(8453),s=o(6540),r=o(8478),a=o(1175),l=o(1198),d=o(5800),c=o(586),p=o(5605),h=o(6338),g=o(2731);const u=JSON.parse('{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"marker-color":"#ff0000","marker-size":"medium","marker-symbol":""},"geometry":{"type":"Point","coordinates":[-122.44477272033691,37.79906910652822]}},{"type":"Feature","properties":{"marker-color":"#0000ff","marker-size":"large","marker-symbol":""},"geometry":{"type":"Point","coordinates":[-122.42451667785645,37.8019175085504]}},{"type":"Feature","properties":{"marker-size":"small"},"geometry":{"type":"MultiPoint","coordinates":[[-122.46923446655273,37.803273851858656],[-122.46957778930665,37.79934038764369],[-122.46434211730958,37.80313821864869],[-122.46451377868652,37.8001542250124]]}},{"type":"Feature","properties":{"stroke":"#ff0000","stroke-width":10,"stroke-opacity":1},"geometry":{"type":"LineString","coordinates":[[-122.40880966186523,37.783536601521924],[-122.43893623352051,37.779669924659004],[-122.43515968322752,37.7624370109886],[-122.42348670959471,37.77180027337861],[-122.4250316619873,37.778584505321376],[-122.42314338684082,37.778652344496926],[-122.42357254028322,37.77987343901049],[-122.41198539733887,37.78109451335266]]}},{"type":"Feature","properties":{"stroke":"#408000","stroke-width":2,"stroke-opacity":1},"geometry":{"type":"MultiLineString","coordinates":[[[-122.39670753479004,37.7947284731866],[-122.44726181030273,37.788352705583755]],[[-122.44709014892577,37.78733524495977],[-122.39670753479004,37.79371110035437]]]}},{"type":"Feature","properties":{"stroke":"#800000","stroke-width":3,"stroke-opacity":0.5,"fill":"#ffff66","fill-opacity":1},"geometry":{"type":"Polygon","coordinates":[[[-122.51129150390625,37.771461045439764],[-122.46588706970215,37.77342854582093],[-122.45464324951172,37.77471756940714],[-122.45284080505371,37.76644028998291],[-122.45747566223145,37.765761783370465],[-122.45902061462401,37.76644028998291],[-122.5100040435791,37.763997637045456],[-122.51026153564452,37.767254489700846],[-122.51129150390625,37.771461045439764]],[[-122.50802993774414,37.770239811973674],[-122.45644569396974,37.77302148107203],[-122.45515823364258,37.76759373693769],[-122.45884895324706,37.76847577247014],[-122.50811576843262,37.765693932366865],[-122.50802993774414,37.770239811973674]]]}},{"type":"Feature","properties":{"stroke":"#004080","stroke-width":2,"stroke-opacity":1,"fill":"#66ff66","fill-opacity":0.5},"geometry":{"type":"MultiPolygon","coordinates":[[[[-122.4717664718628,37.73094604426975],[-122.47253894805908,37.71706268973759],[-122.47116565704346,37.71275119199666],[-122.47017860412596,37.71275119199666],[-122.46803283691405,37.712411693330296],[-122.46524333953857,37.712445643266925],[-122.46339797973633,37.71146108878938],[-122.46026515960692,37.71037466866717],[-122.45494365692137,37.7111215842122],[-122.44975090026854,37.71533133102705],[-122.4481201171875,37.72123815310796],[-122.45236873626708,37.723037263958275],[-122.4605655670166,37.72480238685191],[-122.46584415435791,37.72670324138648],[-122.46803283691405,37.72863798965106],[-122.468204498291,37.72938472107615],[-122.4717664718628,37.73094604426975]]],[[[-122.435245513916,37.73155698786267],[-122.42983818054199,37.73237157147889],[-122.42563247680664,37.73155698786267],[-122.42048263549805,37.73182851673044],[-122.41559028625487,37.732100044602525],[-122.40846633911133,37.73488314788311],[-122.40752220153807,37.73732676207096],[-122.40769386291502,37.74173863896063],[-122.4052906036377,37.74920429313147],[-122.4085521697998,37.748322027789115],[-122.42511749267578,37.74777909004261],[-122.42374420166016,37.73977029560411],[-122.42683410644533,37.73603708685575],[-122.435245513916,37.73155698786267]]],[[[-122.49532699584961,37.75347973770911],[-122.493953704834,37.73379707124429],[-122.4752426147461,37.73488314788311],[-122.47644424438477,37.75429408009598],[-122.49532699584961,37.75347973770911]]]]}}]}');var m=o(3724);const f={toolboxItem:{flexBasis:"50%"}},y=m.Ay.div.withConfig({displayName:"toolbox__Toolbox",componentId:"sc-1omy744-0"})(["position:absolute;top:0px;left:0px;color:#f0f0f0;padding:0;width:230px;height:100%;font-family:Arial,Helvetica,sans-serif;font-size:16px;overflow:auto;z-index:30;"]),x=e=>(0,n.jsx)("div",{children:e.children}),C=e=>(0,n.jsx)("div",{style:f.toolboxItem,children:e.children}),v=m.Ay.div.withConfig({displayName:"toolbox__ToolboxTitle",componentId:"sc-1omy744-1"})(["background:rgba(39,45,59,0.8);font-size:16px;height:44px;display:flex;align-items:center;padding:0px 8px;"]),P=e=>e.selected?"rgba(30, 84, 183, 0.8)":"rgba(23, 28, 41, 0.8)",b=m.Ay.button.withConfig({displayName:"toolbox__ToolboxButton",componentId:"sc-1omy744-2"})(["display:block;width:100%;border:none;color:#f0f0f0;background:",";text-align:left;font-size:16px;outline:none;height:44px;cursor:pointer;&:hover{background:#276ef1;}"],P),S=m.Ay.div.withConfig({displayName:"toolbox__ToolboxCheckboxContainer",componentId:"sc-1omy744-3"})(["display:flex;align-items:center;width:100%;border:none;color:#f0f0f0;background:",";text-align:left;text-transform:capitalize;font-size:16px;outline:none;height:44px;cursor:pointer;&:hover{background:#276ef1;}"],P),w=e=>(0,n.jsx)("label",{children:(0,n.jsxs)(S,{children:[(0,n.jsx)("input",{...e,children:null}),e.children]})}),k=new g.H2([new g.DS,new g.uq]),A={mapContainer:{alignItems:"stretch",display:"flex",height:"100vh"},checkbox:{margin:10}},M={bearing:0,height:0,latitude:37.76,longitude:-122.44,pitch:0,width:0,zoom:11},F=[{category:"View",modes:[{label:"View",mode:g.nE},{label:"Measure Distance",mode:g.L6},{label:"Measure Area",mode:g.vX},{label:"Measure Angle",mode:g.Dx}]},{category:"Draw",modes:[{label:"Draw Point",mode:g.i_},{label:"Draw LineString",mode:g.DS},{label:"Draw Polygon",mode:g.cR},{label:"Draw Polygon By Dragging",mode:g.G2},{label:"Draw Rectangle",mode:g.hh},{label:"Draw Rectangle From Center",mode:g.E6},{label:"Draw Rectangle Using 3 Points",mode:g.UD},{label:"Draw Square",mode:g.Vv},{label:"Draw Square From Center",mode:g.OH},{label:"Draw Circle From Center",mode:g.Zy},{label:"Draw Circle By Diameter",mode:g.O5},{label:"Draw Ellipse By Bounding Box",mode:g.UP},{label:"Draw Ellipse Using 3 Points",mode:g.hP}]},{category:"Alter",modes:[{label:"Modify",mode:g.uq},{label:"Resize Circle",mode:g.C$},{label:"Elevation",mode:g.l$},{label:"Translate",mode:new g.UX(new g.O1)},{label:"Rotate",mode:g.Dr},{label:"Scale",mode:g.GN},{label:"Duplicate",mode:g.ls},{label:"Extend LineString",mode:g.X5},{label:"Extrude",mode:g.fb},{label:"Split",mode:g.m0},{label:"Transform",mode:new g.UX(new g._C)}]},{category:"Composite",modes:[{label:"Draw LineString + Modify",mode:k}]}],T=[g.cR,g.Jt,g.G2,g.hh,g.E6,g.UD,g.Vv,g.OH,g.Zy,g.O5,g.UP,g.hP],D=[g.hh,g.Vv,g.E6,g.OH,g.Zy,g.O5,g.UP],E={type:"FeatureCollection",features:[]};const j=["00AEE4","DAF0E3","9BCC32","07A35A","F7DF90","EA376C","6A126A","FCB09B","B0592D","C1B5E3","9C805B","CCDFE5"].map((function(e){const t=parseInt(e,16);return[16,8,0].map((e=>(t>>e&255)/255))}));function I(e){return e.__source?e.__source.object.properties.editHandleType:e.sourceFeature?e.sourceFeature.feature.properties.editHandleType:e.properties?e.properties.editHandleType:e.type}function _(e){switch(I(e)){case"existing":return[255,128,0,255];case"snap-source":return[192,128,240,255];default:return[255,192,128,255]}}class L extends s.Component{constructor(e){super(e),this._onChangeViewport=e=>{this.setState({viewport:{...this.state.viewport,...e}})},this._onLayerClick=e=>{console.log("onLayerClick",e),this.state.mode!==g.nE||this.state.selectionTool||(e?(console.log("select editing feature "+e.index),this.setState({selectedFeatureIndexes:[e.index]})):(console.log("deselect editing feature"),this.setState({selectedFeatureIndexes:[]})))},this._resize=()=>{this.forceUpdate()},this._loadSample=e=>{if("mixed"===e)this.setState({testFeatures:u,selectedFeatureIndexes:[]});else if("complex"===e)this.setState({testFeatures:{type:"FeatureCollection",features:[(0,h.A)([-122.45,37.81],4,{steps:5e3}),(0,h.A)([-122.33,37.81],4,{steps:5e3}),(0,h.A)([-122.45,37.73],4,{steps:5e3}),(0,h.A)([-122.33,37.73],4,{steps:5e3})]},selectedFeatureIndexes:[]});else if("blank"===e)this.setState({testFeatures:E,selectedFeatureIndexes:[]});else if("file"===e){const e=document.createElement("input");e.type="file",e.onchange=e=>{const t=e.target;if(t.files&&t.files[0]){const e=new FileReader;e.onload=e=>{let{target:t}=e;this._parseStringJson(t.result)},e.readAsText(t.files[0])}},e.click()}},this._copy=()=>{navigator&&navigator.clipboard?navigator.clipboard.writeText(JSON.stringify(this.state.testFeatures)):this._error("No navigator.clipboard")},this._paste=()=>{navigator&&navigator.clipboard?navigator.clipboard.readText().then((e=>{this._parseStringJson(e)}),(e=>{this._error(e)})):this._error("No navigator.clipboard")},this._download=()=>{const e=new Blob([JSON.stringify(this.state.testFeatures)],{type:"octet/stream"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="nebula.geojson",t.click()},this._parseStringJson=e=>{let t=null;try{t=JSON.parse(e),Array.isArray(t)&&(t={type:"FeatureCollection",features:t}),console.log("Loaded JSON:",t),this.setState({testFeatures:t})}catch(o){this._error(o)}},this._error=e=>{alert(e)},this.onEdit=e=>{let{updatedData:t,editType:o,editContext:n}=e,i=this.state.selectedFeatureIndexes;if(!["movePosition","extruding","rotating","translating","scaling"].includes(o)){const e=function(e){const t=e.features.map((e=>e.geometry.type+"("+function(e){const t=(e,t)=>t.reduce(((t,o)=>[...t,...e(o)]),[]),{type:o,coordinates:n}=e;switch(o){case"Point":return 1;case"LineString":case"MultiPoint":return n.length;case"Polygon":case"MultiLineString":return t((e=>e),n).length;case"MultiPolygon":return t((e=>t((e=>e),e)),n).length;default:throw Error("Unknown geometry type: "+o)}}(e.geometry)+")"));return JSON.stringify(t)}(t);console.log("onEdit",o,n,e)}if("removePosition"!==o||this.state.pointsRemovable){if("addFeature"===o&&this.state.mode!==g.ls){const{featureIndexes:e}=n;i=[...this.state.selectedFeatureIndexes,...e]}this.setState({testFeatures:t,selectedFeatureIndexes:i})}},this.getFillColor=(e,t)=>{const o=this.state.testFeatures.features.indexOf(e);return t?this._getDeckColorForFeature(o,1,.5):this._getDeckColorForFeature(o,.5,.5)},this.getLineColor=(e,t)=>{const o=this.state.testFeatures.features.indexOf(e);return t?this._getDeckColorForFeature(o,1,1):this._getDeckColorForFeature(o,.5,1)},this.state={viewport:M,testFeatures:u,mode:g.cR,modeConfig:null,pointsRemovable:!0,selectedFeatureIndexes:[],editHandleType:"point",selectionTool:void 0,showGeoJson:!1,pathMarkerLayer:!1,featureMenu:void 0}}componentDidMount(){window.addEventListener("resize",this._resize)}componentWillUnmount(){window.removeEventListener("resize",this._resize)}_getHtmlColorForFeature(e,t){const o=j.length;return"rgba("+j[e%o].map((e=>255*e)).join(",")+", "+(t?1:.7)+")"}_getDeckColorForFeature(e,t,o){const n=j.length;return[...j[e%n].map((e=>e*t*255)),255*o]}_renderSelectFeatureCheckbox(e,t){const{selectedFeatureIndexes:o}=this.state;return(0,n.jsx)("div",{children:(0,n.jsxs)(w,{style:A.checkbox,type:"checkbox",checked:o.includes(e),onChange:()=>{o.includes(e)?this.setState({selectedFeatureIndexes:o.filter((t=>t!==e))}):this.setState({selectedFeatureIndexes:[...o,e]})},children:[(0,n.jsxs)("span",{style:{color:this._getHtmlColorForFeature(e,o.includes(e))},children:[e,": ",t]}),(0,n.jsx)("a",{style:{position:"absolute",right:12},onClick:t=>{t.preventDefault(),t.stopPropagation(),this.setState({selectedFeatureIndexes:[e],featureMenu:{index:e,x:t.clientX,y:t.clientY}})},children:">>"})]})},e)}_renderSelectFeatureCheckboxes(){const{testFeatures:{features:e}}=this.state,t=[];for(let o=0;o<e.length;++o)t.push(this._renderSelectFeatureCheckbox(o,e[o].geometry.type));return t}_renderBooleanOperationControls(){return(0,n.jsxs)(x,{children:[(0,n.jsxs)(v,{children:["Boolean operation",(0,n.jsx)("br",{}),"(requires single selection)"]}),(0,n.jsx)(C,{children:["union","difference","intersection"].map((e=>(0,n.jsx)(b,{selected:this.state.modeConfig&&this.state.modeConfig.booleanOperation===e,onClick:()=>{this.state.modeConfig&&this.state.modeConfig.booleanOperation===e?this.setState({modeConfig:{...this.state.modeConfig||{},booleanOperation:null}}):this.setState({modeConfig:{...this.state.modeConfig||{},booleanOperation:e}})},children:e},e)))})]},"booleanOperations")}_renderTwoClickPolygonControls(){return(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Drag to draw"}),(0,n.jsx)(C,{children:(0,n.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.dragToDraw),onChange:e=>this.setState({modeConfig:{...this.state.modeConfig||{},dragToDraw:Boolean(e.target.checked)}})})})]},"twoClick")}_renderModifyModeControls(){return(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Allow removing points"}),(0,n.jsx)(C,{children:(0,n.jsx)("input",{type:"checkbox",checked:this.state.pointsRemovable,onChange:()=>this.setState({pointsRemovable:!this.state.pointsRemovable})})})]},"modify")}_renderSplitModeControls(){return(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Constrain to 90\xb0"}),(0,n.jsx)(C,{children:(0,n.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.lock90Degree),onChange:e=>this.setState({modeConfig:{lock90Degree:Boolean(e.target.checked)}})})})]},"split")}_renderSnappingControls(){return(0,n.jsx)("div",{children:(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Enable snapping"}),(0,n.jsx)(C,{children:(0,n.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.enableSnapping),onChange:e=>{const t={...this.state.modeConfig,enableSnapping:Boolean(e.target.checked)};this.setState({modeConfig:t})}})})]})},"snap")}_renderMeasureDistanceControls(){return(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Units"}),(0,n.jsx)(C,{children:(0,n.jsxs)("select",{value:this.state.modeConfig&&this.state.modeConfig.turfOptions&&this.state.modeConfig.turfOptions.units||"kilometers",onChange:e=>{const t={...this.state.modeConfig,turfOptions:{units:e.target.value}};this.setState({modeConfig:t})},children:[(0,n.jsx)("option",{value:"kilometers",children:"kilometers"}),(0,n.jsx)("option",{value:"miles",children:"miles"}),(0,n.jsx)("option",{value:"degrees",children:"degrees"}),(0,n.jsx)("option",{value:"radians",children:"radians"})]})}),(0,n.jsx)(v,{children:"Center Tooltips on Line"}),(0,n.jsx)(C,{children:(0,n.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.centerTooltipsOnLine),onChange:e=>{const t={...this.state.modeConfig,centerTooltipsOnLine:Boolean(e.target.checked)};this.setState({modeConfig:t})}})})]},"measure-distance")}_renderDrawPolygonModeControls(){return(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Prevent overlapping lines"}),(0,n.jsx)(C,{children:(0,n.jsx)("input",{type:"checkbox",checked:Boolean(this.state.modeConfig&&this.state.modeConfig.preventOverlappingLines),onChange:e=>this.setState({modeConfig:{...this.state.modeConfig||{},preventOverlappingLines:Boolean(e.target.checked)}})})})]},"draw-polygon")}_renderModeConfigControls(){const e=[];return T.indexOf(this.state.mode)>-1&&e.push(this._renderBooleanOperationControls()),D.indexOf(this.state.mode)>-1&&e.push(this._renderTwoClickPolygonControls()),this.state.mode===g.uq&&e.push(this._renderModifyModeControls()),this.state.mode===g.m0&&e.push(this._renderSplitModeControls()),this.state.mode instanceof g.UX&&e.push(this._renderSnappingControls()),this.state.mode===g.L6&&e.push(this._renderMeasureDistanceControls()),this.state.mode===g.cR&&e.push(this._renderDrawPolygonModeControls()),e}_renderToolBox(){return(0,n.jsxs)(y,{children:[F.map((e=>(0,n.jsxs)(x,{children:[(0,n.jsxs)(v,{children:[e.category," Modes"]}),e.modes.map((e=>{let{mode:t,label:o}=e;return(0,n.jsx)(b,{selected:this.state.mode===t,onClick:()=>{this.setState({mode:t,modeConfig:{},selectionTool:void 0})},children:o},o)}))]},e.category))),this._renderModeConfigControls(),this.state.showGeoJson&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(v,{children:"GeoJSON"}),(0,n.jsx)(b,{onClick:()=>this.setState({showGeoJson:!this.state.showGeoJson}),children:"hide \u25b2"}),(0,n.jsx)(C,{children:(0,n.jsx)("textarea",{id:"geo-json-text",rows:5,style:{width:"100%"},value:JSON.stringify(this.state.testFeatures),onChange:e=>this.setState({testFeatures:JSON.parse(e.target.value)})})})]}),!this.state.showGeoJson&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(v,{children:"GeoJSON"}),(0,n.jsx)(b,{onClick:()=>this.setState({showGeoJson:!this.state.showGeoJson}),children:"show \u25bc"})]}),(0,n.jsx)(b,{onClick:()=>this._copy(),children:"Copy"}),(0,n.jsx)(b,{onClick:()=>this._paste(),children:"Paste"}),(0,n.jsx)(b,{onClick:()=>this._download(),children:"Download"}),(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Load data"}),(0,n.jsxs)(C,{children:[(0,n.jsx)(b,{onClick:()=>this._loadSample("mixed"),children:"Mixed Sample"}),(0,n.jsx)(b,{onClick:()=>this._loadSample("complex"),children:"Complex Sample"}),(0,n.jsx)(b,{onClick:()=>this._loadSample("blank"),children:"Blank"}),(0,n.jsx)(b,{onClick:()=>this._loadSample("file"),children:"Open file..."})]})]}),(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Options"}),(0,n.jsx)(C,{children:(0,n.jsx)(w,{type:"checkbox",checked:"icon"===this.state.editHandleType,onChange:()=>this.setState({editHandleType:"icon"===this.state.editHandleType?"point":"icon"}),children:"Use Icons"})}),(0,n.jsx)(C,{children:(0,n.jsx)(w,{type:"checkbox",checked:"elevated"===this.state.editHandleType,onChange:()=>this.setState({editHandleType:"elevated"===this.state.editHandleType?"point":"elevated"}),children:"Use ElevatedEditHandleLayer"})}),(0,n.jsx)(C,{children:(0,n.jsx)(w,{type:"checkbox",checked:this.state.pathMarkerLayer,onChange:()=>this.setState({pathMarkerLayer:!this.state.pathMarkerLayer}),children:"Use PathMarkerLayer"})})]}),(0,n.jsxs)(x,{children:[(0,n.jsx)(v,{children:"Select Features"}),(0,n.jsxs)(C,{children:[(0,n.jsx)(b,{onClick:()=>this.setState({selectedFeatureIndexes:[],selectionTool:g.Sn.NONE}),children:"Clear Selection"}),(0,n.jsx)(b,{onClick:()=>this.setState({mode:g.nE,selectionTool:g.Sn.RECTANGLE}),children:"Rect Select"}),(0,n.jsx)(b,{onClick:()=>this.setState({mode:g.nE,selectionTool:g.Sn.POLYGON}),children:"Lasso Select"})]})]}),(0,n.jsx)(v,{children:"Features"}),(0,n.jsx)(x,{children:this._renderSelectFeatureCheckboxes()})]})}renderStaticMap(e){return(0,n.jsx)(p.Ay,{...e,mapStyle:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json"})}_featureMenuClick(e){const{index:t}=this.state.featureMenu||{};let o=this.state.testFeatures;if("delete"===e){const e=[...o.features];e.splice(t,1),o=Object.assign({},o,{features:e})}else"split"===e||"info"===e&&console.log(o.features[t]);this.setState({featureMenu:null,testFeatures:o})}_renderFeatureMenu(e){let{x:t,y:o}=e;return(0,n.jsxs)("div",{style:{position:"fixed",top:o-40,left:t+20},children:[(0,n.jsx)(b,{onClick:()=>this._featureMenuClick("delete"),children:"Delete"}),(0,n.jsx)(b,{onClick:()=>this._featureMenuClick("split"),children:"Split"}),(0,n.jsx)(b,{onClick:()=>this._featureMenuClick("info"),children:"Info"}),(0,n.jsx)(b,{onClick:()=>this._featureMenuClick(""),children:"Close"})]})}customizeLayers(e){}render(){const{testFeatures:e,selectedFeatureIndexes:t,mode:o}=this.state;let{modeConfig:i}=this.state;const s={...this.state.viewport,height:window.innerHeight,width:window.innerWidth};o===g.l$?i={...i,viewport:s,calculateElevationChange:e=>g.l$.calculateElevationChangeWithViewport(s,e)}:o===g.uq?i={...i,viewport:s,lockRectangles:!0}:o instanceof g.UX&&i?(o._handler instanceof g.O1&&(i={...i,viewport:s,screenSpace:!0}),i&&i.enableSnapping&&(i={...i,additionalSnapTargets:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-122.52235,37.734008],[-122.52217,37.712706],[-122.49436,37.711979],[-122.49725,37.734306],[-122.52235,37.734008]]]}}]})):o===g.G2&&(i={...i,throttleMs:100});let r={tooltips:{getColor:[255,255,255,255]}};"elevated"===this.state.editHandleType&&(r=Object.assign(r,{guides:{_subLayerProps:{points:{type:g.IM,getFillColor:[0,255,0]}}}})),this.state.pathMarkerLayer&&(r=Object.assign(r,{geojson:{_subLayerProps:{linestrings:{type:g.PZ,getMarkerColor:e=>[255,255,255,255],sizeScale:1500}}}}));const a=new g.Tp({id:"geojson",data:e,selectedFeatureIndexes:t,mode:o,modeConfig:i,autoHighlight:!1,onEdit:this.onEdit,editHandleType:this.state.editHandleType,editHandleIconAtlas:"data:image/png;base64,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",editHandleIconMapping:{intermediate:{x:0,y:0,width:58,height:58,mask:!1},existing:{x:58,y:0,width:58,height:58,mask:!1},"snap-source":{x:58,y:0,width:58,height:58,mask:!1},"snap-target":{x:0,y:0,width:58,height:58,mask:!1}},getEditHandleIcon:e=>I(e),getEditHandleIconSize:40,getEditHandleIconColor:_,pointRadiusMinPixels:5,getFillColor:this.getFillColor,getLineColor:this.getLineColor,getEditHandlePointColor:_,editHandlePointRadiusScale:2,_subLayerProps:r,parameters:{depthTest:!0,depthMask:!1,blend:!0,blendEquation:32774,blendFunc:[770,771]}}),p=[a];return this.state.selectionTool&&p.push(new g.cW({id:"selection",selectionType:this.state.selectionTool,onSelect:e=>{let{pickingInfos:t}=e;this.setState({selectedFeatureIndexes:t.map((e=>e.index))})},layerIds:["geojson"],getTentativeFillColor:()=>[255,0,255,100],getTentativeLineColor:()=>[0,0,255,255],lineWidthMinPixels:3})),this.customizeLayers(p),(0,n.jsxs)("div",{style:A.mapContainer,children:[(0,n.jsx)(l.A,{viewState:s,getCursor:a.getCursor.bind(a),layers:p,height:"100%",width:"100%",views:[new d.A({id:"basemap",controller:{type:c.A,doubleClickZoom:!1}})],onClick:this._onLayerClick,onViewStateChange:e=>{let{viewState:t}=e;return this.setState({viewport:t})},children:this.renderStaticMap(s)}),this._renderToolBox(),this.state.featureMenu&&this._renderFeatureMenu(this.state.featureMenu)]})}}var H=o(676);class R extends s.Component{static renderInfo(e){return(0,n.jsx)(n.Fragment,{})}render(){const{...e}=this.props;return(0,n.jsx)(r.A,{children:()=>(0,n.jsx)(L,{...e})})}}R.title="Advanced",R.code=a.lP+"/examples/editable-layers/advanced";const z=(0,H.xv)(R),O={},N="Advanced",q={id:"editable-layers/advanced",title:"Advanced",description:"",source:"@site/src/examples/editable-layers/advanced.mdx",sourceDirName:"editable-layers",slug:"/editable-layers/advanced",permalink:"/deck.gl-community/examples/editable-layers/advanced",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"examplesSidebar",previous:{title:"Editor",permalink:"/deck.gl-community/examples/editable-layers/editor"}},G={},U=[];function B(e){const t={h1:"h1",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"advanced",children:"Advanced"}),"\n","\n",(0,n.jsx)(z,{})]})}function W(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(B,{...e})}):B(e)}},2731:(e,t,o)=>{o.d(t,{H2:()=>ct,Jt:()=>st,O5:()=>$e,Zy:()=>Ye,UP:()=>tt,hP:()=>it,DS:()=>Ge,i_:()=>Oe,G2:()=>lt,cR:()=>Ue,E6:()=>Ze,hh:()=>We,UD:()=>nt,OH:()=>Ke,Vv:()=>Ve,ls:()=>Ee,Tp:()=>Et,IM:()=>Vt,l$:()=>ze,X5:()=>Kt,fb:()=>He,Dx:()=>to,vX:()=>$t,L6:()=>Qt,uq:()=>we,PZ:()=>G,C$:()=>Zt,Dr:()=>De,Sn:()=>d,GN:()=>Fe,cW:()=>Wt,UX:()=>dt,m0:()=>Le,_C:()=>pt,O1:()=>Se,nE:()=>ye});var n=o(3279),i=o(5917),s=o(1234),r=o(6599),a=o(365),l=o(669);const d={NONE:null,RECTANGLE:"rectangle",POLYGON:"polygon"};var c=o(228);o(4526);c.EventEmitter;var p=o(6558),h=o(7604),g=o(7885),u=o(7531);var m=o(9452),f=o(660);class y extends m.A{renderLayers(){const{id:e,getFillColor:t,getStrokeColor:o,getInnerRadius:n,updateTriggers:i}=this.props;return[new f.A({...this.props,id:e+"-full",data:this.props.data,getLineColor:o,updateTriggers:{...i,getStrokeColor:i.getStrokeColor}}),new f.A({...this.props,id:e+"-inner",data:this.props.data,getFillColor:t,getRadius:n,pickable:!1,updateTriggers:{...i,getFillColor:i.getFillColor,getRadius:i.getInnerRadius}})]}}y.layerName="JunctionScatterplotLayer",y.defaultProps={...f.A.defaultProps,getFillColor:e=>[0,0,0,255],getStrokeColor:e=>[255,255,255,255],getInnerRadius:e=>1};var x=o(908);var C=o(9350),v=o(976),P=o(7167);const b={outlineEnabled:!1,outlineRenderShadowmap:!1,outlineShadowmap:null};const S={name:"outline",vs:"#version 300 es\nin float instanceZLevel;\nout float outline_vzLevel;\nout vec4 outline_vPosition;\n\n// Set the z level for the outline shadowmap rendering\nvoid outline_setZLevel(float zLevel) {\n  outline_vzLevel = zLevel;\n}\n\n// Store an adjusted position for texture2DProj\nvoid outline_setUV(vec4 position) {\n  // mat4(\n  //   0.5, 0.0, 0.0, 0.0,\n  //   0.0, 0.5, 0.0, 0.0,\n  //   0.0, 0.0, 0.5, 0.0,\n  //   0.5, 0.5, 0.5, 1.0\n  // ) * position;\n  outline_vPosition = vec4(position.xyz * 0.5 + position.w * 0.5, position.w);\n}\n",fs:"uniform bool outline_uEnabled;\nuniform bool outline_uRenderOutlines;\nuniform sampler2D outline_uShadowmap;\n\nin float outline_vzLevel;\n// in vec2 outline_vUV;\nin vec4 outline_vPosition;\n\nout vec4 fragColor;\n\nconst float OUTLINE_Z_LEVEL_ERROR = 0.01;\n\n// Return a darker color in shadowmap\nvec4 outline_filterShadowColor(vec4 color) {\n  return vec4(outline_vzLevel / 255., outline_vzLevel / 255., outline_vzLevel / 255., 1.);\n}\n\n// Return a darker color if in shadowmap\nvec4 outline_filterDarkenColor(vec4 color) {\n  if (outline_uEnabled) {\n    float maxZLevel;\n    if (outline_vPosition.q > 0.0) {\n      maxZLevel = texture2DProj(outline_uShadowmap, outline_vPosition).r * 255.;\n    } else {\n      discard;\n    }\n    if (maxZLevel < outline_vzLevel + OUTLINE_Z_LEVEL_ERROR) {\n      vec4(color.rgb * 0.5, color.a);\n    } else {\n      discard;\n    }\n  }\n  return color;\n}\n\n// if enabled and rendering outlines - Render depth to shadowmap\n// if enabled and rendering colors - Return a darker color if in shadowmap\n// if disabled, just return color\nvec4 outline_filterColor(vec4 color) {\n  if (outline_uEnabled) {\n    return outline_uRenderOutlines ?\n      outline_filterShadowColor(color) :\n      outline_filterDarkenColor(color);\n  }\n  return color;\n}\n",getUniforms:function(e){let{outlineEnabled:t,outlineRenderShadowmap:o,outlineShadowmap:n}=void 0===e?b:e;const i={};return void 0!==t&&(i.outline_uEnabled=t),void 0!==o&&(i.outline_uRenderOutlines=o),void 0!==n&&(i.outline_uShadowmap=n),i}},w=2/3,k={common:0,meters:1,pixels:2};function A(e){let{source:t,code:o=""}=e;return t.replace(/}[^{}]*$/,o.concat("\n}\n"))}class M extends P.A{constructor(){super(...arguments),this.state=void 0}getShaders(){const e=super.getShaders();return Object.assign({},e,{modules:e.modules.concat([S]),vs:A({source:e.vs,code:"  outline_setUV(gl_Position);\n  outline_setZLevel(instanceZLevel);\n"}),fs:A({source:e.fs,code:"  fragColor = outline_filterColor(fragColor);\n"})})}initializeState(e){super.initializeState(),this.setState({outlineFramebuffer:e.device.createFramebuffer({}),dummyTexture:e.device.createTexture({})}),this.state.attributeManager.addInstanced({instanceZLevel:{size:1,type:5121,accessor:"getZLevel"}})}draw(e){let{moduleParameters:t={},parameters:o,uniforms:n,context:i}=e;const{jointRounded:s,capRounded:r,billboard:a,miterLimit:l,widthUnits:d,widthScale:c,widthMinPixels:p,widthMaxPixels:h}=this.props;n=Object.assign({},n,{jointType:Number(s),capType:Number(r),billboard:a,widthUnits:k[d],widthScale:c,miterLimit:l,widthMinPixels:p,widthMaxPixels:h});const{outlineFramebuffer:g,dummyTexture:u}=this.state;this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!0,outlineShadowmap:u}),this.state.model.draw({uniforms:Object.assign({},n,{jointType:0,widthScale:1.3*this.props.widthScale}),parameters:{depthTest:!1,blendEquation:32776},framebuffer:g}),this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!1,outlineShadowmap:g}),this.state.model.draw({uniforms:Object.assign({},n,{jointType:Number(s),capType:Number(r),widthScale:this.props.widthScale}),parameters:{depthTest:!1}})}}M.layerName="PathOutlineLayer",M.defaultProps={getZLevel:()=>0};var F=o(5337);class T extends F.V{constructor(e){void 0===e&&(e={}),super(Object.assign({},e,{attributes:D(e),topology:"triangle-list"}))}}function D(e){let{length:t=1,headSize:o=.2,tailWidth:n=.05,tailStart:i=.05}=e;const s=[.5,1,0,.5-o/2,1-o,0,.5+o/2,1-o,0,.5-n/2,i,0,.5+n/2,1-o,0,.5+n/2,i,0,.5-n/2,i,0,.5-n/2,1-o,0,.5+n/2,1-o,0],r=new Array(s.length);for(let a=0;a<s.length/3;a++){const e=3*a;r[e+0]=(s[e+0]-.5)*t,r[e+1]=(s[e+1]-.5)*t,r[e+2]=0}return{positions:{size:3,value:new Float32Array(r)},normals:{size:3,value:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])},texCoords:{size:2,value:new Float32Array(s)}}}var E=o(7422);function j(e){let t=0;for(let o=0;o<e.length-1;o++)t+=e[o].distance(e[o+1]);return t}const I=[0,0,0,255],_={forward:!0,backward:!1};function L(e){let{path:t,percentage:o,lineLength:n,color:i,object:s,projectFlat:r}=e;const a=n*o;let l=0,d=0,c=0;for(c=0;c<t.length-1&&(l+=t[c].distance(t[c+1]),!(l>a));c++)d=l;c===t.length-1&&(c-=1);const p=a-d,h=t[c+1].clone().subtract(t[c]).normalize().clone().multiply(new E.I(p,p)).add(t[c]),g=180*new E.I(r(t[c+1])).subtract(r(t[c])).verticalAngle()/Math.PI;return{position:[h.x,h.y,0],angle:g,color:i,object:s}}var H=o(7597),R=o(4901);function z(e){let{p:t,p1:o,p2:n,clampToLine:i=!0}=e;const s=new H.P(n).subtract(o),r=new H.P(t).subtract(o);let a=s.dot(r);return i&&(a=(0,R.qE)(a,0,1)),s.lerp(o,n,a)}const O=v.A,N={mesh:new T({headSize:.2,tailWidth:.05})},q=Object.assign({},M.defaultProps,{MarkerLayer:O,markerLayerProps:N,sizeScale:100,fp64:!1,highlightIndex:-1,highlightPoint:null,getPath:e=>e.path,getColor:e=>e.color,getMarkerColor:e=>[0,0,0,255],getDirection:e=>e.direction,getMarkerPercentages:(e,t)=>{let{lineLength:o}=t;return o>.1?[.25,.5,.75]:[.5]}});class G extends m.A{constructor(){super(...arguments),this.state=void 0}initializeState(){this.state={markers:[],mesh:new T({headSize:.2,tailWidth:.05}),closestPoint:null,closestPoints:[]}}projectFlat(e,t,o,n){if(o===C.rf.METER_OFFSETS){const[o,i]=t.metersToLngLatDelta(e),[s,r]=n;return t.projectFlat([s+o,i+r])}if(o===C.rf.LNGLAT_OFFSETS){const[o,i]=e,[s,r]=n;return t.projectFlat([s+o,i+r])}return t.projectFlat(e)}updateState(e){let{props:t,oldProps:o,changeFlags:n}=e;if(n.dataChanged||n.updateTriggersChanged){const{data:e,getPath:t,getDirection:o,getMarkerColor:n,getMarkerPercentages:i,coordinateSystem:s,coordinateOrigin:r}=this.props,{viewport:a}=this.context,l=e=>this.projectFlat(e,a,s,r);this.state.markers=function(e){let{data:t,getPath:o=((e,t)=>e.path),getDirection:n=(e=>e.direction),getColor:i=(e=>I),getMarkerPercentages:s=((e,t)=>[.5]),projectFlat:r}=e;const a=[];for(const l of t){const e=o(l,null),t=n(l)||_,d=i(l),c=e.map((e=>new E.I(e))),p=c.slice(0).reverse(),h=j(c),g=s(l,{lineLength:h});for(const o of g){if(t.forward){const e=L({path:c,percentage:o,lineLength:h,color:d,object:l,projectFlat:r});a.push(e)}if(t.backward){const e=L({path:p,percentage:o,lineLength:h,color:d,object:l,projectFlat:r});a.push(e)}}}return a}({data:e,getPath:t,getDirection:o,getColor:n,getMarkerPercentages:i,projectFlat:l}),this._recalculateClosestPoint()}n.propsChanged&&t.point!==o.point&&this._recalculateClosestPoint()}_recalculateClosestPoint(){const{highlightPoint:e,highlightIndex:t}=this.props;if(e&&t>=0){const o=this.props.data[t],n=this.props.getPath(o,null),{point:i}=function(e){let{p:t,points:o}=e;t=new H.P(t);let n=null,i=1/0,s=-1;for(let r=0;r<o.length-1;++r){const e=z({p:t,p1:o[r],p2:o[r+1]}),a=t.distanceSquared(e);a<i&&(i=a,n=e,s=r)}return{point:n,index:s,p1:o[s],p2:o[s+1],distanceSquared:i,distance:Math.sqrt(i)}}({points:n,p:e});this.state.closestPoints=[{position:i}]}else this.state.closestPoints=[]}getPickingInfo(e){let{info:t}=e;return Object.assign(t,{object:t.object&&t.object.path||t.object})}renderLayers(){return[new M(this.props,this.getSubLayerProps({id:"paths",data:this.props.data})),new this.props.MarkerLayer(this.getSubLayerProps(Object.assign({},this.props.markerLayerProps,{id:"markers",data:this.state.markers,getOrientation:e=>[0,-e.angle,0],getColor:e=>e.color,sizeScale:this.props.sizeScale,fp64:this.props.fp64,pickable:!1,parameters:{blend:!1,depthTest:!1}}))),this.state.closestPoints&&new f.A({id:this.props.id+"-highlight",data:this.state.closestPoints,fp64:this.props.fp64})]}}G.layerName="PathMarkerLayer",G.defaultProps=q;var U=o(8894),B=o(7790),W=o(4657),J=o(5475),V=o(8364),Z=o(9987),K=o(5046);function X(e,t,o){if(!Array.isArray(e[0]))return!0;for(let n=0;n<e.length;n++)if(X(e[n],[...t,n],o)){o(e,t);break}return!1}function Q(e,t,o){const i={type:"LineString",coordinates:[e,t]},s=(0,n.zx)(o),r=(0,g.A)(s,i),a=(0,h.A)(e,t),l=(o[0]-e[0])*(t[1]-e[1])-(o[1]-e[1])*(t[0]-e[0])<0?a-90:a-270,d=(0,p.A)(t,r,l),c=(0,p.A)(e,r,l);return[d.geometry.coordinates,c.geometry.coordinates]}function Y(e,t,o,n){const i=e-o,s=t-n;return Math.sqrt(i*i+s*s)}function $(e,t,o){const n=new u.Ay(o),i=e.geometry.coordinates.map((e=>{let[t,o,i=0]=e;return n.project([t,o,i])})),[s,r]=n.project(t.geometry.coordinates);let a=1/0,l={};i.forEach(((e,t)=>{let[o,n]=e;if(0===t)return;const[d,c]=i[t-1],p=c-n,h=o-d,g=d*n-o*c,u=p*p+h*h,m=Math.abs(p*s+h*r+g)/Math.sqrt(u);m<a&&(a=m,l={index:t,x0:(h*(h*s-p*r)-p*g)/u,y0:(p*(-h*s+p*r)-h*g)/u})}));const{index:d,x0:c,y0:p}=l,[h,g,m=0]=i[d-1],[f,y,x=0]=i[d],C=Y(h,g,f,y),v=function(e,t,o){return t*o+e*(1-o)}(m,x,Y(h,g,c,p)/C);return{type:"Feature",geometry:{type:"Point",coordinates:n.unproject([c,p,v])},properties:{dist:a,index:d-1}}}function ee(e){const t=ne(e);return t.length?t[0]:null}function te(e){return ne(e).find((e=>{let{properties:t}=e;return t.featureIndex>=0&&"existing"===t.editHandleType}))}function oe(e){return ne(e).find((e=>{let{properties:t}=e;return t.featureIndex>=0&&"intermediate"===t.editHandleType}))}function ne(e){return e&&e.filter((e=>e.isGuide&&"editHandle"===e.object.properties.guideType)).map((e=>e.object))||[]}function ie(e,t,o){void 0===o&&(o="existing");let n=[];switch(e.type){case"Point":n=[{type:"Feature",properties:{guideType:"editHandle",editHandleType:o,positionIndexes:[],featureIndex:t},geometry:{type:"Point",coordinates:e.coordinates}}];break;case"MultiPoint":case"LineString":n=n.concat(se(e.coordinates,[],t,o));break;case"Polygon":case"MultiLineString":for(let i=0;i<e.coordinates.length;i++)n=n.concat(se(e.coordinates[i],[i],t,o)),"Polygon"===e.type&&(n=n.slice(0,-1));break;case"MultiPolygon":for(let i=0;i<e.coordinates.length;i++)for(let s=0;s<e.coordinates[i].length;s++)n=n.concat(se(e.coordinates[i][s],[i,s],t,o)),n=n.slice(0,-1);break;default:throw Error("Unhandled geometry type: "+e.type)}return n}function se(e,t,o,n){void 0===n&&(n="existing");const i=[];for(let s=0;s<e.length;s++){const r=e[s];i.push({type:"Feature",properties:{guideType:"editHandle",positionIndexes:[...t,s],featureIndex:o,editHandleType:n},geometry:{type:"Point",coordinates:r}})}return i}function re(e,t){return"number"==typeof e[0]?!isNaN(e[0])&&isFinite(e[0])?t(e):e:e.map((e=>re(e,t))).filter(Boolean)}class ae{constructor(e){this.featureCollection=e}getObject(){return this.featureCollection}replacePosition(e,t,o){const n=this.featureCollection.features[e].geometry,i="Polygon"===n.type||"MultiPolygon"===n.type,s={...n,coordinates:de(n.coordinates,t,o,i)};return this.replaceGeometry(e,s)}removePosition(e,t){const o=this.featureCollection.features[e].geometry;if("Point"===o.type)throw Error("Can't remove a position from a Point or there'd be nothing left");if("MultiPoint"===o.type&&o.coordinates.length<2)throw Error("Can't remove the last point of a MultiPoint or there'd be nothing left");if("LineString"===o.type&&o.coordinates.length<3)throw Error("Can't remove position. LineString must have at least two positions");if("Polygon"===o.type&&o.coordinates[0].length<5&&Array.isArray(t)&&0===t[0])throw Error("Can't remove position. Polygon's outer ring must have at least four positions");if("MultiLineString"===o.type&&1===o.coordinates.length&&o.coordinates[0].length<3)throw Error("Can't remove position. MultiLineString must have at least two positions");if("MultiPolygon"===o.type&&1===o.coordinates.length&&o.coordinates[0][0].length<5&&Array.isArray(t)&&0===t[0]&&0===t[1])throw Error("Can't remove position. MultiPolygon's outer ring must have at least four positions");const n="Polygon"===o.type||"MultiPolygon"===o.type,i={...o,coordinates:ce(o.coordinates,t,n)};return function(e){switch(e.type){case"Polygon":!function(e){const t=e.coordinates;for(let o=1;o<t.length;o++)he(t,o)&&o--}(e);break;case"MultiLineString":!function(e){for(let t=0;t<e.coordinates.length;t++){1===e.coordinates[t].length&&(e.coordinates.splice(t,1),t--)}}(e);break;case"MultiPolygon":!function(e){for(let t=0;t<e.coordinates.length;t++){const o=e.coordinates[t];o[0].length<=3&&(e.coordinates.splice(t,1),t--);for(let e=1;e<o.length;e++)he(o,e)&&e--}}(e)}}(i),this.replaceGeometry(e,i)}addPosition(e,t,o){const n=this.featureCollection.features[e].geometry;if("Point"===n.type)throw new Error("Unable to add a position to a Point feature");const i="Polygon"===n.type||"MultiPolygon"===n.type,s={...n,coordinates:pe(n.coordinates,t,o,i)};return this.replaceGeometry(e,s)}replaceGeometry(e,t){const o={...this.featureCollection.features[e],geometry:t},n={...this.featureCollection,features:[...this.featureCollection.features.slice(0,e),o,...this.featureCollection.features.slice(e+1)]};return new ae(n)}addFeature(e){return this.addFeatures([e])}addFeatures(e){const t={...this.featureCollection,features:[...this.featureCollection.features,...e]};return new ae(t)}deleteFeature(e){return this.deleteFeatures([e])}deleteFeatures(e){const t=[...this.featureCollection.features];e.sort();for(let n=e.length-1;n>=0;n--){const o=e[n];o>=0&&o<t.length&&t.splice(o,1)}const o={...this.featureCollection,features:t};return new ae(o)}}function le(e,t){if(2===e.length&&3===t.length){const o=t[2];return[e[0],e[1],o]}return e}function de(e,t,o,n){if(!t)return e;if(0===t.length)return le(o,e);if(1===t.length){const i=[...e.slice(0,t[0]),le(o,e[t[0]]),...e.slice(t[0]+1)];return!n||0!==t[0]&&t[0]!==e.length-1||(i[0]=le(o,e[0]),i[e.length-1]=le(o,e[0])),i}return[...e.slice(0,t[0]),de(e[t[0]],t.slice(1,t.length),o,n),...e.slice(t[0]+1)]}function ce(e,t,o){if(!t)return e;if(0===t.length)throw Error("Must specify the index of the position to remove");if(1===t.length){const n=[...e.slice(0,t[0]),...e.slice(t[0]+1)];return!o||0!==t[0]&&t[0]!==e.length-1||(0===t[0]?n[n.length-1]=n[0]:t[0]===e.length-1&&(n[0]=n[n.length-1])),n}return[...e.slice(0,t[0]),ce(e[t[0]],t.slice(1,t.length),o),...e.slice(t[0]+1)]}function pe(e,t,o,n){if(!t)return e;if(0===t.length)throw Error("Must specify the index of the position to remove");if(1===t.length){return[...e.slice(0,t[0]),o,...e.slice(t[0])]}return[...e.slice(0,t[0]),pe(e[t[0]],t.slice(1,t.length),o,n),...e.slice(t[0]+1)]}function he(e,t){return e[t].length<=3&&(e.splice(t,1),!0)}const ge={type:"FeatureCollection",features:[]},ue=[];class me{constructor(){this._clickSequence=[]}getGuides(e){return ge}getTooltips(e){return ue}getSelectedFeature(e){return 1===e.selectedIndexes.length?e.data.features[e.selectedIndexes[0]]:null}getSelectedGeometry(e){const t=this.getSelectedFeature(e);return t?t.geometry:null}getSelectedFeaturesAsFeatureCollection(e){const{features:t}=e.data;return{type:"FeatureCollection",features:e.selectedIndexes.map((e=>t[e]))}}getClickSequence(){return this._clickSequence}addClickSequence(e){let{mapCoords:t}=e;this._clickSequence.push(t)}resetClickSequence(){this._clickSequence=[]}getTentativeGuide(e){return this.getGuides(e).features.find((e=>e.properties&&"tentative"===e.properties.guideType))}isSelectionPicked(e,t){if(!e.length)return!1;const o=function(e){return e&&e.filter((e=>!e.isGuide))}(e).map((e=>{let{index:t}=e;return t})),n=ne(e).map((e=>{let{properties:t}=e;return t.featureIndex})),i=new Set([...o,...n]);return t.selectedIndexes.some((e=>i.has(e)))}rewindPolygon(e){const{geometry:t}=e;return"Polygon"===t.type||"MultiPolygon"===t.type?(0,V.A)(e):e}getAddFeatureAction(e,t){const o=e,n="Feature"===o.type?o:{type:"Feature",properties:{},geometry:o},i=this.rewindPolygon(n),s=new ae(t).addFeature(i).getObject();return{updatedData:s,editType:"addFeature",editContext:{featureIndexes:[s.features.length-1]}}}getAddManyFeaturesAction(e,t){let{features:o}=e,n=new ae(t);const i=n.getObject().features.length,s=[];for(const r of o){const{properties:e,geometry:t}=r,o=t;n=n.addFeature({type:"Feature",properties:e,geometry:o}),s.push(i+s.length)}return{updatedData:n.getObject(),editType:"addFeature",editContext:{featureIndexes:s}}}getAddFeatureOrBooleanPolygonAction(e,t){const o=e,n=this.getSelectedFeature(t),{modeConfig:i}=t;if(i&&i.booleanOperation){if(!n||"Polygon"!==n.geometry.type&&"MultiPolygon"!==n.geometry.type)return console.warn("booleanOperation only supported for single Polygon or MultiPolygon selection"),null;const e="Feature"===o.type?o:{type:"Feature",geometry:o};let s;if("union"===i.booleanOperation)s=(0,W.A)(n,e);else if("difference"===i.booleanOperation)s=(0,a.A)(n,e);else{if("intersection"!==i.booleanOperation)return console.warn("Invalid booleanOperation "+i.booleanOperation),null;s=(0,J.A)(n,e)}if(!s)return console.warn("Canceling edit. Boolean operation erased entire polygon."),null;const r=t.selectedIndexes[0];return{updatedData:new ae(t.data).replaceGeometry(r,s.geometry).getObject(),editType:"unionGeometry",editContext:{featureIndexes:[r]}}}return this.getAddFeatureAction(e,t.data)}createTentativeFeature(e){return null}handleClick(e,t){}handlePointerMove(e,t){const o=this.createTentativeFeature(t);o&&t.onEdit({updatedData:t.data,editType:"updateTentativeFeature",editContext:{feature:o}})}handleStartDragging(e,t){}handleStopDragging(e,t){}handleDragging(e,t){}handleKeyUp(e,t){"Escape"===e.key&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}}function fe(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}class ye extends me{}var xe=o(7083),Ce=o(5903),ve=o(7743),Pe=o(8664),be=o(7861);class Se extends me{constructor(){super(...arguments),this._isTranslatable=void 0}handleDragging(e,t){if(this._isTranslatable){if(this._geometryBeforeTranslate){const o=this.getTranslateAction(e.pointerDownMapCoords,e.mapCoords,"translating",t);o&&t.onEdit(o)}e.cancelPan()}}handlePointerMove(e,t){this._isTranslatable=this.isSelectionPicked(e.pointerDownPicks||e.picks,t),this.updateCursor(t)}handleStartDragging(e,t){this._isTranslatable&&(this._geometryBeforeTranslate=this.getSelectedFeaturesAsFeatureCollection(t))}handleStopDragging(e,t){if(this._geometryBeforeTranslate){const o=this.getTranslateAction(e.pointerDownMapCoords,e.mapCoords,"translated",t);o&&t.onEdit(o),this._geometryBeforeTranslate=null}}updateCursor(e){this._isTranslatable?e.onUpdateCursor("move"):e.onUpdateCursor(null)}getTranslateAction(e,t,o,i){if(!this._geometryBeforeTranslate)return null;let s=new ae(i.data);const r=i.selectedIndexes,{viewport:a,screenSpace:d}=i.modeConfig||{};if(a&&d){const o=a.project?a:new u.Ay(a),n=o.project(e),i=o.project(t),l=i[0]-n[0],d=i[1]-n[1];for(let e=0;e<r.length;e++){const t=r[e],n=this._geometryBeforeTranslate.features[e];let i=n.geometry.coordinates;i&&(i=re(i,(e=>{const t=o.project(e);return t?(t[0]+=l,t[1]+=d,o.unproject(t)):null})),s=s.replaceGeometry(t,{type:n.geometry.type,coordinates:i}))}}else{const o=(0,n.zx)(e),i=(0,n.zx)(t),a=(0,l.A)(o,i),d=(0,h.A)(o,i),c=this._geometryBeforeTranslate.features.map((e=>function(e,t,o){const n=(0,Ce.A)(e),i=(0,be.A)(n,t,o),s=re(e.geometry.coordinates,(e=>{const t=(0,Pe.A)(n.geometry.coordinates,e),o=(0,ve.A)(n.geometry.coordinates,e);return(0,be.A)(i.geometry.coordinates,t,o).geometry.coordinates}));return e.geometry.coordinates=s,e}((0,xe.A)(e),a,d)));for(let e=0;e<r.length;e++){const t=r[e],o=c[e];s=s.replaceGeometry(t,o.geometry)}}return{updatedData:s.getObject(),editType:o,editContext:{featureIndexes:r}}}}class we extends me{getGuides(e){const t=[],{data:o,lastPointerMoveEvent:i}=e,{features:s}=o,r=i&&i.picks,a=i&&i.mapCoords;for(const n of e.selectedIndexes)if(n<s.length){const{geometry:e}=s[n];t.push(...ie(e,n))}else console.warn("selectedFeatureIndexes out of range "+n);if(r&&r.length&&a){var l;const o=!te(r)&&r.find((e=>!e.isGuide));if(o&&!o.object.geometry.type.includes("Point")&&(null==(l=e.modeConfig)||!l.lockRectangles||"Rectangle"!==o.object.properties.shape)&&e.selectedIndexes.includes(o.index)){let i=null,s=[];const r=(0,n.zx)(a);if(X(o.object.geometry.coordinates,[],((t,o)=>{const a=(0,n.wi)(t),l=this.getNearestPoint(a,r,e.modeConfig&&e.modeConfig.viewport);(!i||l.properties.dist<i.properties.dist)&&(i=l,s=o)})),i){const{geometry:{coordinates:e},properties:{index:n}}=i;t.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:o.index,positionIndexes:[...s,n+1]},geometry:{type:"Point",coordinates:e}})}}}return{type:"FeatureCollection",features:t}}getNearestPoint(e,t,o){const{coordinates:i}=e.geometry;if(i.some((e=>e.length>2))){if(o)return $(e,t,o);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return function(e,t,o){var i,s;let r;o&&(r=new u.Ay(o));let a=(0,n.zx)([1/0,1/0],{dist:1/0});return null==(i=e.geometry)||!i.coordinates.length||(null==(s=e.geometry)?void 0:s.coordinates.length)<2||(0,Z.iw)(e,(e=>{const o=(0,K.$R)(e),i=(0,K.$R)(t);let s,l,d,c,p,h,g;if(o.length>1&&i.length){let e,t;r?(e=o.map((e=>r.project(e))),t=r.project(i)):(e=o,t=i);for(let o=1;o<e.length;o++){if(e[o][0]!==e[o-1][0]){const n=(e[o][1]-e[o-1][1])/(e[o][0]-e[o-1][0]),i=e[o][1]-n*e[o][0];g=Math.abs(n*t[0]+i-t[1])/Math.sqrt(n*n+1)}else g=Math.abs(t[0]-e[o][0]);const n=Math.pow(e[o][1]-e[o-1][1],2)+Math.pow(e[o][0]-e[o-1][0],2),i=Math.pow(e[o][1]-t[1],2)+Math.pow(e[o][0]-t[0],2),r=Math.pow(e[o-1][1]-t[1],2)+Math.pow(e[o-1][0]-t[0],2),a=Math.pow(g,2),c=i-a+r-a;c>n&&(g=Math.sqrt(Math.min(i,r))),(null==s||s>g)&&(c>n?r<i?(l=0,d=1):(d=0,l=1):(l=Math.sqrt(r-a)/Math.sqrt(n),d=Math.sqrt(i-a)/Math.sqrt(n)),s=g,h=o)}const n=e[h-1][0]-e[h][0],a=e[h-1][1]-e[h][1];c=e[h-1][0]-n*l,p=e[h-1][1]-a*l}let u={x:c,y:p,idx:h-1,to:l,from:d};if(r){const e=r.unproject([u.x,u.y]);u={x:e[0],y:e[1],idx:h-1,to:l,from:d}}a=(0,n.zx)([u.x,u.y],{dist:Math.abs(u.from-u.to),index:u.idx})})),a}(e,t,o)}handleClick(e,t){const o=te(e.picks),n=oe(e.picks);if(o){const{featureIndex:e,positionIndexes:n}=o.properties;let i;try{i=new ae(t.data).removePosition(e,n).getObject()}catch(s){}i&&t.onEdit({updatedData:i,editType:"removePosition",editContext:{featureIndexes:[e],positionIndexes:n,position:o.geometry.coordinates}})}else if(n){var i;const{featureIndex:e,positionIndexes:o}=n.properties,s=t.data.features[e];if(!(null!=(i=t.modeConfig)&&i.lockRectangles&&"Rectangle"===(null==s?void 0:s.properties.shape))){const i=new ae(t.data).addPosition(e,o,n.geometry.coordinates).getObject();i&&t.onEdit({updatedData:i,editType:"addPosition",editContext:{featureIndexes:[e],positionIndexes:o,position:n.geometry.coordinates}})}}}handleDragging(e,t){const o=ee(e.pointerDownPicks);o&&(e.cancelPan(),this._dragEditHandle("movePosition",t,o,e))}_dragEditHandle(e,t,o,n){var i;const s=o.properties,r=t.data.features[s.featureIndex];let a;if(null!=(i=t.modeConfig)&&i.lockRectangles&&"Rectangle"===r.properties.shape){const e=function(e,t,o){const n=e.geometry.coordinates;if(!n)return null;const i=n[0].slice(0,4);i[t%4]=o;const s=i[(t+2)%4],r=i[t%4];return i[(t+1)%4]=[r[0],s[1]],i[(t+3)%4]=[s[0],r[1]],[[...i,i[0]]]}(r,s.positionIndexes[1],n.mapCoords);a=new ae(t.data).replaceGeometry(s.featureIndex,{coordinates:e,type:"Polygon"}).getObject()}else a=new ae(t.data).replacePosition(s.featureIndex,s.positionIndexes,n.mapCoords).getObject();t.onEdit({updatedData:a,editType:e,editContext:{featureIndexes:[s.featureIndex],positionIndexes:s.positionIndexes,position:n.mapCoords}})}handlePointerMove(e,t){const o=this.getCursor(e);t.onUpdateCursor(o)}handleStartDragging(e,t){const o=t.selectedIndexes,n=oe(e.picks);if(o.length&&n){const o=n.properties,i=new ae(t.data).addPosition(o.featureIndex,o.positionIndexes,e.mapCoords).getObject();t.onEdit({updatedData:i,editType:"addPosition",editContext:{featureIndexes:[o.featureIndex],positionIndexes:o.positionIndexes,position:e.mapCoords}})}}handleStopDragging(e,t){const o=t.selectedIndexes,n=ee(e.picks);o.length&&n&&this._dragEditHandle("finishMovePosition",t,n,e)}getCursor(e){return ne(e&&e.picks||[]).length?"cell":null}}var ke=o(7450),Ae=o(5875),Me=o(1349);class Fe extends me{constructor(){super(...arguments),this._cornerGuidePoints=[],this._isScaling=!1,this._isSinglePointGeometrySelected=e=>{const{features:t}=e||{};if(Array.isArray(t)&&1===t.length){const{type:e}=(0,K.bg)(t[0]);return"Point"===e}return!1},this._getOppositeScaleHandle=e=>{const t=e&&e.properties&&Array.isArray(e.properties.positionIndexes)&&e.properties.positionIndexes[0];if("number"!=typeof t)return null;const o=this._cornerGuidePoints.length,n=(t+o/2)%o;return this._cornerGuidePoints.find((e=>!!Array.isArray(e.properties.positionIndexes)&&e.properties.positionIndexes[0]===n))||null},this._getUpdatedData=(e,t)=>{let o=new ae(e.data);const n=e.selectedIndexes;for(let i=0;i<n.length;i++){const e=n[i],s=t.features[i];o=o.replaceGeometry(e,s.geometry)}return o.getObject()},this.isEditHandleSelected=()=>Boolean(this._selectedEditHandle),this.getScaleAction=(e,t,o,n)=>{if(!this._selectedEditHandle)return null;const i=this._getOppositeScaleHandle(this._selectedEditHandle),s=(0,K.uG)(i),r=function(e,t,o){const n=(0,l.A)(e,t),i=(0,l.A)(e,o);return i/n}(s,e,t),a=(0,Me.A)(this._geometryBeingScaled,r,{origin:s});return{updatedData:this._getUpdatedData(n,a),editType:o,editContext:{featureIndexes:n.selectedIndexes}}},this.updateCursor=e=>{if(this._selectedEditHandle){this._cursor&&e.onUpdateCursor(this._cursor);const t=this.getSelectedFeaturesAsFeatureCollection(e),o=(0,ke.A)(t),n=(0,h.A)(o,this._selectedEditHandle),i=n<0?n+180:n;i>=0&&i<=90||i>=180&&i<=270?(this._cursor="nesw-resize",e.onUpdateCursor("nesw-resize")):(this._cursor="nwse-resize",e.onUpdateCursor("nwse-resize"))}else e.onUpdateCursor(null),this._cursor=null}}handlePointerMove(e,t){if(!this._isScaling){const o=ee(e.picks);this._selectedEditHandle=o&&"scale"===o.properties.editHandleType?o:null,this.updateCursor(t)}}handleStartDragging(e,t){this._selectedEditHandle&&(this._isScaling=!0,this._geometryBeingScaled=this.getSelectedFeaturesAsFeatureCollection(t))}handleDragging(e,t){if(!this._isScaling)return;t.onUpdateCursor(this._cursor);const o=this.getScaleAction(e.pointerDownMapCoords,e.mapCoords,"scaling",t);o&&t.onEdit(o),e.cancelPan()}handleStopDragging(e,t){if(this._isScaling){const o=this.getScaleAction(e.pointerDownMapCoords,e.mapCoords,"scaled",t);o&&t.onEdit(o),t.onUpdateCursor(null),this._geometryBeingScaled=null,this._selectedEditHandle=null,this._cursor=null,this._isScaling=!1}}getGuides(e){this._cornerGuidePoints=[];const t=this.getSelectedFeaturesAsFeatureCollection(e);if(this._isSinglePointGeometrySelected(t))return{type:"FeatureCollection",features:[]};const o=(0,s.A)((0,i.A)(t));o.properties.mode="scale";const r=[];return(0,Z.Fh)(o,((e,t)=>{if(t<4){const o=(0,n.zx)(e,{guideType:"editHandle",editHandleType:"scale",positionIndexes:[t]});r.push(o)}})),this._cornerGuidePoints=r,(0,n.Lr)([(0,Ae.Ay)(o),...this._cornerGuidePoints])}}var Te=o(5486);class De extends me{constructor(){super(...arguments),this._isRotating=!1,this._isSinglePointGeometrySelected=e=>{const{features:t}=e||{};if(Array.isArray(t)&&1===t.length){const{type:e}=(0,K.bg)(t[0]);return"Point"===e}return!1},this.getIsRotating=()=>this._isRotating}getGuides(e){const t=this._geometryBeingRotated||this.getSelectedFeaturesAsFeatureCollection(e);if(this._isSinglePointGeometrySelected(t))return{type:"FeatureCollection",features:[]};if(this._isRotating)return(0,n.Lr)([(0,ke.A)(t)]);const o=(0,s.A)((0,i.A)(t));let r=null,a=null,d=0;(0,Z.Fh)(o,(e=>{if(r){const t=fe(e,r);(!a||t[1]>a[1])&&(a=t);const o=(0,l.A)(e,r);d=Math.max(d,o)}r=e}));const c=a&&[a[0],a[1]+d/1e3],p=(0,n.wi)([a,c]),h=(0,n.zx)(c,{guideType:"editHandle",editHandleType:"rotate"}),g=[(0,Ae.Ay)(o),h,p];return(0,n.Lr)(g)}handleDragging(e,t){if(!this._isRotating)return;const o=this.getRotateAction(e.pointerDownMapCoords,e.mapCoords,"rotating",t);o&&t.onEdit(o),e.cancelPan()}handlePointerMove(e,t){if(!this._isRotating){const t=ee(e.picks);this._selectedEditHandle=t&&"rotate"===t.properties.editHandleType?t:null}this.updateCursor(t)}handleStartDragging(e,t){this._selectedEditHandle&&(this._isRotating=!0,this._geometryBeingRotated=this.getSelectedFeaturesAsFeatureCollection(t))}handleStopDragging(e,t){if(this._isRotating){const o=this.getRotateAction(e.pointerDownMapCoords,e.mapCoords,"rotated",t);o&&t.onEdit(o),this._geometryBeingRotated=null,this._selectedEditHandle=null,this._isRotating=!1}}updateCursor(e){this._selectedEditHandle?e.onUpdateCursor("crosshair"):e.onUpdateCursor(null)}getRotateAction(e,t,o,n){if(!this._geometryBeingRotated)return null;const i=(0,ke.A)(this._geometryBeingRotated),s=function(e,t,o){const n=(0,h.A)(e,t),i=(0,h.A)(e,o);return i-n}(i,e,t),r=(0,Te.A)(this._geometryBeingRotated,s,{pivot:i});let a=new ae(n.data);const l=n.selectedIndexes;for(let d=0;d<l.length;d++){const e=l[d],t=r.features[d];a=a.replaceGeometry(e,t.geometry)}return{updatedData:a.getObject(),editType:o,editContext:{featureIndexes:l}}}}class Ee extends Se{handleStartDragging(e,t){super.handleStartDragging(e,t),this._geometryBeforeTranslate&&t.onEdit(this.getAddManyFeaturesAction(this._geometryBeforeTranslate,t.data))}updateCursor(e){this._isTranslatable?e.onUpdateCursor("copy"):e.onUpdateCursor(null)}}var je=o(2608),Ie=o(5085),_e=o(7028);class Le extends me{calculateMapCoords(e,t,o){const i=o.modeConfig;if(!i||!i.lock90Degree||!e.length)return t;if(1===e.length){const n=e[0],i=this.getSelectedGeometry(o),s=(0,Ae.Ay)(i),r="FeatureCollection"===s.type?s.features:[s];let a=Number.MAX_SAFE_INTEGER,d=null;if(r.forEach((e=>{const t=(0,_e.A)(e,n),o=(0,l.A)(t,n);a>o&&(a=o,d=t)})),d){const e=(0,h.A)(n,d),o=(0,l.A)(n,t,{units:"meters"});return(0,p.A)(n,o,e,{units:"meters"}).geometry.coordinates}return t}const s=e[e.length-1],[r]=Q(e[e.length-2],s,t);return(0,_e.A)((0,n.wi)([s,r]),t).geometry.coordinates}getGuides(e){const t=this.getClickSequence(),o={type:"FeatureCollection",features:[]};if(0===t.length||!e.lastPointerMoveEvent)return o;const{mapCoords:n}=e.lastPointerMoveEvent;return o.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...t,this.calculateMapCoords(t,n,e)]}}),o}handleClick(e,t){const o=this.getTentativeGuide(t),n=this.getSelectedGeometry(t);if(!n)return void console.warn("A polygon must be selected for splitting");const i=this.getClickSequence();o&&"LineString"===o.geometry.type?i.push(o.geometry.coordinates[o.geometry.coordinates.length-1]):this.addClickSequence(e);const s={type:"Point",coordinates:i[i.length-1]},r=(0,je.A)(s,n);if(i.length>1&&o&&!r){this.resetClickSequence();if(0===(0,Ie.A)(o,n).features.length)return;const e=this.splitPolygon(o,t);e&&t.onEdit(e)}}handlePointerMove(e,t){t.onUpdateCursor("cell")}splitPolygon(e,t){const o=this.getSelectedGeometry(t),n=t.selectedIndexes[0],i=t.modeConfig||{};let{gap:s=.1,units:l="centimeters"}=i;0===s&&(s=.1,l="centimeters");const d=(0,r.A)(e,s,{units:l}),c=(0,a.A)(o,d);if(!c)return console.warn("Canceling edit. Split Polygon erased"),null;const{type:p,coordinates:h}=c.geometry;let g=[];g="Polygon"===p?h.map((e=>[e])):h.reduce(((e,t)=>(t.forEach((t=>{e.push([t])})),e)),[]);return{updatedData:new ae(t.data).replaceGeometry(n,{type:"MultiPolygon",coordinates:g}).getObject(),editType:"split",editContext:{featureIndexes:[n]}}}}class He extends we{constructor(){super(...arguments),this.isPointAdded=!1}handleDragging(e,t){const o=ee(e.pointerDownPicks);if(o){const{featureIndex:n}=o.properties;let{positionIndexes:i}=o.properties;const s=this.coordinatesSize(i,n,t.data);i=this.isPointAdded?this.nextPositionIndexes(i,s):i;const r=this.getPointForPositionIndexes(this.prevPositionIndexes(i,s),n,t.data),a=this.getPointForPositionIndexes(i,n,t.data);if(r&&a){const[o,l]=Q(r,a,e.mapCoords),d=new ae(t.data).replacePosition(n,this.prevPositionIndexes(i,s),l).replacePosition(n,i,o).getObject();t.onEdit({updatedData:d,editType:"extruding",editContext:{featureIndexes:[n],positionIndexes:this.nextPositionIndexes(i,s),position:o}}),e.cancelPan()}}}handleStartDragging(e,t){const o=t.selectedIndexes,n=oe(e.picks);if(o.length&&n){const{positionIndexes:e,featureIndex:o}=n.properties,i=this.coordinatesSize(e,o,t.data),s=this.getPointForPositionIndexes(this.prevPositionIndexes(e,i),o,t.data),r=this.getPointForPositionIndexes(e,o,t.data);if(s&&r){let n=new ae(t.data);this.isOrthogonal(e,o,i,t.data)||(n=n.addPosition(o,e,r)),this.isOrthogonal(this.prevPositionIndexes(e,i),o,i,t.data)||(n=n.addPosition(o,e,s),this.isPointAdded=!0),t.onEdit({updatedData:n.getObject(),editType:"startExtruding",editContext:{featureIndexes:[o],positionIndexes:e,position:s}})}}}handleStopDragging(e,t){const o=t.selectedIndexes,n=ee(e.pointerDownPicks);if(o.length&&n){const{featureIndex:o}=n.properties;let{positionIndexes:i}=n.properties;const s=this.coordinatesSize(i,o,t.data);i=this.isPointAdded?this.nextPositionIndexes(i,s):i;const r=this.getPointForPositionIndexes(this.prevPositionIndexes(i,s),o,t.data),a=this.getPointForPositionIndexes(i,o,t.data);if(r&&a){const[n,l]=Q(r,a,e.mapCoords),d=new ae(t.data).replacePosition(o,this.prevPositionIndexes(i,s),l).replacePosition(o,i,n).getObject();t.onEdit({updatedData:d,editType:"extruded",editContext:{featureIndexes:[o],positionIndexes:i,position:n}})}}this.isPointAdded=!1}coordinatesSize(e,t,o){let{features:n}=o,i=0;if(Array.isArray(e)){const o=n[t].geometry.coordinates;if(3===e.length){const[t,n]=e;o.length&&o[t].length&&(i=o[t][n].length)}else{const[t]=e;o.length&&o[t].length&&(i=o[t].length)}}return i}getBearing(e,t){const o=(0,h.A)(e,t);return o<0?Math.floor(360+o):Math.floor(o)}isOrthogonal(e,t,o,n){if(!Array.isArray(e))return!1;e[e.length-1]===o-1&&(e[e.length-1]=0);const i=this.getPointForPositionIndexes(this.prevPositionIndexes(e,o),t,n),s=this.getPointForPositionIndexes(this.nextPositionIndexes(e,o),t,n),r=this.getPointForPositionIndexes(e,t,n),a=this.getBearing(r,i),l=this.getBearing(r,s);return[89,90,91,269,270,271].includes(Math.abs(a-l))}nextPositionIndexes(e,t){if(!Array.isArray(e))return[];const o=[...e];return o.length&&(o[o.length-1]=o[o.length-1]===t-1?0:o[o.length-1]+1),o}prevPositionIndexes(e,t){if(!Array.isArray(e))return[];const o=[...e];return o.length&&(o[o.length-1]=0===o[o.length-1]?t-2:o[o.length-1]-1),o}getPointForPositionIndexes(e,t,o){let n,{features:i}=o;if(Array.isArray(e)){const o=i[t].geometry.coordinates;if(3===e.length){const[t,i,s]=e;o.length&&o[t].length&&(n=o[t][i][s])}else{const[t,i]=e;o.length&&o[t].length&&(n=o[t][i])}}return n}}function Re(e){let{pointerDownScreenCoords:t,screenCoords:o}=e;return 10*(t[1]-o[1])}class ze extends we{makeElevatedEvent(e,t,o){const{minElevation:n=0,maxElevation:i=2e4,calculateElevationChange:s=Re}=o.modeConfig||{};if(!e.pointerDownScreenCoords)return e;let r=3===t.length?t[2]:0;return r+=s({pointerDownScreenCoords:e.pointerDownScreenCoords,screenCoords:e.screenCoords}),r=Math.min(r,i),r=Math.max(r,n),Object.assign({},e,{mapCoords:[t[0],t[1],r]})}handlePointerMove(e,t){const o=ee(e.pointerDownPicks),n=o?o.geometry.coordinates:e.mapCoords;super.handlePointerMove(this.makeElevatedEvent(e,n,t),t)}handleStopDragging(e,t){const o=ee(e.picks),n=o?o.geometry.coordinates:e.mapCoords;super.handleStopDragging(this.makeElevatedEvent(e,n,t),t)}getCursor(e){let t=super.getCursor(e);return"cell"===t&&(t="ns-resize"),t}static calculateElevationChangeWithViewport(e,t){let{pointerDownScreenCoords:o,screenCoords:n}=t;return 156543.03392*Math.cos(e.latitude*Math.PI/180)/Math.pow(2,e.zoom)*(o[1]-n[1])/2}}class Oe extends me{createTentativeFeature(e){const{lastPointerMoveEvent:t}=e;return{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Point",coordinates:(t?[t.mapCoords]:[])[0]}}}handleClick(e,t){let{mapCoords:o}=e;const n={type:"Point",coordinates:o};t.onEdit(this.getAddFeatureAction(n,t.data))}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}}function Ne(e,t){if(e===t)return!0;if(Array.isArray(e)){const o=e.length;if(!t||t.length!==o)return!1;for(let n=0;n<o;n++)if(e[n]!==t[n])return!1;return!0}return!1}function qe(e){let t,o={};return n=>{for(const i in n)if(!Ne(n[i],o[i])){t=e(n),o=n;break}return t}}class Ge extends me{constructor(){super(...arguments),this.dist=0,this.position=null,this.elems=[],this._getTooltips=qe((e=>{let{modeConfig:t,dist:o}=e,n=[];const{formatTooltip:i}=t||{};let s;return o&&(s=i?i(o):"Distance: "+parseFloat(o).toFixed(2)+" kilometers",n=[{position:this.position,text:s}]),n}))}handleClick(e,t){const{picks:o}=e,n=ee(o);let i=!1;n||(this.addClickSequence(e),i=!0);const s=this.getClickSequence();if(n||this.calculateInfoDraw(s),s.length>1&&n&&Array.isArray(n.properties.positionIndexes)&&n.properties.positionIndexes[0]===s.length-1){this.dist=0;const e={type:"LineString",coordinates:[...s]};this.resetClickSequence();const o=this.getAddFeatureAction(e,t.data);o&&t.onEdit(o)}else i&&t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}handleKeyUp(e,t){const{key:o}=e;if("Enter"===o){const e=this.getClickSequence();if(e.length>1){const o={type:"LineString",coordinates:[...e]};this.resetClickSequence();const n=this.getAddFeatureAction(o,t.data);n&&t.onEdit(n)}}else"Escape"===o&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}getGuides(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[],i={type:"FeatureCollection",features:[]};let s;o.length>0&&(s={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...o,...n]}}),s&&i.features.push(s);const r=o.map(((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}})));return i.features.push(...r),i}handlePointerMove(e,t){t.onUpdateCursor("cell")}getTooltips(e){return this._getTooltips({modeConfig:e.modeConfig,dist:this.dist})}calculateInfoDraw(e){e.length>1&&(this.position=e[e.length-1],this.dist+=(0,l.A)(e[e.length-2],e[e.length-1]))}}class Ue extends me{createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[];let i;return 1===o.length||2===o.length?i={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...o,...n]}}:o.length>2&&(i={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[...o,...n,o[0]]]}}),i}getGuides(e){const t=this.getClickSequence(),o={type:"FeatureCollection",features:[]},n=this.createTentativeFeature(e);n&&o.features.push(n);const i=t.map(((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}})));return o.features.push(...i),o}handleClick(e,t){const{picks:o}=e,i=ee(o),s=this.getClickSequence();let r=!1;if(s.length>2&&t.modeConfig&&t.modeConfig.preventOverlappingLines){const t=(0,n.wi)([s[s.length-1],e.mapCoords]),o=(0,n.wi)([...s.slice(0,s.length-1)]);(0,Ie.A)(t,o).features.length>0&&(r=!0)}let a=!1;if(i||r||(this.addClickSequence(e),a=!0),s.length>2&&i&&Array.isArray(i.properties.positionIndexes)&&(0===i.properties.positionIndexes[0]||i.properties.positionIndexes[0]===s.length-1)){const e={type:"Polygon",coordinates:[[...s,s[0]]]};this.resetClickSequence();const o=this.getAddFeatureOrBooleanPolygonAction(e,t);o&&t.onEdit(o)}else a&&t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}handleKeyUp(e,t){if("Enter"===e.key){const e=this.getClickSequence();if(e.length>2){const o={type:"Polygon",coordinates:[[...e,e[0]]]};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(o,t);n&&t.onEdit(n)}}else"Escape"===e.key&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}}class Be extends me{handleClick(e,t){t.modeConfig&&t.modeConfig.dragToDraw||(this.addClickSequence(e),this.checkAndFinishPolygon(t))}handleStartDragging(e,t){t.modeConfig&&t.modeConfig.dragToDraw&&(this.addClickSequence(e),e.cancelPan())}handleStopDragging(e,t){t.modeConfig&&t.modeConfig.dragToDraw&&(this.addClickSequence(e),this.checkAndFinishPolygon(t))}checkAndFinishPolygon(e){const t=this.getClickSequence(),o=this.getTentativeGuide(e);if(t.length>1&&o&&"Polygon"===o.geometry.type){const t={type:"Feature",properties:{shape:o.properties.shape},geometry:{type:"Polygon",coordinates:o.geometry.coordinates}},n=this.getAddFeatureOrBooleanPolygonAction(t,e);this.resetClickSequence(),n&&e.onEdit(n)}}getGuides(e){const{lastPointerMoveEvent:t,modeConfig:o}=e,n=this.getClickSequence(),i={type:"FeatureCollection",features:[]};if(0===n.length||!t)return i;const s=n[0],r=t.mapCoords,a=this.getTwoClickPolygon(s,r,o);return a&&i.features.push({type:"Feature",properties:{shape:a.properties&&a.properties.shape,guideType:"tentative"},geometry:a.geometry}),i}getTwoClickPolygon(e,t,o){return null}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[];let i;return 1===o.length&&(i=this.getTwoClickPolygon(o[0],n[0],e.modeConfig)),i}}class We extends Be{getTwoClickPolygon(e,t,o){const n=(0,s.A)([e[0],e[1],t[0],t[1]]);return n.properties=n.properties||{},n.properties.shape="Rectangle",n}}var Je=o(491);class Ve extends Be{getTwoClickPolygon(e,t,o){const i=[t[0],e[1]],r=[e[0],t[1]],a=(0,l.A)((0,n.zx)(i),(0,n.zx)(e)),d=(0,l.A)((0,n.zx)(r),(0,n.zx)(e)),c=a<=d?a:d,p=a<=d?i:r,h=(0,n.wi)([p,t]),g=(0,Je.A)(h,c).geometry.coordinates,u=(0,s.A)([e[0],e[1],g[0],g[1]]);return u.properties=u.properties||{},u.properties.shape="Square",u}}class Ze extends Be{getTwoClickPolygon(e,t,o){const n=e[0]>t[0]?e[0]+Math.abs(e[0]-t[0]):e[0]-Math.abs(e[0]-t[0]),i=e[1]>t[1]?e[1]+Math.abs(e[1]-t[1]):e[1]-Math.abs(e[1]-t[1]),r=(0,s.A)([n,i,t[0],t[1]]);return r.properties=r.properties||{},r.properties.shape="Rectangle",r}}class Ke extends Be{getTwoClickPolygon(e,t,o){const i=[t[0],e[1]],r=[e[0],t[1]],a=(0,l.A)((0,n.zx)(i),(0,n.zx)(e)),d=(0,l.A)((0,n.zx)(r),(0,n.zx)(e)),c=a<=d?a:d,p=a<=d?i:r,h=(0,n.wi)([p,t]),g=(0,Je.A)(h,c).geometry.coordinates,u=e[0]>g[0]?e[0]+Math.abs(e[0]-g[0]):e[0]-Math.abs(e[0]-g[0]),m=e[1]>g[1]?e[1]+Math.abs(e[1]-g[1]):e[1]-Math.abs(e[1]-g[1]),f=(0,s.A)([u,m,g[0],g[1]]);return f.properties=f.properties||{},f.properties.shape="Square",f}}var Xe=o(6338),Qe=o(999);class Ye extends Be{constructor(){super(...arguments),this.radius=null,this.position=null,this.areaCircle=null,this._getTooltips=qe((e=>{let{modeConfig:t,radius:o,areaCircle:n}=e,i=[];const{formatTooltip:s}=t||{};let r;return o&&n&&(r=s?s(o):"Radius: "+parseFloat(o).toFixed(2)+" kilometers\n      \n Area: "+parseFloat(n).toFixed(2),i=[{position:this.position,text:r}]),i}))}getTwoClickPolygon(e,t,o){const{steps:n=64}=o||{},i={steps:n};this.position=t,n<4&&(console.warn("Minimum steps to draw a circle is 4 "),i.steps=4),this.radius=Math.max((0,l.A)(e,t),.001);const s=(0,Xe.A)(e,this.radius,i);return s.properties=s.properties||{},s.properties.shape="Circle",this.areaCircle=(0,Qe.A)(s),s}getTooltips(e){return this._getTooltips({modeConfig:null==e?void 0:e.modeConfig,radius:this.radius,areaCircle:this.areaCircle})}}class $e extends Be{constructor(){super(...arguments),this.radius=null,this.position=null,this.areaCircle=null,this.diameter=null,this._getTooltips=qe((e=>{let{modeConfig:t,radius:o,areaCircle:n,diameter:i}=e,s=[];const{formatTooltip:r}=t||{};let a;return o&&n&&(a=r?r(o):"Radius: "+parseFloat(o).toFixed(2)+" kilometers\n      \n Area: "+parseFloat(n).toFixed(2)+"\n      \n Diameter: "+parseFloat(i).toFixed(2)+" kilometers",s=[{position:this.position,text:a}]),s}))}getTwoClickPolygon(e,t,o){const{steps:n=64}=o||{},i={steps:n};n<4&&(console.warn("Minimum steps to draw a circle is 4 "),i.steps=4);const s=fe(e,t);this.radius=Math.max((0,l.A)(e,s),.001),this.diameter=Math.max((0,l.A)(e,t),.001),this.position=s;const r=(0,Xe.A)(s,this.radius,i);return r.properties=r.properties||{},r.properties.shape="Circle",this.areaCircle=(0,Qe.A)(r),r}getTooltips(e){return this._getTooltips({modeConfig:e.modeConfig,radius:this.radius,areaCircle:this.areaCircle,diameter:this.diameter})}}var et=o(3416);class tt extends Be{getTwoClickPolygon(e,t,o){const i=Math.min(e[0],t[0]),r=Math.min(e[1],t[1]),a=Math.max(e[0],t[0]),d=Math.max(e[1],t[1]),c=(0,s.A)([i,r,a,d]).geometry.coordinates[0],p=fe(e,t),h=Math.max((0,l.A)((0,n.zx)(c[0]),(0,n.zx)(c[1])),.001),g=Math.max((0,l.A)((0,n.zx)(c[0]),(0,n.zx)(c[3])),.001);return(0,et.A)(p,h,g)}}class ot extends me{handleClick(e,t){this.addClickSequence(e);const o=this.getClickSequence(),n=this.getTentativeGuide(t);if(o.length>2&&n&&"Polygon"===n.geometry.type){const e=this.getAddFeatureOrBooleanPolygonAction(n.geometry,t);this.resetClickSequence(),e&&t.onEdit(e)}}getGuides(e){const{lastPointerMoveEvent:t,modeConfig:o}=e,n=this.getClickSequence(),i={type:"FeatureCollection",features:[]};if(0===n.length)return i;const s=t.mapCoords;if(1===n.length)i.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[0],s]}});else{const e=this.getThreeClickPolygon(n[0],n[1],s,o);e&&i.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:e.geometry})}return i}getThreeClickPolygon(e,t,o,n){return null}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[];let i;return 2===o.length&&(i=this.getThreeClickPolygon(o[0],o[1],n[0],e.modeConfig)),i}}class nt extends ot{getThreeClickPolygon(e,t,o,n){const[i,s]=Q(e,t,o);return{type:"Feature",properties:{shape:"Rectangle"},geometry:{type:"Polygon",coordinates:[[e,t,i,s,e]]}}}}class it extends ot{getThreeClickPolygon(e,t,o,i){const s=fe(e,t),r=Math.max((0,l.A)(s,(0,n.zx)(o)),.001),a=Math.max((0,l.A)(e,t),.001)/2,d={angle:(0,h.A)(e,t)};return(0,et.A)(s,r,a,d)}}class st extends me{createTentativeFeature(e){const t=this.getClickSequence(),{mapCoords:o}=e.lastPointerMoveEvent;let n,i;if(1===t.length)n=o;else{const e=t[t.length-2],i=t[t.length-1];[n]=Q(e,i,o)}return i=t.length<3?{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...t,n]}}:{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[...t,n,t[0]]]}},i}getGuides(e){const t={type:"FeatureCollection",features:[]};if(0===this.getClickSequence().length||!e.lastPointerMoveEvent)return t;const o=this.createTentativeFeature(e);return t.features.push(o),t.features=t.features.concat(ie(o.geometry,-1)),t.features=t.features.slice(0,-1),t}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}handleClick(e,t){const{picks:o}=e,n=this.getTentativeGuide(t);this.addClickSequence(e);const i=this.getClickSequence();if(!n)return;if(3===i.length&&"LineString"===n.geometry.type){const e=n.geometry;i[i.length-1]=e.coordinates[e.coordinates.length-1]}else if(i.length>3&&"Polygon"===n.geometry.type){const e=n.geometry;i[i.length-1]=e.coordinates[0][e.coordinates[0].length-2];const s=ee(o);if(s&&Array.isArray(s.properties.positionIndexes)&&(0===s.properties.positionIndexes[1]||s.properties.positionIndexes[1]===e.coordinates[0].length-3)){const o={type:"Polygon",coordinates:this.finalizedCoordinates([...e.coordinates[0]])};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(o,t);n&&t.onEdit(n)}}const s={screenCoords:[-1,-1],mapCoords:e.mapCoords,picks:[],pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,cancelPan:()=>{},sourceEvent:null};this.handlePointerMove(s,t)}finalizedCoordinates(e){let t=[[...e.slice(0,-2),e[0]]],o=this.getIntermediatePoint([...e]);if(o)t=[[...e.slice(0,-2),o,e[0]]];else{const n=[...e];n.splice(-3,1),o=this.getIntermediatePoint([...n]),o&&(t=[[...e.slice(0,-3),o,e[0]]])}return t}getIntermediatePoint(e){let t=null;if(e.length>4){const[o,i]=[...e],s=(0,h.A)(o,i),r=e[e.length-3],a=e[e.length-4],d=(0,h.A)(r,a),c={first:[],second:[]};[1,2,3].forEach((e=>{const t=s+90*e;c.first.push(t>180?t-360:t);const o=d+90*e;c.second.push(o>180?o-360:o)}));const g=(0,l.A)((0,n.zx)(o),(0,n.zx)(r));[0,1,2].forEach((e=>{const i=(0,n.wi)([o,(0,p.A)(o,g,c.first[e]).geometry.coordinates]);[0,1,2].forEach((e=>{const o=(0,n.wi)([r,(0,p.A)(r,g,c.second[e]).geometry.coordinates]),s=(0,Ie.A)(i,o);s&&s.features.length&&(t=s.features[0].geometry.coordinates)}))}))}return t}}var rt=o(8550),at=o.n(rt);class lt extends Ue{constructor(){super(...arguments),this.handleDraggingThrottled=null}handleClick(e,t){}handleStartDragging(e,t){e.cancelPan(),t.modeConfig&&t.modeConfig.throttleMs?this.handleDraggingThrottled=at()(this.handleDraggingAux,t.modeConfig.throttleMs):this.handleDraggingThrottled=this.handleDraggingAux}handleStopDragging(e,t){this.addClickSequence(e);const o=this.getClickSequence();if(this.handleDraggingThrottled&&this.handleDraggingThrottled.cancel&&this.handleDraggingThrottled.cancel(),o.length>2){const e={type:"Polygon",coordinates:[[...o,o[0]]]},n=this.getAddFeatureOrBooleanPolygonAction(e,t);n&&t.onEdit(n)}this.resetClickSequence()}handleDraggingAux(e,t){const{picks:o}=e;ee(o)||(this.addClickSequence(e),t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}}))}handleDragging(e,t){this.handleDraggingThrottled&&this.handleDraggingThrottled(e,t)}handleKeyUp(e,t){if("Enter"===e.key){const e=this.getClickSequence();if(e.length>2){const o={type:"Polygon",coordinates:[[...e,e[0]]]};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(o,t);n&&t.onEdit(n)}}else"Escape"===e.key&&(this.resetClickSequence(),this.handleDraggingThrottled&&(this.handleDraggingThrottled=null),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}}class dt extends me{constructor(e){super(),this._handler=e}_getSnappedMouseEvent(e,t,o){return Object.assign(e,{mapCoords:o.geometry.coordinates,pointerDownMapCoords:t&&t.geometry.coordinates})}_getPickedSnapTarget(e){return ne(e).find((e=>"snap-target"===e.properties.editHandleType))}_getPickedSnapSource(e){return ne(e).find((e=>"snap-source"===e.properties.editHandleType))}_getUpdatedSnapSourceHandle(e,t){const{featureIndex:o,positionIndexes:n}=e.properties;if(!Array.isArray(n))return e;const i=t.features[o],s=n.reduce(((e,t)=>e[t]),i.geometry.coordinates);return{...e,geometry:{type:"Point",coordinates:s}}}_getSnapTargets(e){let{additionalSnapTargets:t}=e.modeConfig||{};t=t||[];return[...e.data.features,...t]}_getSnapTargetHandles(e){const t=[],o=this._getSnapTargets(e);for(let n=0;n<o.length;n++){if(!e.selectedIndexes.includes(n)){const{geometry:e}=o[n];t.push(...ie(e,n,"snap-target"))}}return t}getGuides(e){const{modeConfig:t,lastPointerMoveEvent:o}=e,{enableSnapping:n}=t||{},i={type:"FeatureCollection",features:[...this._handler.getGuides(e).features]};if(!n)return i;const s=o&&this._getPickedSnapSource(o.pointerDownPicks);if(s)return i.features.push(...this._getSnapTargetHandles(e),this._getUpdatedSnapSourceHandle(s,e.data)),i;const{features:r}=e.data;for(const a of e.selectedIndexes)if(a<r.length){const{geometry:e}=r[a];i.features.push(...ie(e,a,"snap-source"))}return i}_getSnapAwareEvent(e,t){const o=this._getPickedSnapSource(t.lastPointerMoveEvent.pointerDownPicks),n=this._getPickedSnapTarget(e.picks);return o&&n?this._getSnappedMouseEvent(e,o,n):e}handleStartDragging(e,t){this._handler.handleStartDragging(e,t)}handleStopDragging(e,t){this._handler.handleStopDragging(this._getSnapAwareEvent(e,t),t)}handleDragging(e,t){this._handler.handleDragging(this._getSnapAwareEvent(e,t),t)}handlePointerMove(e,t){this._handler.handlePointerMove(this._getSnapAwareEvent(e,t),t)}}class ct extends me{constructor(e){super(),this._modes=e}_coalesce(e,t){void 0===t&&(t=null);let o=null;for(let n=0;n<this._modes.length&&(o=e(this._modes[n]),!(t?t(o):o));n++);return o}handleClick(e,t){this._coalesce((o=>o.handleClick(e,t)))}handlePointerMove(e,t){return this._coalesce((o=>o.handlePointerMove(e,t)))}handleStartDragging(e,t){return this._coalesce((o=>o.handleStartDragging(e,t)))}handleStopDragging(e,t){return this._coalesce((o=>o.handleStopDragging(e,t)))}handleDragging(e,t){return this._coalesce((o=>o.handleDragging(e,t)))}getGuides(e){const t=[];for(const o of this._modes)t.push(...o.getGuides(e).features);return{type:"FeatureCollection",features:t}}}class pt extends ct{constructor(){super([new Se,new Fe,new De])}handlePointerMove(e,t){let o=null;super.handlePointerMove(e,{...t,onUpdateCursor:e=>{o=e||o}}),t.onUpdateCursor(o)}handleStartDragging(e,t){let o=null,n=null;const i=[];this._modes.forEach((e=>{e instanceof Se?n=e:(e instanceof Fe&&(o=e),i.push(e))})),o instanceof Fe&&!o.isEditHandleSelected()&&i.push(n),i.filter(Boolean).forEach((o=>o.handleStartDragging(e,t)))}getGuides(e){let t=super.getGuides(e);const o=(this._modes||[]).find((e=>e instanceof De));if(o instanceof De){const e=t.features.filter((e=>{const{editHandleType:t,mode:n}=e.properties||{},i=[n];return o.getIsRotating()&&i.push(t),!i.includes("scale")}));t=(0,n.Lr)(e)}return t}}const ht=["anyclick","pointermove","panstart","panmove","panend","keyup"];class gt extends m.A{constructor(){super(...arguments),this.state=void 0}onLayerClick(e){}onStartDragging(e){}onStopDragging(e){}onDragging(e){}onPointerMove(e){}onLayerKeyUp(e){}initializeState(){this.setState({_editableLayerState:{pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,eventHandler:this._forwardEventToCurrentLayer.bind(this)}}),this._addEventHandlers()}finalizeState(){this._removeEventHandlers()}_addEventHandlers(){const{eventManager:e}=this.context.deck,{eventHandler:t}=this.state._editableLayerState;for(const o of ht)e.on(o,t,{priority:100})}_removeEventHandlers(){const{eventManager:e}=this.context.deck,{eventHandler:t}=this.state._editableLayerState;for(const o of ht)e.off(o,t)}_forwardEventToCurrentLayer(e){const t=this.getCurrentLayer(),o=t["_on"+e.type].bind(t);o?o(e):console.warn("no handler for mjolnir.js event "+e.type)}_onanyclick(e){let{srcEvent:t}=e;const o=this.getScreenCoords(t),n=this.getMapCoords(o),i=this.getPicks(o);this.onLayerClick({mapCoords:n,screenCoords:o,picks:i,sourceEvent:t})}_onkeyup(e){let{srcEvent:t}=e;this.onLayerKeyUp(t)}_onpanstart(e){const t=this.getScreenCoords(e.srcEvent),o=this.getMapCoords(t),n=this.getPicks(t);this.setState({_editableLayerState:{...this.state._editableLayerState,pointerDownScreenCoords:t,pointerDownMapCoords:o,pointerDownPicks:n}}),this.onStartDragging({picks:n,screenCoords:t,mapCoords:o,pointerDownScreenCoords:t,pointerDownMapCoords:o,cancelPan:e.stopImmediatePropagation,sourceEvent:e.srcEvent})}_onpanmove(e){const{srcEvent:t}=e,o=this.getScreenCoords(t),n=this.getMapCoords(o),{pointerDownPicks:i,pointerDownScreenCoords:s,pointerDownMapCoords:r}=this.state._editableLayerState,a=this.getPicks(o);this.onDragging({screenCoords:o,mapCoords:n,picks:a,pointerDownPicks:i,pointerDownScreenCoords:s,pointerDownMapCoords:r,sourceEvent:t,cancelPan:e.stopImmediatePropagation})}_onpanend(e){let{srcEvent:t}=e;const o=this.getScreenCoords(t),n=this.getMapCoords(o),{pointerDownPicks:i,pointerDownScreenCoords:s,pointerDownMapCoords:r}=this.state._editableLayerState,a=this.getPicks(o);this.onStopDragging({picks:a,screenCoords:o,mapCoords:n,pointerDownPicks:i,pointerDownScreenCoords:s,pointerDownMapCoords:r,sourceEvent:t}),this.setState({_editableLayerState:{...this.state._editableLayerState,pointerDownScreenCoords:null,pointerDownMapCoords:null,pointerDownPicks:null}})}_onpointermove(e){const{srcEvent:t}=e,o=this.getScreenCoords(t),n=this.getMapCoords(o),{pointerDownPicks:i,pointerDownScreenCoords:s,pointerDownMapCoords:r}=this.state._editableLayerState,a=this.getPicks(o);this.onPointerMove({screenCoords:o,mapCoords:n,picks:a,pointerDownPicks:i,pointerDownScreenCoords:s,pointerDownMapCoords:r,sourceEvent:t,cancelPan:e.stopImmediatePropagation})}getPicks(e){return this.context.deck.pickMultipleObjects({x:e[0],y:e[1],layerIds:[this.props.id],radius:this.props.pickingRadius,depth:this.props.pickingDepth})}getScreenCoords(e){return[e.clientX-this.context.gl.canvas.getBoundingClientRect().left,e.clientY-this.context.gl.canvas.getBoundingClientRect().top]}getMapCoords(e){return this.context.viewport.unproject([e[0],e[1]])}}gt.layerName="EditableLayer";const ut={...P.A.defaultProps,pickingLineWidthExtraPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER}};class mt extends P.A{getShaders(){var e;const t=super.getShaders();return t.vs=function(e,t,o){const n=e.indexOf(t);return n<0?e:e.slice(0,n)+o+e.slice(n)}(t.vs,"vec3 width;","\n       if(bool(picking.isActive)){\n        widthPixels.xy += pickingLineWidthExtraPixels;\n       }\n      "),{...t,inject:{...t.inject||{},"vs:#decl":((null==(e=t.inject)?void 0:e["vs:#decl"])||"").concat("uniform float pickingLineWidthExtraPixels;")}}}draw(e){super.draw({...e,uniforms:{...e.uniforms,pickingLineWidthExtraPixels:this.props.pickingLineWidthExtraPixels}})}}mt.defaultProps=ut,mt.layerName="EditablePathLayer";const ft=[0,0,0,153],yt=[0,0,0,144],xt=[0,0,0,255],Ct=[0,0,144,144],vt=[144,144,144,255],Pt=[144,144,144,144],bt=[192,0,0,255],St=[0,0,0,128],wt=[124,0,192,255],kt=[255,255,255,255],At=Ue;function Mt(e){return e&&"function"==typeof e?t=>e(function(e){if(e.__source)return e.__source.object;if(e.sourceFeature)return e.sourceFeature.feature;return e}(t)):e}function Ft(e){switch(e.properties.editHandleType){case"existing":return bt;case"snap-source":return wt;default:return St}}const Tt={mode:At,onEdit:()=>{},pickable:!0,pickingRadius:10,pickingDepth:5,fp64:!1,filled:!0,stroked:!0,lineWidthScale:w,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,pickingLineWidthExtraPixels:0,lineWidthUnits:"pixels",lineJointRounded:!1,lineCapRounded:!1,lineMiterLimit:4,pointRadiusScale:1,pointRadiusMinPixels:2,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:(e,t,o)=>t?xt:ft,getFillColor:(e,t,o)=>t?Ct:yt,getRadius:e=>e&&e.properties&&e.properties.radius||e&&e.properties&&e.properties.size||1,getLineWidth:e=>e&&e.properties&&e.properties.lineWidth||3,getTentativeLineColor:e=>vt,getTentativeFillColor:e=>Pt,getTentativeLineWidth:e=>e&&e.properties&&e.properties.lineWidth||3,editHandleType:"point",editHandlePointRadiusScale:1,editHandlePointOutline:!0,editHandlePointStrokeWidth:2,editHandlePointRadiusUnits:"pixels",editHandlePointRadiusMinPixels:4,editHandlePointRadiusMaxPixels:8,getEditHandlePointColor:Ft,getEditHandlePointOutlineColor:function(e){return kt},getEditHandlePointRadius:function(e){switch(e.properties.editHandleType){case"existing":return 5;case"snap":return 7;default:return 3}},editHandleIconAtlas:null,editHandleIconMapping:null,editHandleIconSizeScale:1,editHandleIconSizeUnits:"pixels",getEditHandleIcon:e=>e.properties.editHandleType,getEditHandleIconSize:10,getEditHandleIconColor:Ft,getEditHandleIconAngle:0,billboard:!0},Dt={view:ye,modify:we,translate:new dt(new Se),transform:new dt(new pt),scale:Fe,rotate:De,duplicate:Ee,split:Le,extrude:He,elevation:ze,drawPoint:Oe,drawLineString:Ge,drawPolygon:Ue,drawRectangle:We,drawSquare:Ve,drawRectangleFromCenter:Ze,drawSquareFromCenter:Ke,drawCircleFromCenter:Ye,drawCircleByBoundingBox:$e,drawEllipseByBoundingBox:tt,drawRectangleUsing3Points:nt,drawEllipseUsing3Points:it,draw90DegreePolygon:st,drawPolygonByDragging:lt};class Et extends gt{constructor(){super(...arguments),this.state=void 0}renderLayers(){const e=this.getSubLayerProps({id:"geojson",data:this.props.data,fp64:this.props.fp64,filled:this.props.filled,stroked:this.props.stroked,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,pointRadiusScale:this.props.pointRadiusScale,pointRadiusMinPixels:this.props.pointRadiusMinPixels,pointRadiusMaxPixels:this.props.pointRadiusMaxPixels,getLineColor:this.selectionAwareAccessor(this.props.getLineColor),getFillColor:this.selectionAwareAccessor(this.props.getFillColor),getPointRadius:this.selectionAwareAccessor(this.props.getRadius),getLineWidth:this.selectionAwareAccessor(this.props.getLineWidth),_subLayerProps:{linestrings:{billboard:this.props.billboard,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}},"polygons-stroke":{billboard:this.props.billboard,pickingLineWidthExtraPixels:this.props.pickingLineWidthExtraPixels,type:mt,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}}},updateTriggers:{getLineColor:[this.props.selectedFeatureIndexes,this.props.mode],getFillColor:[this.props.selectedFeatureIndexes,this.props.mode],getPointRadius:[this.props.selectedFeatureIndexes,this.props.mode],getLineWidth:[this.props.selectedFeatureIndexes,this.props.mode]}});let t=[new U.A(e)];return t=t.concat(this.createGuidesLayers(),this.createTooltipsLayers()),t}initializeState(){super.initializeState(),this.setState({selectedFeatures:[],editHandles:[]})}shouldUpdateState(e){return super.shouldUpdateState(e)||e.changeFlags.stateChanged}updateState(e){let{props:t,oldProps:o,changeFlags:n,context:i}=e;if(super.updateState({oldProps:o,props:t,changeFlags:n,context:i}),n.propsOrDataChanged){if(0===Object.keys(o).length||t.mode!==o.mode){let e;if("function"==typeof t.mode){e=new(0,t.mode)}else"string"==typeof t.mode?(e=Dt[t.mode],console.warn("Deprecated use of passing `mode` as a string. Pass the mode's class constructor instead.")):e=t.mode;e||(console.warn("No mode configured for "+String(t.mode)),e=new At),e!==this.state.mode&&this.setState({mode:e,cursor:null})}}let s=[];if(Array.isArray(t.selectedFeatureIndexes)&&"object"==typeof t.data&&"features"in t.data){const e=t.data;s=t.selectedFeatureIndexes.map((t=>e.features[t]))}this.setState({selectedFeatures:s})}getModeProps(e){return{modeConfig:e.modeConfig,data:e.data,selectedIndexes:e.selectedFeatureIndexes,lastPointerMoveEvent:this.state.lastPointerMoveEvent,cursor:this.state.cursor,onEdit:t=>{this.setNeedsUpdate(),e.onEdit(t)},onUpdateCursor:e=>{this.setState({cursor:e})}}}selectionAwareAccessor(e){return"function"!=typeof e?e:t=>e(t,this.isFeatureSelected(t),this.props.mode)}isFeatureSelected(e){return!(!this.props.data||!this.props.selectedFeatureIndexes)&&(!!this.props.selectedFeatureIndexes.length&&this.state.selectedFeatures.includes(e))}getPickingInfo(e){let{info:t,sourceLayer:o}=e;return o.id.endsWith("guides")&&(t.isGuide=!0),t}_updateAutoHighlight(e){if(null!=e&&e.sourceLayer)if(e.isGuide)for(const t of e.sourceLayer.getSubLayers())t.updateAutoHighlight(e);else e.sourceLayer.updateAutoHighlight(e)}createGuidesLayers(){const e=this.getActiveMode().getGuides(this.getModeProps(this.props));if(!e||!e.features.length)return[];const t={linestrings:{billboard:this.props.billboard,autoHighlight:!1},"polygons-fill":{autoHighlight:!1},"polygons-stroke":{billboard:this.props.billboard}};"icon"===this.props.editHandleType?t["points-icon"]={type:B.A,iconAtlas:this.props.editHandleIconAtlas,iconMapping:this.props.editHandleIconMapping,sizeUnits:this.props.editHandleIconSizeUnits,sizeScale:this.props.editHandleIconSizeScale,getIcon:Mt(this.props.getEditHandleIcon),getSize:Mt(this.props.getEditHandleIconSize),getColor:Mt(this.props.getEditHandleIconColor),getAngle:Mt(this.props.getEditHandleIconAngle),billboard:this.props.billboard}:t["points-circle"]={type:f.A,radiusScale:this.props.editHandlePointRadiusScale,stroked:this.props.editHandlePointOutline,getLineWidth:this.props.editHandlePointStrokeWidth,radiusUnits:this.props.editHandlePointRadiusUnits,radiusMinPixels:this.props.editHandlePointRadiusMinPixels,radiusMaxPixels:this.props.editHandlePointRadiusMaxPixels,getRadius:Mt(this.props.getEditHandlePointRadius),getFillColor:Mt(this.props.getEditHandlePointColor),getLineColor:Mt(this.props.getEditHandlePointOutlineColor),billboard:this.props.billboard};return[new U.A(this.getSubLayerProps({id:"guides",data:e,fp64:this.props.fp64,_subLayerProps:t,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,getLineColor:Mt(this.props.getTentativeLineColor),getLineWidth:Mt(this.props.getTentativeLineWidth),getFillColor:Mt(this.props.getTentativeFillColor),pointType:"icon"===this.props.editHandleType?"icon":"circle",iconAtlas:this.props.editHandleIconAtlas}))]}createTooltipsLayers(){const e=this.getActiveMode().getTooltips(this.getModeProps(this.props));return[new x.A({getSize:21.333333333333332,...this.getSubLayerProps({id:"tooltips",data:e})})]}onLayerClick(e){this.getActiveMode().handleClick(e,this.getModeProps(this.props))}onLayerKeyUp(e){this.getActiveMode().handleKeyUp(e,this.getModeProps(this.props))}onStartDragging(e){this.getActiveMode().handleStartDragging(e,this.getModeProps(this.props))}onDragging(e){this.getActiveMode().handleDragging(e,this.getModeProps(this.props))}onStopDragging(e){this.getActiveMode().handleStopDragging(e,this.getModeProps(this.props))}onPointerMove(e){this.setState({lastPointerMoveEvent:e}),this.getActiveMode().handlePointerMove(e,this.getModeProps(this.props))}getCursor(e){let{isDragging:t}=e;if(null===this.state||void 0===this.state)return null;let{cursor:o}=this.state;return o||(o=t?"grabbing":"grab"),o}getActiveMode(){return this.state.mode}}Et.layerName="EditableGeoJsonLayer",Et.defaultProps=Tt;var jt=o(2448);const It={type:"FeatureCollection",features:[]},_t={mode:ye,...Et.defaultProps,data:[],selectedIndexes:[],filled:!1,stroked:!0,lineWidthScale:w,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineWidthUnits:"pixels",getHexagons:e=>e.hexIds,getEditedCluster:(e,t)=>t?{...t,hexIds:e}:{hexIds:e},resolution:9};class Lt extends gt{constructor(){super(...arguments),this.state=void 0}initializeState(){super.initializeState(),this.setState({tentativeHexagonIDs:[]})}getDerivedHexagonIDs(e){throw new Error("not implemented")}getDerivedHexagonID(e){throw new Error("not implemented")}renderLayers(){return[new Et(this.getSubLayerProps({id:"editable-geojson",mode:this.props.mode,data:It,selectedFeatureIndexes:[],onEdit:e=>{const{editType:t,editContext:o}=e;switch(t){case"updateTentativeFeature":if("Polygon"===o.feature.geometry.type){const e=o.feature.geometry.coordinates,t=this.getDerivedHexagonIDs(e);this.setState({tentativeHexagonIDs:t})}else if("Point"===o.feature.geometry.type){const e=o.feature.geometry.coordinates,t=this.getDerivedHexagonID(e);this.setState({tentativeHexagonIDs:[t]})}break;case"addFeature":const e=[...this.props.data],{modeConfig:t}=this.props;if(t&&t.booleanOperation)if(1!==this.props.selectedIndexes.length)console.warn("booleanOperation only supported for single cluster selection");else{let o;const n=new Set(this.getSelectedHexIDs()),i=new Set(this.state.tentativeHexagonIDs);switch(t.booleanOperation){case"union":default:o=[...new Set([...n,...i])];break;case"intersection":o=[...n].filter((e=>i.has(e)));break;case"difference":o=[...n].filter((e=>!i.has(e)))}const s=this.props.selectedIndexes[0],r=this.props.data[s];e[s]=this.props.getEditedCluster(o,r)}else e.push(this.props.getEditedCluster(this.state.tentativeHexagonIDs,null));this.setState({tentativeHexagonIDs:[]}),this.props.onEdit({updatedData:e})}}})),new jt.A(this.getSubLayerProps({id:"hexagons",data:this.props.data,getHexagons:this.props.getHexagons})),new jt.A(this.getSubLayerProps({id:"tentative-hexagons",data:[{hexIds:this.state.tentativeHexagonIDs}],getHexagons:e=>e.hexIds}))]}getSelectedHexIDs(){let e=[];return this.props.selectedIndexes.forEach((t=>{const o=this.props.data[t],n=this.props.getHexagons(o);e=e.concat(n)})),e}getCursor(e){let{isDragging:t}=e,{cursor:o}=this.state||{};return o||(o=t?"grabbing":"grab"),o}}Lt.layerName="EditableH3ClusterLayer",Lt.defaultProps=_t;var Ht=o(9751);const Rt="rectangle",zt="polygon",Ot={[Rt]:We,[zt]:Ue},Nt={[Rt]:{dragToDraw:!0}},qt={selectionType:Rt,layerIds:[],onSelect:()=>{}},Gt={type:"FeatureCollection",features:[]},Ut="selection-blocker",Bt=["lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","lineWidthUnits","lineJointRounded","lineCapRounded","lineMiterLimit","pointRadiusScale","pointRadiusMinPixels","pointRadiusMaxPixels","lineDashJustified","getLineColor","getFillColor","getRadius","getLineWidth","getLineDashArray","getTentativeLineDashArray","getTentativeLineColor","getTentativeFillColor","getTentativeLineWidth"];class Wt extends m.A{constructor(){super(...arguments),this.state=void 0}_selectRectangleObjects(e){const{layerIds:t,onSelect:o}=this.props,[n,i]=this.context.viewport.project(e[0][0]),[s,r]=this.context.viewport.project(e[0][2]);o({pickingInfos:this.context.deck.pickObjects({x:Math.min(n,s),y:Math.min(i,r),width:Math.abs(s-n),height:Math.abs(r-i),layerIds:t})})}_selectPolygonObjects(e){const{layerIds:t,onSelect:o}=this.props,i=e[0].map((e=>this.context.viewport.project(e))),s=i.map((e=>e[0])),l=i.map((e=>e[1])),d=Math.min(...s),c=Math.min(...l),p=Math.max(...s),h=Math.max(...l),g=(0,n.n1)(e),u=(0,r.A)(g,50);let m;try{m=(0,a.A)(u,g)}catch(y){return void console.log("turfDifference() error",y)}this.setState({pendingPolygonSelection:{bigPolygon:m}});const f=this.props.id+"-"+Ut;setTimeout((()=>{const e=this.context.deck.pickObjects({x:d,y:c,width:p-d,height:h-c,layerIds:[f,...t]});o({pickingInfos:e.filter((e=>e.layer.id!==this.props.id))})}),250)}renderLayers(){const{pendingPolygonSelection:e}=this.state,t=Ot[this.props.selectionType]||ye,o=Nt[this.props.selectionType],n={};Bt.forEach((e=>{void 0!==this.props[e]&&(n[e]=this.props[e])}));const i=[new Et(this.getSubLayerProps({id:"selection-geojson",pickable:!0,mode:t,modeConfig:o,selectedFeatureIndexes:[],data:Gt,onEdit:e=>{let{updatedData:t,editType:o}=e;if("addFeature"===o){const{coordinates:e}=t.features[0].geometry;this.props.selectionType===Rt?this._selectRectangleObjects(e):this.props.selectionType===zt&&this._selectPolygonObjects(e)}},...n}))];if(e){const{bigPolygon:t}=e;i.push(new Ht.A(this.getSubLayerProps({id:Ut,pickable:!0,stroked:!1,opacity:1,data:[t],getLineColor:e=>[0,0,0,1],getFillColor:e=>[0,0,0,1],getPolygon:e=>e.geometry.coordinates})))}return i}shouldUpdateState(e){let{changeFlags:{stateChanged:t,propsOrDataChanged:o}}=e;return t||o}}Wt.layerName="SelectionLayer",Wt.defaultProps=qt;var Jt=o(772);class Vt extends m.A{renderLayers(){return[new f.A(Object.assign({},this.props,{id:this.props.id+"-ScatterplotLayer",data:this.props.data})),new Jt.A(Object.assign({},this.props,{id:this.props.id+"-LineLayer",data:this.props.data,pickable:!1,getSourcePosition:e=>{let{position:t}=e;return[t[0],t[1],0]},getTargetPosition:e=>{let{position:t}=e;return[t[0],t[1],t[2]||0]},getColor:[150,150,150,200],getStrokeWidth:3}))]}}Vt.layerName="ElevatedEditHandleLayer",Vt.defaultProps={};class Zt extends me{constructor(){super(...arguments),this._isResizing=!1}getGuides(e){const t=[],o=e.selectedIndexes,{lastPointerMoveEvent:i}=e,s=i&&i.picks,r=i&&i.mapCoords;if(s&&s.length&&r&&1===o.length&&!this._isResizing){const o=s.find((e=>!e.isGuide));if(o&&o.object.properties.shape&&o.object.properties.shape.includes("Circle")&&e.selectedIndexes.includes(o.index)){let i=null,s=[];const a=(0,n.zx)(r);if(X(o.object.geometry.coordinates,[],((t,o)=>{const r=(0,n.wi)(t),l=this.getNearestPoint(r,a,e.modeConfig&&e.modeConfig.viewport);(!i||l.properties.dist<i.properties.dist)&&(i=l,s=o)})),i){const{geometry:{coordinates:e},properties:{index:n}}=i;t.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:o.index,positionIndexes:[...s,n+1]},geometry:{type:"Point",coordinates:e}})}}}return{type:"FeatureCollection",features:t}}getNearestPoint(e,t,o){const{coordinates:n}=e.geometry;if(n.some((e=>e.length>2))){if(o)return $(e,t,o);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return(0,_e.A)(e,t)}handleDragging(e,t){const o=ee(e.pointerDownPicks);if(o){e.cancelPan();const n=o.properties,i=this.getSelectedFeature(t),s=(0,Ce.A)(i).geometry.coordinates,r=Object.entries(i.geometry.coordinates[0]).length-1,a=Math.max((0,l.A)(s,e.mapCoords),.001),{steps:d=r}={},c={steps:d},p=(0,Xe.A)(s,a,c).geometry,h=new ae(t.data).replaceGeometry(n.featureIndex,p).getObject();t.onEdit({updatedData:h,editType:"unionGeometry",editContext:{featureIndexes:[n.featureIndex]}})}}handlePointerMove(e,t){if(!this._isResizing){const t=ee(e.picks);this._selectedEditHandle=t&&"intermediate"===t.properties.editHandleType?t:null}const o=this.getCursor(e);t.onUpdateCursor(o)}handleStartDragging(e,t){this._selectedEditHandle&&(this._isResizing=!0)}handleStopDragging(e,t){this._isResizing&&(this._selectedEditHandle=null,this._isResizing=!1)}getCursor(e){return ne(e&&e.picks||[]).length?"cell":null}}class Kt extends me{getSingleSelectedLineString(e){const t=this.getSelectedGeometry(e);return t&&"LineString"===t.type?t:null}handleClick(e,t){const{selectedIndexes:o}=t,n=this.getSingleSelectedLineString(t);if(!n)return void console.warn("ExtendLineStringMode only supported for single LineString selection");let i=[n.coordinates.length];const s=t.modeConfig;s&&s.drawAtFront&&(i=[0]);const r=o[0],a=new ae(t.data).addPosition(r,i,e.mapCoords).getObject();t.onEdit({updatedData:a,editType:"addPosition",editContext:{featureIndexes:[r],positionIndexes:i,position:e.mapCoords}})}getGuides(e){const t={type:"FeatureCollection",features:[]},o=this.getSingleSelectedLineString(e);if(!o)return t;const n=e.lastPointerMoveEvent&&e.lastPointerMoveEvent.mapCoords;let i=null;const{modeConfig:s}=e;return i=s&&s.drawAtFront?o.coordinates[0]:o.coordinates[o.coordinates.length-1],t.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[i,n]}}),t}handlePointerMove(e,t){t.onUpdateCursor("cell")}}var Xt=o(3922);class Qt extends me{constructor(){super(...arguments),this._isMeasuringSessionFinished=!1,this._currentTooltips=[],this._currentDistance=0,this._calculateDistanceForTooltip=e=>{let{positionA:t,positionB:o,modeConfig:n}=e;const{turfOptions:i,measurementCallback:s}=n||{},r=(0,l.A)(t,o,i);return s&&s(r),r}}_formatTooltip(e,t){const{formatTooltip:o,turfOptions:n}=t||{},i=n&&n.units||"kilometers";let s;return s=o?o(e):parseFloat(e).toFixed(2)+" "+i,s}handleClick(e,t){const{modeConfig:o,data:n,onEdit:i}=t,{centerTooltipsOnLine:s=!1}=o||{};this._isMeasuringSessionFinished&&(this._isMeasuringSessionFinished=!1,this.resetClickSequence(),this._currentTooltips=[],this._currentDistance=0);const{picks:r}=e,a=ee(r);let l=!1;a||(this.addClickSequence(e),l=!0);const d=this.getClickSequence();if(d.length>1&&a&&Array.isArray(a.properties.positionIndexes)&&a.properties.positionIndexes[0]===d.length-1)this._isMeasuringSessionFinished=!0;else if(l){if(d.length>1){this._currentDistance+=this._calculateDistanceForTooltip({positionA:d[d.length-2],positionB:d[d.length-1],modeConfig:o});const t=s?(0,Xt.A)(d[d.length-2],d[d.length-1]).geometry.coordinates:e.mapCoords;this._currentTooltips.push({position:t,text:this._formatTooltip(this._currentDistance,o)})}i({updatedData:n,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}}handleKeyUp(e,t){if(this._isMeasuringSessionFinished)return;e.stopPropagation();const{key:o}=e,n=this.getClickSequence().length;switch(o){case"Escape":this._isMeasuringSessionFinished=!0,1===n&&(this.resetClickSequence(),this._currentTooltips=[]),t.onUpdateCursor("cell");break;case"Enter":this.handleClick(t.lastPointerMoveEvent,t),this._isMeasuringSessionFinished=!0}}getGuides(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t&&!this._isMeasuringSessionFinished?[t.mapCoords]:[],i={type:"FeatureCollection",features:[]};o.length>0&&i.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...o,...n]}});const s=o.map(((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}})));return i.features.push(...s),i}handlePointerMove(e,t){t.onUpdateCursor("cell")}getTooltips(e){const{lastPointerMoveEvent:t,modeConfig:o}=e,{centerTooltipsOnLine:n=!1}=o||{},i=this.getClickSequence();if(i.length>0&&t&&!this._isMeasuringSessionFinished){const s=this._calculateDistanceForTooltip({positionA:i[i.length-1],positionB:t.mapCoords,modeConfig:e.modeConfig}),r=n?(0,Xt.A)(i[i.length-1],t.mapCoords).geometry.coordinates:t.mapCoords;return[...this._currentTooltips,{position:r,text:this._formatTooltip(this._currentDistance+s,o)}]}return this._currentTooltips}}const Yt=[];class $t extends Ue{handleClick(e,t){const o={...t,onEdit:()=>{}};super.handleClick(e,o)}handleKeyUp(e,t){const o={...t,onEdit:()=>{}};super.handleKeyUp(e,o)}getTooltips(e){const t=this.getTentativeGuide(e);if(t&&"Polygon"===t.geometry.type){const{modeConfig:o}=e,{formatTooltip:n,measurementCallback:i}=o||{},s="sq. m",r=(0,ke.A)(t),a=(0,Qe.A)(t);let l;return l=n?n(a):parseFloat(a).toFixed(2)+" "+s,i&&i(a),[{position:r.geometry.coordinates,text:l}]}return Yt}}const eo=[];class to extends me{constructor(){super(...arguments),this._getTooltips=qe((e=>{let{modeConfig:t,vertex:o,point1:n,point2:i}=e,s=eo;if(o&&n&&i){const{formatTooltip:e,measurementCallback:r}=t||{},a="deg",l=(0,h.A)(o,n),d=(0,h.A)(o,i);let c,p=Math.abs(l-d);p>180&&(p=360-p),c=e?e(p):parseFloat(p).toFixed(2)+" "+a,r&&r(p);s=[{position:(0,Ce.A)({type:"FeatureCollection",features:[n,i].map((e=>({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{}})))}).geometry.coordinates,text:c}]}return s}))}handleClick(e,t){this.getClickSequence().length>=3&&this.resetClickSequence(),this.addClickSequence(e)}handlePointerMove(e,t){t.onUpdateCursor("cell")}getPoints(e){const t=this.getClickSequence(),o=[...t];return t.length<3&&e.lastPointerMoveEvent&&o.push(e.lastPointerMoveEvent.mapCoords),o}getGuides(e){const t={type:"FeatureCollection",features:[]},{features:o}=t,n=this.getPoints(e);return n.length>2?o.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[1],n[0],n[2]]}}):n.length>1&&o.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[1],n[0]]}}),t}getTooltips(e){const t=this.getPoints(e);return this._getTooltips({modeConfig:e.modeConfig,vertex:t[0],point1:t[1],point2:t[2]})}}},676:(e,t,o)=>{o.d(t,{Ys:()=>N,ww:()=>Z,xv:()=>j});var n=o(6540),i=o(3724);const s=e=>"@media screen and (max-width: 480px)",r=i.Ay.div.withConfig({displayName:"styled__PanelContainer",componentId:"sc-oqnqzc-0"})(["font-size:14px;position:absolute;top:0;right:0;width:344px;background:var(--ifm-background-surface-color);box-shadow:var(--ifm-global-shadow-lw);margin:24px;padding:10px 24px;max-height:96%;overflow-x:hidden;overflow-y:auto;overflow-y:overlay;outline:none;z-index:1;","{width:auto;left:0;}"],s),a=i.Ay.div.withConfig({displayName:"styled__PanelExpander",componentId:"sc-oqnqzc-1"})(["display:none;width:16px;height:16px;font-family:serif;font-size:0.8em;text-align:center;line-height:16px;border-radius:50%;background:",";color:",";","{display:block;}"],(e=>e.$expanded?"none":"var(--ifm-color-gray-900)"),(e=>e.$expanded?"var(--ifm-color-black)":"var(--ifm-color-white)"),s),l=i.Ay.div.withConfig({displayName:"styled__PanelTitle",componentId:"sc-oqnqzc-2"})(["display:flex;align-items:center;justify-content:space-between;font:bold 1.25em var(--ifm-font-family-base);margin:8px 0;","{cursor:pointer;}"],s),d=i.Ay.div.withConfig({displayName:"styled__PanelContent",componentId:"sc-oqnqzc-3"})(["div > *{vertical-align:middle;white-space:nowrap;}div > label{display:inline-block;width:40%;margin-right:10%;color:var(--ifm-color-content-secondary);margin-top:2px;margin-bottom:2px;}div > input,div > a,div > button,div > select{font:normal 11px/16px var(--ifm-font-family-base);line-height:20px;text-transform:none;text-overflow:ellipsis;overflow:hidden;display:inline-block;padding:0 4px;width:50%;height:20px;text-align:left;}div > button{color:initial;}div > button:disabled{color:var(--ifm-color-gray-300);cursor:default;background:var(--ifm-color-gray-300);}div > input{border:solid 1px var(--ifm-color-gray-300);&:disabled{background:var(--ifm-color-white);}&[type='checkbox']{height:auto;}}p{margin-bottom:12px;white-space:initial;}","{display:",";}"],s,(e=>e.$expanded?"block":"none")),c=i.Ay.a.withConfig({displayName:"styled__SourceLink",componentId:"sc-oqnqzc-4"})(["display:block;text-align:right;margin-top:8px;font:bold 12px/20px var(--ifm-font-family-base);color:var(--ifm-color-content-secondary);","{display:",";}"],s,(e=>e.$expanded?"block":"none"));var p=o(4848);const h=i.Ay.div.withConfig({displayName:"input__InputContainer",componentId:"sc-1myx0c6-0"})(["position:relative;width:100%;&:last-child{margin-bottom:20px;}> *{vertical-align:middle;white-space:nowrap;}label{display:inline-block;width:40%;margin-right:10%;margin-top:2px;margin-bottom:2px;}input,a,button{background:var(--ifm-background-surface-color);font-size:0.9em;text-transform:none;text-overflow:ellipsis;overflow:hidden;display:inline-block;padding:0 4px;margin:0;width:50%;height:20px;line-height:1.833;text-align:left;}button{color:initial;}button:disabled{color:var(--ifm-color-gray-500);cursor:default;background:var(--ifm-color-gray-300);}input{border:solid 1px var(--ifm-color-gray-500);&:disabled{background:var(--ifm-color-gray-300);}&[type='checkbox']{height:auto;}}.tooltip{left:50%;top:24px;opacity:0;pointer-events:none;transition:opacity 200ms;}&:hover .tooltip{opacity:1;}"]);function g(e){let{name:t,min:o,max:i,step:s,displayName:r,displayValue:a,onChange:l}=e;const d=(0,n.useCallback)((e=>{const{value:n}=e.target;let s=Number(n);void 0!==o&&(s=Math.max(o,s)),void 0!==i&&(s=Math.min(i,s)),l(t,s)}),[o,i,l]);return(0,p.jsxs)(h,{children:[(0,p.jsx)("label",{children:r}),(0,p.jsxs)("div",{className:"tooltip",children:[r,": ",String(a)]}),(0,p.jsx)("input",{type:"range",min:o,max:i,value:a,step:s,onChange:d})]})}function u(e){let{name:t,value:o,displayName:i,displayValue:s,onChange:r}=e;const a=(0,n.useCallback)((e=>{const o=e.target.checked;r(t,o)}),[r]);return(0,p.jsxs)(h,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsxs)("div",{className:"tooltip",children:[i,": ",String(s)]}),(0,p.jsx)("input",{type:"checkbox",checked:o,onChange:a})]})}function m(e){const{name:t,onChange:o,displayName:i,altValue:s,displayValue:r,...a}=e,l=(0,n.useCallback)((e=>{o(t,e.target.value)}),[o]),d=(0,n.useCallback)((()=>{o(t,s)}),[s,o]),c=a;switch(e.type){case"link":return(0,p.jsxs)(h,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsx)("a",{href:r,target:"_new",children:r})]});case"function":case"json":const t=Boolean(s);return(0,p.jsxs)(h,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsx)("button",{type:"text",disabled:!t,onClick:d,children:r})]});case"select":return(0,p.jsxs)(h,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsx)("select",{onChange:l,value:r,children:e.options.map(((e,t)=>(0,p.jsx)("option",{value:e,children:e},t)))})]});case"checkbox":return(0,p.jsx)(u,{...e});case"range":return(0,p.jsx)(g,{...e});default:return(0,p.jsxs)(h,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsxs)("div",{className:"tooltip",children:[i,": ",String(r)]}),(0,p.jsx)("input",{...c,value:r,onChange:l})]})}}const f=i.Ay.div.withConfig({displayName:"spinner__SpinnerContainer",componentId:"sc-ok6n2c-0"})(["height:18px;line-height:18px;font-size:10px;> div{white-space:nowrap;left:0;bottom:0;position:absolute;height:18px;padding-left:20px;transition:width 0.5s;}.spinner--fill{background:$primary;color:$white;overflow:hidden;}.spinner--text{color:$black-40;}&.done{height:0 !important;line-height:0;font-size:0;transition:height 0.5s 1s;> div{height:0 !important;transition:height 0.5s 1s;}}"]);function y(e){let{meta:t}=e;if(!Number.isFinite(t.progress)&&!Number.isFinite(t.progressAlt))return null;const o=(t.progress||0)+(t.progressAlt||0),n=Math.round(1e3*o)/10,i="Loading... "+n+"%";return(0,p.jsxs)(f,{className:o>=1?"done":"",children:[(0,p.jsx)("div",{className:"spinner--text",children:i}),(0,p.jsx)("div",{className:"spinner--fill",style:{width:n+"%"},children:i})]})}const x=i.Ay.div.withConfig({displayName:"info-panel__InfoPanelContent",componentId:"sc-1qy2onu-0"})(["hr{margin:12px -24px;}a{text-decoration:none;display:inline;color:var(--ifm-color-primary);}p{margin-bottom:16px;}.legend{display:inline-block;width:12px;height:12px;}.stat{text-transform:uppercase;font-size:0.833em;b{display:block;font-size:3em;font-weight:bold;line-height:1.833;}}hr{border:none;background:var(--ifm-color-gray-400);height:1px;}.layout{display:table;width:100%;> *{display:table-cell !important;}.col-1-3{width:33.33%;}.col-1-2{width:50%;}.text-right{text-align:right;}.text-center{text-align:center;}}"]);function C(e){let{title:t,children:o,sourceLink:i}=e;const[s,h]=(0,n.useState)(!1);return(0,p.jsxs)(r,{children:[(0,p.jsxs)(l,{onClick:()=>h(!s),children:[(0,p.jsx)("div",{children:t}),(0,p.jsx)(a,{$expanded:s,children:s?"\u2715":"i"})]}),(0,p.jsx)(d,{$expanded:s,children:o}),(0,p.jsx)(c,{$expanded:s,href:i,target:"_new",children:"View Code \u2197"})]})}function v(e){let{title:t,sourceLink:o,params:n,meta:i,children:s,updateParam:r}=e;return(0,p.jsxs)(C,{title:t,sourceLink:o,children:[(0,p.jsxs)(x,{children:[s,Object.keys(n).length>0&&(0,p.jsx)("hr",{}),Object.keys(n).sort().map(((e,t)=>(0,p.jsx)(m,{name:e,...n[e],onChange:r},t+"-"+e)))]}),(0,p.jsx)(y,{meta:i})]})}var P=o(4684);const b={};function S(e,t){let o=0;b[e]&&b[e].terminate();const n=new Worker(e);b[e]=n;let i=[];n.onmessage=e=>{const{action:o,data:s,meta:r}=e.data;"end"===o?n.terminate():"add"===o&&s&&s.length&&(i=i.concat(s),t(i,r))},this.onProgress=e=>{const{responseText:t}=e.target,i=t.lastIndexOf("\n")+1;n.postMessage({event:"progress",text:t.slice(o,i)}),o=i},this.onLoad=e=>{const{responseText:t}=e;n.postMessage({event:"load",text:t.slice(o)})}}function w(e,t,o){if(t){const n=(0,P.Em)(e),i=new S(t,((e,t)=>{o(e,t)}));n.on("progress",i.onProgress).on("load",i.onLoad).get()}else/\.(json|geojson)$/.test(e)?(0,P.Pq)(e,((e,t)=>{e||o(t,{})})):(0,P.Qq)(e,((e,t)=>{e||o(t,{})}))}function k(e,t){return t.match(/^\w+:\/\//)?t:e.replace(/\/$/,"")+"/"+t.replace(/^\//,"")}var A=o(6420);const M=e=>{if("function"===e.type){let t=String(e.value);if(Array.isArray(e.value)&&(t="["+t+"]"),"function"==typeof e.value)return t=t.replace(/^function (\w+)?\((\w*?)\)/,"$2 =>"),t=t.replace(/^function (\w+)?(\(.*?\))/,"$2 =>"),t=t.replace(/\{\s*return\s*(.*?);?\s*\}$/,"$1"),{...e,displayValue:t};if(!e.altType)return{...e,displayValue:t};e.type=e.altType}if("json"===e.type)return{...e,displayValue:JSON.stringify(e.value)};if("color"===e.type){const o=function(e){if(!e)return[255,255,255,0];if(Array.isArray(e))return e.slice(0,4);const t=(0,A.Qh)(e);return[t.r,t.g,t.b,255]}(e.value);return{...e,value:o,displayValue:(t=o,t.slice(0,3).reduce(((e,t)=>e+(t<16?"0":"")+t.toString(16)),"#"))}}var t;return{...e,displayValue:String(e.value)}};var F=o(1175),T=o(6025);const D=i.Ay.div.withConfig({displayName:"make-example__DemoContainer",componentId:"sc-is6oih-0"})([".tooltip,.deck-tooltip{position:absolute;padding:4px 12px;background:rgba(0,0,0,0.8);color:var(--ifm-color-white);max-width:300px;font-size:12px;z-index:9;pointer-events:none;white-space:nowrap;}"]),E=i.Ay.div.withConfig({displayName:"make-example__MapTip",componentId:"sc-is6oih-1"})(["position:absolute;right:12px;bottom:20px;color:var(--ifm-color-white);mix-blend-mode:difference;font-size:14px;@media screen and (max-width:480px){display:none;}"]);function j(e,t){let{isInteractive:o=!0,style:i}=void 0===t?{}:t;const{parameters:s={},mapStyle:r}=e,a=Object.keys(s).reduce(((e,t)=>(e[t]=M(s[t]),e)),{}),l=Array.isArray(e.data)?e.data.map((e=>null)):null;return function(){const[t,s]=(0,n.useState)(l),[d,c]=(0,n.useState)(a),[h,g]=(0,n.useState)({}),u=(0,T.A)("/"),m=(0,n.useCallback)((e=>{const t=Object.keys(e).reduce(((t,o)=>(t[o]=M(e[o]),t)),{});c((e=>({...e,...t})))}),[]),f=(0,n.useCallback)((e=>{g((t=>({...t,...e})))}),[]);(0,n.useEffect)((()=>{let t=e.data;if(!t)return;const o=Array.isArray(t);o||(t=[t]);for(let e=0;e<t.length;e++){const{url:n,worker:i}=t[e];w(k(u,n),i&&k(u,i),((t,n)=>{s(o?o=>{const n=o.slice();return n[e]=t,n}:t),n&&g((e=>({...e,...n})))}))}}),[]);return(0,p.jsxs)(D,{style:i,children:[(0,p.jsx)(e,{data:t,mapStyle:r||F.Vi.BLANK,params:d,useParam:m,onStateChange:f}),o&&(0,p.jsx)(v,{title:e.title,params:d,meta:h,updateParam:(e,t)=>{const o=d[e];o&&c({...d,[e]:M({...o,value:t})})},sourceLink:e.code,children:e.renderInfo(h)}),o&&r&&(0,p.jsx)(E,{children:"Hold down shift to rotate"})]})}}var I=o(6588);const _=i.Ay.div.withConfig({displayName:"styled__ExampleHeader",componentId:"sc-1dgi8sb-0"})(["font:bold 20px/28px var(--ifm-font-family-base);color:var(--ifm-color-content-secondary);margin:0 20px;border-bottom:1px solid 20px;display:inline-block;padding:20px 20px 4px 0;"]),L=i.Ay.main.withConfig({displayName:"styled__MainExamples",componentId:"sc-1dgi8sb-1"})(["padding:16px 0;"]),H=i.Ay.main.withConfig({displayName:"styled__ExamplesGroup",componentId:"sc-1dgi8sb-2"})(["display:flex;flex-wrap:wrap;padding:16px;"]),R=i.Ay.a.withConfig({displayName:"styled__ExampleCard",componentId:"sc-1dgi8sb-3"})(["cursor:pointer;text-decoration:none;width:50%;max-width:240px;line-height:0;outline:none;padding:4px;position:relative;img{transition-property:filter;transition-duration:var(--ifm-transition-slow);transition-timing-function:var(--ifm-transition-timing-default);}&:hover{box-shadow:var(--ifm-global-shadow-md);}&:hover img{filter:contrast(0.2);}","{width:33%;min-width:200px;}@media screen and (max-width:632px){width:50%;}"],s),z=i.Ay.div.withConfig({displayName:"styled__ExampleTitle",componentId:"sc-1dgi8sb-4"})(["position:absolute;display:flex;justify-content:center;flex-direction:column;color:var(--ifm-color-white);font-size:1.5em;text-align:center;line-height:initial;width:90%;height:90%;top:5%;left:5%;border:solid 1px var(--ifm-color-white);opacity:0;transition-property:opacity;transition-duration:var(--ifm-transition-slow);transition-timing-function:var(--ifm-transition-timing-default);&:hover{opacity:1;}"]);function O(e,t){let{label:o,items:n}=e;return[(0,p.jsx)(_,{children:o},o+"-header"),(0,p.jsx)(H,{children:n.map((e=>function(e,t){const o=(0,T.A)(t(e)),{label:n,href:i}=e;return(0,p.jsxs)(R,{href:i,children:[(0,p.jsx)("img",{width:"100%",src:o,alt:n}),(0,p.jsx)(z,{children:(0,p.jsx)("span",{children:n})})]},n)}(e,t)))},o)]}function N(e){let{getThumbnail:t}=e;const o=(0,I.t)();return(0,p.jsx)(L,{children:o.items.map((e=>"category"===e.type?O(e,t):null))})}var q=o(4586);const G=i.Ay.section.withConfig({displayName:"styled__Banner",componentId:"sc-exnbu5-0"})(["position:relative;height:30rem;background:var(--ifm-color-gray-400);color:var(--ifm-color-gray-900);z-index:0;","{height:80vh;}"],s),U=i.Ay.div.withConfig({displayName:"styled__Container",componentId:"sc-exnbu5-1"})(["position:relative;padding:2rem;max-width:80rem;width:100%;height:100%;margin:0;"]),B=(0,i.Ay)(U).withConfig({displayName:"styled__BannerContainer",componentId:"sc-exnbu5-2"})(["position:absolute;bottom:0;height:auto;padding-left:4rem;z-index:0;pointer-events:none;"]),W=i.Ay.div.withConfig({displayName:"styled__HeroExampleContainer",componentId:"sc-exnbu5-3"})(["position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;"]),J=(i.Ay.section.withConfig({displayName:"styled__Section",componentId:"sc-exnbu5-4"})(["&:nth-child(2n + 1){background:var(--ifm-color-gray-300);}"]),i.Ay.h1.withConfig({displayName:"styled__ProjectName",componentId:"sc-exnbu5-5"})(["font-size:5em;line-height:1;text-transform:uppercase;letter-spacing:4px;font-weight:700;margin:0;margin-bottom:16px;"])),V=i.Ay.a.withConfig({displayName:"styled__GetStartedLink",componentId:"sc-exnbu5-6"})(["pointer-events:all;font-size:12px;line-height:44px;letter-spacing:2px;font-weight:bold;margin:24px 0;padding:0 4rem;pointer-events:all;display:inline-block;text-decoration:none;transition:background-color 250ms ease-in,color 250ms ease-in;border:solid 2px var(--ifm-color-primary);color:var(--ifm-color-gray-900);border-image:linear-gradient( to right,var(--ifm-color-gray-700) 0%,var(--ifm-color-gray-400) 100% );border-image-slice:2;&:visited{color:var(--ifm-color-gray-900);}&:active{color:var(--ifm-color-white);}&:hover{color:var(--ifm-color-white);background-color:var(--ifm-color-primary);}"]);function Z(e){let{HeroExample:t,children:o}=e;const{siteConfig:n}=(0,q.A)();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(G,{children:[(0,p.jsx)(W,{children:t&&(0,p.jsx)(t,{})}),(0,p.jsxs)(B,{children:[(0,p.jsx)(J,{children:n.title}),(0,p.jsx)("p",{children:n.tagline}),(0,p.jsx)(V,{href:"./docs",children:"GET STARTED"})]})]}),o]})}},1175:(e,t,o)=>{o.d(t,{Vi:()=>n,lP:()=>i});const n={LIGHT:"https://deck.gl/mapstyle/deck-light.json",LIGHT_LABEL:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",DARK:"https://deck.gl/mapstyle/deck-dark.json",BLANK:{version:8,sources:{},layers:[]}},i="https://github.com/visgl/deck.gl-community/tree/master"}}]);