"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[6248],{1325:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>h,contentTitle:()=>g,default:()=>y,frontMatter:()=>p,metadata:()=>u,toc:()=>m});var n=o(4848),i=o(8453),r=o(6540),s=o(8478),a=o(1175),l=o(676);class d extends r.Component{static renderInfo(e){return(0,n.jsx)(n.Fragment,{})}render(){const{...e}=this.props;return(0,n.jsx)(s.A,{children:()=>{const t=o(1503);return(0,n.jsx)(t.Example,{...e})}})}}d.title="Editor",d.code=a.lP+"/examples/editable-layers/editor";const c=(0,l.xv)(d),p={},g="Editor",u={id:"editable-layers/editor",title:"Editor",description:"",source:"@site/src/examples/editable-layers/editor.mdx",sourceDirName:"editable-layers",slug:"/editable-layers/editor",permalink:"/deck.gl-community/examples/editable-layers/editor",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"examplesSidebar",previous:{title:"index",permalink:"/deck.gl-community/examples/"},next:{title:"Advanced",permalink:"/deck.gl-community/examples/editable-layers/advanced"}},h={},m=[];function f(e){const t={h1:"h1",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"editor",children:"Editor"}),"\n","\n",(0,n.jsx)(c,{})]})}function y(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(f,{...e})}):f(e)}},1503:(e,t,o)=>{o.r(t),o.d(t,{Example:()=>re});var n=o(6540),i=o(1198),r=o(2731),s=o(3724),a=(o(1988),o(4848));function l(e){return(0,a.jsx)("box-icon",{color:"currentColor",...e})}var d,c=o(1016),p=o(5276),g=o(6276);const u=s.Ay.button.withConfig({displayName:"modal__Button",componentId:"sc-kod7ao-0"})(["display:inline-block;color:#fff;background-color:rgb(90,98,94);font-size:1em;margin:0.25em;padding:0.375em 0.75em;border:1px solid transparent;border-radius:0.25em;display:block;"]),h=g.Ay.styled(d||(d=(0,p.A)(['\n  position: relative;\n  display: block;\n  width: 50rem;\n  height: auto;\n  max-width: 500px;\n  margin: 1.75rem auto;\n  box-sizing: border-box;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";\n  font-size: 1rem;\n  font-weight: 400;\n  color: rgb(21, 25, 29);\n  line-height: 1.5;\n  text-align: left;\n']))),m=s.Ay.div.withConfig({displayName:"modal__Content",componentId:"sc-kod7ao-1"})(["position:relative;display:flex;flex-direction:column;width:100%;pointer-events:auto;background-color:#fff;background-clip:padding-box;border:1px solid rgba(0,0,0,0.2);border-radius:0.3rem;outline:0;"]),f=s.Ay.div.withConfig({displayName:"modal__HeaderRow",componentId:"sc-kod7ao-2"})(["display:flex;align-items:flex-start;justify-content:space-between;padding:0.75rem 0.75rem;border-bottom:1px solid rgb(222,226,230);"]),y=s.Ay.h5.withConfig({displayName:"modal__Header",componentId:"sc-kod7ao-3"})(["font-size:1.25rem;font-weight:500;margin:0;"]);function x(e){const[t,o]=n.useState(!0);function i(){t&&e.onClose(),o(!t)}return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(g.Zn,{children:(0,a.jsx)(h,{isOpen:t,onBackgroundClick:i,onEscapeKeydown:i,children:(0,a.jsxs)(m,{children:[(0,a.jsx)(f,{children:(0,a.jsx)(y,{children:e.title})}),e.content]})})})})}var C=o(6097),v=o(7434),b=o(1856);function S(e){if("FeatureCollection"!==e.type&&"Feature"!==e.type)throw Error("GeoJSON must have type of 'Feature' or 'FeatureCollection'");return("FeatureCollection"===e.type?e.features:[e]).map(P)}function P(e){const{id:t}=e,o=e.properties||{};let n=e.geometry;if("GeometryCollection"===n.type&&1===n.geometries.length)n=n.geometries[0];else if("GeometryCollection"===n.type&&n.geometries.length>1){const e=new Set(n.geometries.map((e=>e.type)));if(1!==e.size)throw Error("GeometryCollection geometry type not yet supported");{const t=e.values().next().value;"Polygon"===t?n={type:"MultiPolygon",coordinates:n.geometries.map((e=>e.coordinates))}:"LineString"===t&&(n={type:"MultiLineString",coordinates:n.geometries.map((e=>e.coordinates))})}}return{type:"Feature",id:t,geometry:n,properties:o}}function w(e){let t;const o=[];if(function(e){return e.startsWith("{")}(e=e.trim()))try{t={valid:!0,type:"GeoJSON",features:S(JSON.parse(e))}}catch(n){o.push("Error parsing GeoJSON"),o.push(n.toString())}else if(function(e){return e.startsWith("<")}(e)){const i=(new DOMParser).parseFromString(e,"text/xml");try{const e=(0,C.kml)(i),n=e&&"Feature"===e.type,r=e&&"FeatureCollection"===e.type&&e.features.length>0;n||r?t={valid:!0,type:"KML",features:S(e)}:o.push("Invalid KML")}catch(n){o.push("Error parsing KML"),o.push(n.toString())}}else if(function(e){return e.startsWith("POINT")||e.startsWith("LINESTRING")||e.startsWith("POLYGON")||e.startsWith("MULTIPOINT")||e.startsWith("MULTILINESTRING")||e.startsWith("MULTIPOLYGON")}(e))try{const n=(0,v.n)(e,b.u);n?t={valid:!0,type:"WKT",features:[{type:"Feature",properties:{},geometry:n}]}:o.push("Invalid WKT")}catch(n){o.push("Error parsing WKT"),o.push(n.toString())}else o.push("Unknown data format");return t?Promise.resolve(t):Promise.resolve({valid:!1,validationErrors:o})}function k(e){return"string"==typeof e?w(e):(t=e,new Promise(((e,o)=>{const n=new FileReader;n.onload=()=>{const t=n.result;e(w(t))},n.onabort=()=>{o(Error("file reading was aborted"))},n.onerror=()=>{o(Error("file reading has failed"))},n.readAsText(t)})));var t}const A=s.Ay.div.withConfig({displayName:"import-component__ImportComponentContent",componentId:"sc-kzhgw1-0"})(["position:relative;display:flex;flex-direction:column;width:100%;pointer-events:auto;background-color:#fff;background-clip:padding-box;border-radius:0.3rem;outline:0;"]),_=s.Ay.div.withConfig({displayName:"import-component__ImportContent",componentId:"sc-kzhgw1-1"})(["width:auto;height:auto;"]),I=s.Ay.div.withConfig({displayName:"import-component__ImportSelect",componentId:"sc-kzhgw1-2"})(["display:flex;padding:0.75rem 0.75rem 0rem 0.75rem;"]),j=s.Ay.div.withConfig({displayName:"import-component__ImportArea",componentId:"sc-kzhgw1-3"})(["box-sizing:border-box;display:block;width:auto;height:auto;min-height:300px;padding:0rem 1rem;"]),M=s.Ay.textarea.withConfig({displayName:"import-component__ImportTextArea",componentId:"sc-kzhgw1-4"})(["padding:0px;width:100%;resize:vertical;min-height:250px;max-height:450px;border:1px solid rgb(206,212,218);border-radius:0.3rem;font-family:-apple-system,system-ui,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:1rem;font-weight:400;"]),E=s.Ay.div.withConfig({displayName:"import-component__ImportDropArea",componentId:"sc-kzhgw1-5"})(["padding:0px;width:100%;min-height:250px;height:100%;border:1px solid rgb(206,212,218);border-radius:0.3rem;fontfamily:-apple-system,system-ui,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans' sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:1rem;font-weight:400;"]),T=s.Ay.div.withConfig({displayName:"import-component__ImportInfo",componentId:"sc-kzhgw1-6"})(["display:block;padding:0rem 1rem;"]),F=s.Ay.div.withConfig({displayName:"import-component__FooterRow",componentId:"sc-kzhgw1-7"})(["display:flex;justify-content:flex-end;padding:0.75rem 0.75rem;border-top:1px solid rgb(222,226,230);"]);function D(e){const[t,o]=n.useState(!0),[i,r]=n.useState(""),[s,l]=n.useState(null),[d,p]=n.useState({valid:!1,validationErrors:[]});function g(){l(null),r(""),e.onCancel()}function h(){return t&&i||!t&&s}n.useEffect((()=>{!async function(){t?p(await k(i)):null!==s&&p(await k(s))}()}),[t,i,s]);const m=h()&&d.valid&&(!e.onValidate||e.onValidate(d.features));return(0,a.jsxs)(A,{children:[(0,a.jsxs)(_,{children:[(0,a.jsxs)(I,{children:[(0,a.jsx)(u,{style:{backgroundColor:t?"rgb(0, 105, 217)":"rgb(90, 98, 94)"},onClick:()=>{o(!0)},children:"Import From Text"}),(0,a.jsx)(u,{style:{backgroundColor:t?"rgb(90, 98, 94)":"rgb(0, 105, 217)"},onClick:()=>{o(!1)},children:"Import From File"})]}),(0,a.jsxs)(j,{children:[t&&(0,a.jsx)(M,{style:h()&&!d.valid?{borderColor:"rgb(220, 53, 69)"}:{},onChange:e=>r(e.target.value),value:i}),!t&&(0,a.jsx)(c.A,{onDrop:e=>l(e[0]),children:e=>{let{getRootProps:t,getInputProps:o}=e;return(0,a.jsxs)(E,{style:h()&&!d.valid?{borderColor:"rgb(220, 53, 69)"}:{},...t(),children:[(0,a.jsx)("input",{...o()}),s?(0,a.jsxs)("p",{children:[d.valid?"":"Invalid"," Selected File: ",s.name,".",(0,a.jsx)("br",{}),"Drag 'n' drop or click again to change the file."]}):(0,a.jsx)("p",{children:"Drag 'n' drop your file here, or click to select a file."})]})}}),(0,a.jsx)(T,{style:{color:"rgb(133, 100, 4)",backgroundColor:"rgb(255, 243, 205)"},children:h()&&!d.valid&&d.validationErrors.map(((e,t)=>(0,a.jsx)("div",{children:e},t)))})]}),(0,a.jsxs)(T,{children:["Supported formats:",(0,a.jsxs)("ul",{style:{marginTop:"0"},children:[(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"https://tools.ietf.org/html/rfc7946",target:"_blank",rel:"noopener noreferrer",title:"GeoJSON Specification",children:"GeoJSON"})},"geojson"),(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"https://developers.google.com/kml/",target:"_blank",rel:"noopener noreferrer",title:"KML Specification",children:"KML"})},"kml"),(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"https://en.wikipedia.org/wiki/Well-known_text",target:"_blank",rel:"noopener noreferrer",title:"WKT",children:"WKT"})},"wkt")]})]})]}),e.additionalInputs||null,(0,a.jsxs)(F,{children:[(0,a.jsx)(u,{style:h()?{backgroundColor:m?"rgb(0, 105, 217)":"rgb(220, 53, 69)"}:{backgroundColor:"rgb(206, 212, 218)"},disabled:!m,onClick:()=>{e.onImport({type:"FeatureCollection",properties:{},features:d.features}),g()},children:"Import Geometry"}),(0,a.jsx)(u,{onClick:g,children:"Cancel"})]})]})}function L(e){return(0,a.jsx)(x,{onClose:e.onClose,title:"Import",content:(0,a.jsx)(D,{onImport:e.onImport,onCancel:e.onClose,additionalInputs:e.additionalInputs})})}var H=o(8021),R=o.n(H),z=o(56),N=o.n(z),O=o(415),G=o.n(O),q=o(2612);const U=s.Ay.div.withConfig({displayName:"export-component__FormatSelect",componentId:"sc-143gavf-0"})(["display:flex;padding:0.75rem 0.75rem 0rem 0.75rem;"]),W=s.Ay.div.withConfig({displayName:"export-component__ExportArea",componentId:"sc-143gavf-1"})(["box-sizing:border-box;display:block;width:auto;height:auto;min-height:300px;padding:0rem 1rem;"]),B=s.Ay.textarea.withConfig({displayName:"export-component__ExportData",componentId:"sc-143gavf-2"})(["padding:0px;width:100%;resize:vertical;min-height:300px;max-height:500px;border:1px solid rgb(206,212,218);border-radius:0.3rem;font-family:-apple-system,system-ui,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:1rem;font-weight:400;"]),J=s.Ay.div.withConfig({displayName:"export-component__FooterRow",componentId:"sc-143gavf-3"})(["display:flex;justify-content:flex-end;padding:0.75rem 0.75rem;"]);function K(e){let{geoJson:t,onClose:o,filename:i,additionalInputs:r}=e;const[s,l]=n.useState("geoJson");let d=i;d||(d="FeatureCollection"===t.type?"features":t.properties.name||t.id||"feature");const c=n.useMemo((()=>{switch(s){case"geoJson":return function(e,t){return{data:JSON.stringify(e,null,2),filename:t+".geojson",mimetype:"application/json"}}(t,d);case"kml":return function(e,t){return"FeatureCollection"===e.type&&e.features.forEach((e=>{e.properties=e.properties||{}})),{data:G()(e),filename:t+".kml",mimetype:"application/xml"}}(t,d);case"wkt":return function(e,t){let o="";if("Feature"===e.type)o=(0,q.stringify)(e);else{o="";for(const t of e.features)o+=(0,q.stringify)(t)+"\n";o.length>0&&(o=o.substring(0,o.length-1))}return{data:o,filename:t+".wkt",mimetype:"text/plain"}}(t,d);default:throw Error("Unsupported format "+s)}}),[t,s,d]),p=c.data.length>5e5;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(U,{children:[(0,a.jsx)("strong",{style:{padding:"0.5rem 0.25rem"},children:"Format:"}),(0,a.jsx)(u,{style:{backgroundColor:"geoJson"===s?"rgb(0, 105, 217)":"rgb(90, 98, 94)"},onClick:()=>l("geoJson"),children:"GeoJSON"}),(0,a.jsx)(u,{style:{backgroundColor:"kml"===s?"rgb(0, 105, 217)":"rgb(90, 98, 94)"},onClick:()=>l("kml"),children:"KML"}),(0,a.jsx)(u,{style:{backgroundColor:"wkt"===s?"rgb(0, 105, 217)":"rgb(90, 98, 94)"},onClick:()=>l("wkt"),children:"WKT"})]}),(0,a.jsx)(W,{children:(0,a.jsx)(B,{readOnly:!0,style:p?{fontStyle:"italic",padding:"0.75rem 0rem"}:{},value:p?"Too much data to display. Download or Copy to clipboard instead.":c.data})}),r||null,(0,a.jsxs)(J,{children:[(0,a.jsx)(u,{style:{backgroundColor:"rgb(0, 105, 217)"},onClick:function(){N()(new Blob([c.data]),c.filename,c.mimetype),o()},children:"Download"}),(0,a.jsx)(u,{style:{backgroundColor:"rgb(0, 105, 217)"},onClick:function(){R()(c.data).then((()=>o()))},children:"Copy"}),(0,a.jsx)(u,{onClick:o,children:"Cancel"})]})]})}function V(e){return(0,a.jsx)(x,{onClose:e.onClose,title:"Export",content:(0,a.jsx)(K,{...e})})}const $=s.Ay.div.withConfig({displayName:"toolbox__Tools",componentId:"sc-wzvr6l-0"})(["position:absolute;display:flex;flex-direction:column;top:10px;",":10px;"],(e=>e.left?"left":"right")),Z=s.Ay.button.withConfig({displayName:"toolbox__Button",componentId:"sc-wzvr6l-1"})(["color:#fff;background:",";font-size:1em;font-weight:400;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';border:1px solid transparent;border-radius:0.25em;margin:0.05em;padding:0.1em 0.2em;:hover{background:rgb(128,137,133);}"],(e=>{let{kind:t,active:o}=e;return"danger"===t?"rgb(180, 40, 40)":o?"rgb(0, 105, 217)":"rgb(90, 98, 94)"})),X=s.Ay.div.withConfig({displayName:"toolbox__SubToolsContainer",componentId:"sc-wzvr6l-2"})(["position:relative;"]),Y=s.Ay.div.withConfig({displayName:"toolbox__SubTools",componentId:"sc-wzvr6l-3"})(["display:flex;flex-direction:row-reverse;position:absolute;top:0;",":0;"],(e=>e.left?"left":"right")),Q=[{modes:[{mode:r.nE,content:(0,a.jsx)(l,{name:"pointer"})}]},{modes:[{mode:r.i_,content:(0,a.jsx)(l,{name:"map-pin"})}]},{modes:[{mode:r.DS,content:(0,a.jsx)(l,{name:"stats"})}]},{modes:[{mode:r.cR,content:(0,a.jsx)(l,{name:"shape-polygon"})},{mode:r.hh,content:(0,a.jsx)(l,{name:"rectangle"})},{mode:r.Zy,content:(0,a.jsx)(l,{name:"circle"})}]},{modes:[{mode:r.L6,content:(0,a.jsx)(l,{name:"ruler"})},{mode:r.Dx,content:(0,a.jsx)(l,{name:"shape-triangle"})},{mode:r.vX,content:(0,a.jsx)(l,{name:"shape-square"})}]}];function ee(e){let{buttonConfig:t,mode:o,onClick:n}=e;return(0,a.jsx)(Z,{active:t.mode===o,onClick:n,children:t.content})}function te(e){let{left:t,modeGroup:o,mode:i,onSetMode:r}=e;const[s,l]=n.useState(!1),{modes:d}=o;let c=null;s&&(c=(0,a.jsx)(Y,{left:t,children:d.map(((e,t)=>(0,a.jsx)(ee,{buttonConfig:e,mode:i,onClick:()=>{r((()=>e.mode)),l(!1)}},t)))}));const p=d.find((e=>e.mode===i))||d[0];return(0,a.jsxs)(X,{children:[c,(0,a.jsx)(ee,{buttonConfig:p,mode:i,onClick:()=>{r((()=>p.mode)),l(!0)}})]})}function oe(e){let{left:t=!1,mode:o,modeConfig:i,geoJson:r,onSetMode:s,onSetModeConfig:d,onSetGeoJson:c,onImport:p}=e;const[g,u]=n.useState(!1),[h,m]=n.useState(!1),[f,y]=n.useState(!1),[x,C]=n.useState(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)($,{left:t,children:[Q.map(((e,n)=>(0,a.jsx)(te,{left:t,modeGroup:e,mode:o,onSetMode:s},n))),(0,a.jsx)(Z,{onClick:()=>y(!0),title:"Export",children:(0,a.jsx)(l,{name:"export"})}),(0,a.jsx)(Z,{onClick:()=>m(!0),title:"Import",children:(0,a.jsx)(l,{name:"import"})}),(0,a.jsxs)(X,{children:[g&&(0,a.jsxs)(Y,{left:t,children:[(0,a.jsx)(Z,{onClick:()=>u(!1),children:(0,a.jsx)(l,{name:"chevron-right"})}),(0,a.jsx)(Z,{onClick:()=>d({booleanOperation:"difference"}),active:i&&"difference"===i.booleanOperation,children:(0,a.jsx)(l,{name:"minus-front"})}),(0,a.jsx)(Z,{onClick:()=>d({booleanOperation:"union"}),active:i&&"union"===i.booleanOperation,children:(0,a.jsx)(l,{name:"unite"})}),(0,a.jsx)(Z,{onClick:()=>d({booleanOperation:"intersection"}),active:i&&"intersection"===i.booleanOperation,children:(0,a.jsx)(l,{name:"intersect"})})]}),(0,a.jsx)(Z,{onClick:()=>u(!0),children:(0,a.jsx)(l,{name:"cog"})})]}),(0,a.jsxs)(X,{children:[x&&(0,a.jsxs)(Y,{left:t,children:[(0,a.jsxs)(Z,{onClick:()=>{c({type:"FeatureCollection",features:[]}),C(!1)},kind:"danger",title:"Clear all features",children:["Clear all features ",(0,a.jsx)(l,{name:"trash"})]}),(0,a.jsx)(Z,{onClick:()=>C(!1),children:"Cancel"})]}),(0,a.jsx)(Z,{onClick:()=>C(!0),title:"Clear",children:(0,a.jsx)(l,{name:"trash"})})]})]}),h&&(0,a.jsx)(L,{onImport:e=>{p(e),m(!1)},onClose:()=>m(!1)}),f&&(0,a.jsx)(V,{geoJson:r,onClose:()=>y(!1)})]})}var ne=o(5605);const ie={longitude:-122.43,latitude:37.775,zoom:12};function re(){const[e,t]=(0,n.useState)({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-122.46212548792364,37.79026033616934],[-122.48435831844807,37.77160302698496],[-122.45884849905971,37.74414218845571],[-122.42863676726826,37.76266965836386],[-122.46212548792364,37.79026033616934]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-122.4136573004723,37.78826678755718],[-122.44875601708893,37.782670574261324],[-122.43793598592286,37.74322062447909],[-122.40836932539945,37.75125290412125],[-122.4136573004723,37.78826678755718]]]}}]}),[o,s]=(0,n.useState)([0]),[l,d]=(0,n.useState)((()=>r.nE)),[c,p]=(0,n.useState)({}),g=new r.Tp({data:e,mode:l,modeConfig:c,selectedFeatureIndexes:o,onEdit:e=>{let{updatedData:o}=e;t(o)}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.A,{initialViewState:ie,controller:{doubleClickZoom:!1},layers:[g],getCursor:g.getCursor.bind(g),onClick:e=>{l===r.nE&&s(e?[e.index]:[])},children:(0,a.jsx)(ne.Ay,{mapStyle:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json"})}),(0,a.jsx)(oe,{left:!0,geoJson:e,mode:l,modeConfig:c,onSetMode:d,onSetModeConfig:p,onImport:o=>t({...e,features:[...e.features,...o.features]}),onSetGeoJson:t})]})}},2731:(e,t,o)=>{o.d(t,{H2:()=>ct,Jt:()=>rt,O5:()=>Qe,Zy:()=>Ye,UP:()=>tt,hP:()=>it,DS:()=>qe,i_:()=>Ne,G2:()=>lt,cR:()=>Ue,E6:()=>Ve,hh:()=>Be,UD:()=>nt,OH:()=>$e,Vv:()=>Ke,ls:()=>Ee,Tp:()=>Et,IM:()=>Kt,l$:()=>ze,X5:()=>$t,fb:()=>He,Dx:()=>to,vX:()=>Qt,L6:()=>Xt,uq:()=>we,PZ:()=>q,C$:()=>Vt,Dr:()=>Me,Sn:()=>d,GN:()=>Ie,cW:()=>Bt,UX:()=>dt,m0:()=>Le,_C:()=>pt,O1:()=>Pe,nE:()=>ye});var n=o(3279),i=o(5917),r=o(1234),s=o(6599),a=o(365),l=o(669);const d={NONE:null,RECTANGLE:"rectangle",POLYGON:"polygon"};var c=o(228);o(4526);c.EventEmitter;var p=o(6558),g=o(7604),u=o(7885),h=o(7531);var m=o(9452),f=o(660);class y extends m.A{renderLayers(){const{id:e,getFillColor:t,getStrokeColor:o,getInnerRadius:n,updateTriggers:i}=this.props;return[new f.A({...this.props,id:e+"-full",data:this.props.data,getLineColor:o,updateTriggers:{...i,getStrokeColor:i.getStrokeColor}}),new f.A({...this.props,id:e+"-inner",data:this.props.data,getFillColor:t,getRadius:n,pickable:!1,updateTriggers:{...i,getFillColor:i.getFillColor,getRadius:i.getInnerRadius}})]}}y.layerName="JunctionScatterplotLayer",y.defaultProps={...f.A.defaultProps,getFillColor:e=>[0,0,0,255],getStrokeColor:e=>[255,255,255,255],getInnerRadius:e=>1};var x=o(908);var C=o(9350),v=o(976),b=o(7167);const S={outlineEnabled:!1,outlineRenderShadowmap:!1,outlineShadowmap:null};const P={name:"outline",vs:"#version 300 es\nin float instanceZLevel;\nout float outline_vzLevel;\nout vec4 outline_vPosition;\n\n// Set the z level for the outline shadowmap rendering\nvoid outline_setZLevel(float zLevel) {\n  outline_vzLevel = zLevel;\n}\n\n// Store an adjusted position for texture2DProj\nvoid outline_setUV(vec4 position) {\n  // mat4(\n  //   0.5, 0.0, 0.0, 0.0,\n  //   0.0, 0.5, 0.0, 0.0,\n  //   0.0, 0.0, 0.5, 0.0,\n  //   0.5, 0.5, 0.5, 1.0\n  // ) * position;\n  outline_vPosition = vec4(position.xyz * 0.5 + position.w * 0.5, position.w);\n}\n",fs:"uniform bool outline_uEnabled;\nuniform bool outline_uRenderOutlines;\nuniform sampler2D outline_uShadowmap;\n\nin float outline_vzLevel;\n// in vec2 outline_vUV;\nin vec4 outline_vPosition;\n\nout vec4 fragColor;\n\nconst float OUTLINE_Z_LEVEL_ERROR = 0.01;\n\n// Return a darker color in shadowmap\nvec4 outline_filterShadowColor(vec4 color) {\n  return vec4(outline_vzLevel / 255., outline_vzLevel / 255., outline_vzLevel / 255., 1.);\n}\n\n// Return a darker color if in shadowmap\nvec4 outline_filterDarkenColor(vec4 color) {\n  if (outline_uEnabled) {\n    float maxZLevel;\n    if (outline_vPosition.q > 0.0) {\n      maxZLevel = texture2DProj(outline_uShadowmap, outline_vPosition).r * 255.;\n    } else {\n      discard;\n    }\n    if (maxZLevel < outline_vzLevel + OUTLINE_Z_LEVEL_ERROR) {\n      vec4(color.rgb * 0.5, color.a);\n    } else {\n      discard;\n    }\n  }\n  return color;\n}\n\n// if enabled and rendering outlines - Render depth to shadowmap\n// if enabled and rendering colors - Return a darker color if in shadowmap\n// if disabled, just return color\nvec4 outline_filterColor(vec4 color) {\n  if (outline_uEnabled) {\n    return outline_uRenderOutlines ?\n      outline_filterShadowColor(color) :\n      outline_filterDarkenColor(color);\n  }\n  return color;\n}\n",getUniforms:function(e){let{outlineEnabled:t,outlineRenderShadowmap:o,outlineShadowmap:n}=void 0===e?S:e;const i={};return void 0!==t&&(i.outline_uEnabled=t),void 0!==o&&(i.outline_uRenderOutlines=o),void 0!==n&&(i.outline_uShadowmap=n),i}},w=2/3,k={common:0,meters:1,pixels:2};function A(e){let{source:t,code:o=""}=e;return t.replace(/}[^{}]*$/,o.concat("\n}\n"))}class _ extends b.A{constructor(){super(...arguments),this.state=void 0}getShaders(){const e=super.getShaders();return Object.assign({},e,{modules:e.modules.concat([P]),vs:A({source:e.vs,code:"  outline_setUV(gl_Position);\n  outline_setZLevel(instanceZLevel);\n"}),fs:A({source:e.fs,code:"  fragColor = outline_filterColor(fragColor);\n"})})}initializeState(e){super.initializeState(),this.setState({outlineFramebuffer:e.device.createFramebuffer({}),dummyTexture:e.device.createTexture({})}),this.state.attributeManager.addInstanced({instanceZLevel:{size:1,type:5121,accessor:"getZLevel"}})}draw(e){let{moduleParameters:t={},parameters:o,uniforms:n,context:i}=e;const{jointRounded:r,capRounded:s,billboard:a,miterLimit:l,widthUnits:d,widthScale:c,widthMinPixels:p,widthMaxPixels:g}=this.props;n=Object.assign({},n,{jointType:Number(r),capType:Number(s),billboard:a,widthUnits:k[d],widthScale:c,miterLimit:l,widthMinPixels:p,widthMaxPixels:g});const{outlineFramebuffer:u,dummyTexture:h}=this.state;this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!0,outlineShadowmap:h}),this.state.model.draw({uniforms:Object.assign({},n,{jointType:0,widthScale:1.3*this.props.widthScale}),parameters:{depthTest:!1,blendEquation:32776},framebuffer:u}),this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!1,outlineShadowmap:u}),this.state.model.draw({uniforms:Object.assign({},n,{jointType:Number(r),capType:Number(s),widthScale:this.props.widthScale}),parameters:{depthTest:!1}})}}_.layerName="PathOutlineLayer",_.defaultProps={getZLevel:()=>0};var I=o(5337);class j extends I.V{constructor(e){void 0===e&&(e={}),super(Object.assign({},e,{attributes:M(e),topology:"triangle-list"}))}}function M(e){let{length:t=1,headSize:o=.2,tailWidth:n=.05,tailStart:i=.05}=e;const r=[.5,1,0,.5-o/2,1-o,0,.5+o/2,1-o,0,.5-n/2,i,0,.5+n/2,1-o,0,.5+n/2,i,0,.5-n/2,i,0,.5-n/2,1-o,0,.5+n/2,1-o,0],s=new Array(r.length);for(let a=0;a<r.length/3;a++){const e=3*a;s[e+0]=(r[e+0]-.5)*t,s[e+1]=(r[e+1]-.5)*t,s[e+2]=0}return{positions:{size:3,value:new Float32Array(s)},normals:{size:3,value:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])},texCoords:{size:2,value:new Float32Array(r)}}}var E=o(7422);function T(e){let t=0;for(let o=0;o<e.length-1;o++)t+=e[o].distance(e[o+1]);return t}const F=[0,0,0,255],D={forward:!0,backward:!1};function L(e){let{path:t,percentage:o,lineLength:n,color:i,object:r,projectFlat:s}=e;const a=n*o;let l=0,d=0,c=0;for(c=0;c<t.length-1&&(l+=t[c].distance(t[c+1]),!(l>a));c++)d=l;c===t.length-1&&(c-=1);const p=a-d,g=t[c+1].clone().subtract(t[c]).normalize().clone().multiply(new E.I(p,p)).add(t[c]),u=180*new E.I(s(t[c+1])).subtract(s(t[c])).verticalAngle()/Math.PI;return{position:[g.x,g.y,0],angle:u,color:i,object:r}}var H=o(7597),R=o(4901);function z(e){let{p:t,p1:o,p2:n,clampToLine:i=!0}=e;const r=new H.P(n).subtract(o),s=new H.P(t).subtract(o);let a=r.dot(s);return i&&(a=(0,R.qE)(a,0,1)),r.lerp(o,n,a)}const N=v.A,O={mesh:new j({headSize:.2,tailWidth:.05})},G=Object.assign({},_.defaultProps,{MarkerLayer:N,markerLayerProps:O,sizeScale:100,fp64:!1,highlightIndex:-1,highlightPoint:null,getPath:e=>e.path,getColor:e=>e.color,getMarkerColor:e=>[0,0,0,255],getDirection:e=>e.direction,getMarkerPercentages:(e,t)=>{let{lineLength:o}=t;return o>.1?[.25,.5,.75]:[.5]}});class q extends m.A{constructor(){super(...arguments),this.state=void 0}initializeState(){this.state={markers:[],mesh:new j({headSize:.2,tailWidth:.05}),closestPoint:null,closestPoints:[]}}projectFlat(e,t,o,n){if(o===C.rf.METER_OFFSETS){const[o,i]=t.metersToLngLatDelta(e),[r,s]=n;return t.projectFlat([r+o,i+s])}if(o===C.rf.LNGLAT_OFFSETS){const[o,i]=e,[r,s]=n;return t.projectFlat([r+o,i+s])}return t.projectFlat(e)}updateState(e){let{props:t,oldProps:o,changeFlags:n}=e;if(n.dataChanged||n.updateTriggersChanged){const{data:e,getPath:t,getDirection:o,getMarkerColor:n,getMarkerPercentages:i,coordinateSystem:r,coordinateOrigin:s}=this.props,{viewport:a}=this.context,l=e=>this.projectFlat(e,a,r,s);this.state.markers=function(e){let{data:t,getPath:o=((e,t)=>e.path),getDirection:n=(e=>e.direction),getColor:i=(e=>F),getMarkerPercentages:r=((e,t)=>[.5]),projectFlat:s}=e;const a=[];for(const l of t){const e=o(l,null),t=n(l)||D,d=i(l),c=e.map((e=>new E.I(e))),p=c.slice(0).reverse(),g=T(c),u=r(l,{lineLength:g});for(const o of u){if(t.forward){const e=L({path:c,percentage:o,lineLength:g,color:d,object:l,projectFlat:s});a.push(e)}if(t.backward){const e=L({path:p,percentage:o,lineLength:g,color:d,object:l,projectFlat:s});a.push(e)}}}return a}({data:e,getPath:t,getDirection:o,getColor:n,getMarkerPercentages:i,projectFlat:l}),this._recalculateClosestPoint()}n.propsChanged&&t.point!==o.point&&this._recalculateClosestPoint()}_recalculateClosestPoint(){const{highlightPoint:e,highlightIndex:t}=this.props;if(e&&t>=0){const o=this.props.data[t],n=this.props.getPath(o,null),{point:i}=function(e){let{p:t,points:o}=e;t=new H.P(t);let n=null,i=1/0,r=-1;for(let s=0;s<o.length-1;++s){const e=z({p:t,p1:o[s],p2:o[s+1]}),a=t.distanceSquared(e);a<i&&(i=a,n=e,r=s)}return{point:n,index:r,p1:o[r],p2:o[r+1],distanceSquared:i,distance:Math.sqrt(i)}}({points:n,p:e});this.state.closestPoints=[{position:i}]}else this.state.closestPoints=[]}getPickingInfo(e){let{info:t}=e;return Object.assign(t,{object:t.object&&t.object.path||t.object})}renderLayers(){return[new _(this.props,this.getSubLayerProps({id:"paths",data:this.props.data})),new this.props.MarkerLayer(this.getSubLayerProps(Object.assign({},this.props.markerLayerProps,{id:"markers",data:this.state.markers,getOrientation:e=>[0,-e.angle,0],getColor:e=>e.color,sizeScale:this.props.sizeScale,fp64:this.props.fp64,pickable:!1,parameters:{blend:!1,depthTest:!1}}))),this.state.closestPoints&&new f.A({id:this.props.id+"-highlight",data:this.state.closestPoints,fp64:this.props.fp64})]}}q.layerName="PathMarkerLayer",q.defaultProps=G;var U=o(8894),W=o(7790),B=o(4657),J=o(5475),K=o(8364),V=o(9987),$=o(5046);function Z(e,t,o){if(!Array.isArray(e[0]))return!0;for(let n=0;n<e.length;n++)if(Z(e[n],[...t,n],o)){o(e,t);break}return!1}function X(e,t,o){const i={type:"LineString",coordinates:[e,t]},r=(0,n.zx)(o),s=(0,u.A)(r,i),a=(0,g.A)(e,t),l=(o[0]-e[0])*(t[1]-e[1])-(o[1]-e[1])*(t[0]-e[0])<0?a-90:a-270,d=(0,p.A)(t,s,l),c=(0,p.A)(e,s,l);return[d.geometry.coordinates,c.geometry.coordinates]}function Y(e,t,o,n){const i=e-o,r=t-n;return Math.sqrt(i*i+r*r)}function Q(e,t,o){const n=new h.Ay(o),i=e.geometry.coordinates.map((e=>{let[t,o,i=0]=e;return n.project([t,o,i])})),[r,s]=n.project(t.geometry.coordinates);let a=1/0,l={};i.forEach(((e,t)=>{let[o,n]=e;if(0===t)return;const[d,c]=i[t-1],p=c-n,g=o-d,u=d*n-o*c,h=p*p+g*g,m=Math.abs(p*r+g*s+u)/Math.sqrt(h);m<a&&(a=m,l={index:t,x0:(g*(g*r-p*s)-p*u)/h,y0:(p*(-g*r+p*s)-g*u)/h})}));const{index:d,x0:c,y0:p}=l,[g,u,m=0]=i[d-1],[f,y,x=0]=i[d],C=Y(g,u,f,y),v=function(e,t,o){return t*o+e*(1-o)}(m,x,Y(g,u,c,p)/C);return{type:"Feature",geometry:{type:"Point",coordinates:n.unproject([c,p,v])},properties:{dist:a,index:d-1}}}function ee(e){const t=ne(e);return t.length?t[0]:null}function te(e){return ne(e).find((e=>{let{properties:t}=e;return t.featureIndex>=0&&"existing"===t.editHandleType}))}function oe(e){return ne(e).find((e=>{let{properties:t}=e;return t.featureIndex>=0&&"intermediate"===t.editHandleType}))}function ne(e){return e&&e.filter((e=>e.isGuide&&"editHandle"===e.object.properties.guideType)).map((e=>e.object))||[]}function ie(e,t,o){void 0===o&&(o="existing");let n=[];switch(e.type){case"Point":n=[{type:"Feature",properties:{guideType:"editHandle",editHandleType:o,positionIndexes:[],featureIndex:t},geometry:{type:"Point",coordinates:e.coordinates}}];break;case"MultiPoint":case"LineString":n=n.concat(re(e.coordinates,[],t,o));break;case"Polygon":case"MultiLineString":for(let i=0;i<e.coordinates.length;i++)n=n.concat(re(e.coordinates[i],[i],t,o)),"Polygon"===e.type&&(n=n.slice(0,-1));break;case"MultiPolygon":for(let i=0;i<e.coordinates.length;i++)for(let r=0;r<e.coordinates[i].length;r++)n=n.concat(re(e.coordinates[i][r],[i,r],t,o)),n=n.slice(0,-1);break;default:throw Error("Unhandled geometry type: "+e.type)}return n}function re(e,t,o,n){void 0===n&&(n="existing");const i=[];for(let r=0;r<e.length;r++){const s=e[r];i.push({type:"Feature",properties:{guideType:"editHandle",positionIndexes:[...t,r],featureIndex:o,editHandleType:n},geometry:{type:"Point",coordinates:s}})}return i}function se(e,t){return"number"==typeof e[0]?!isNaN(e[0])&&isFinite(e[0])?t(e):e:e.map((e=>se(e,t))).filter(Boolean)}class ae{constructor(e){this.featureCollection=e}getObject(){return this.featureCollection}replacePosition(e,t,o){const n=this.featureCollection.features[e].geometry,i="Polygon"===n.type||"MultiPolygon"===n.type,r={...n,coordinates:de(n.coordinates,t,o,i)};return this.replaceGeometry(e,r)}removePosition(e,t){const o=this.featureCollection.features[e].geometry;if("Point"===o.type)throw Error("Can't remove a position from a Point or there'd be nothing left");if("MultiPoint"===o.type&&o.coordinates.length<2)throw Error("Can't remove the last point of a MultiPoint or there'd be nothing left");if("LineString"===o.type&&o.coordinates.length<3)throw Error("Can't remove position. LineString must have at least two positions");if("Polygon"===o.type&&o.coordinates[0].length<5&&Array.isArray(t)&&0===t[0])throw Error("Can't remove position. Polygon's outer ring must have at least four positions");if("MultiLineString"===o.type&&1===o.coordinates.length&&o.coordinates[0].length<3)throw Error("Can't remove position. MultiLineString must have at least two positions");if("MultiPolygon"===o.type&&1===o.coordinates.length&&o.coordinates[0][0].length<5&&Array.isArray(t)&&0===t[0]&&0===t[1])throw Error("Can't remove position. MultiPolygon's outer ring must have at least four positions");const n="Polygon"===o.type||"MultiPolygon"===o.type,i={...o,coordinates:ce(o.coordinates,t,n)};return function(e){switch(e.type){case"Polygon":!function(e){const t=e.coordinates;for(let o=1;o<t.length;o++)ge(t,o)&&o--}(e);break;case"MultiLineString":!function(e){for(let t=0;t<e.coordinates.length;t++){1===e.coordinates[t].length&&(e.coordinates.splice(t,1),t--)}}(e);break;case"MultiPolygon":!function(e){for(let t=0;t<e.coordinates.length;t++){const o=e.coordinates[t];o[0].length<=3&&(e.coordinates.splice(t,1),t--);for(let e=1;e<o.length;e++)ge(o,e)&&e--}}(e)}}(i),this.replaceGeometry(e,i)}addPosition(e,t,o){const n=this.featureCollection.features[e].geometry;if("Point"===n.type)throw new Error("Unable to add a position to a Point feature");const i="Polygon"===n.type||"MultiPolygon"===n.type,r={...n,coordinates:pe(n.coordinates,t,o,i)};return this.replaceGeometry(e,r)}replaceGeometry(e,t){const o={...this.featureCollection.features[e],geometry:t},n={...this.featureCollection,features:[...this.featureCollection.features.slice(0,e),o,...this.featureCollection.features.slice(e+1)]};return new ae(n)}addFeature(e){return this.addFeatures([e])}addFeatures(e){const t={...this.featureCollection,features:[...this.featureCollection.features,...e]};return new ae(t)}deleteFeature(e){return this.deleteFeatures([e])}deleteFeatures(e){const t=[...this.featureCollection.features];e.sort();for(let n=e.length-1;n>=0;n--){const o=e[n];o>=0&&o<t.length&&t.splice(o,1)}const o={...this.featureCollection,features:t};return new ae(o)}}function le(e,t){if(2===e.length&&3===t.length){const o=t[2];return[e[0],e[1],o]}return e}function de(e,t,o,n){if(!t)return e;if(0===t.length)return le(o,e);if(1===t.length){const i=[...e.slice(0,t[0]),le(o,e[t[0]]),...e.slice(t[0]+1)];return!n||0!==t[0]&&t[0]!==e.length-1||(i[0]=le(o,e[0]),i[e.length-1]=le(o,e[0])),i}return[...e.slice(0,t[0]),de(e[t[0]],t.slice(1,t.length),o,n),...e.slice(t[0]+1)]}function ce(e,t,o){if(!t)return e;if(0===t.length)throw Error("Must specify the index of the position to remove");if(1===t.length){const n=[...e.slice(0,t[0]),...e.slice(t[0]+1)];return!o||0!==t[0]&&t[0]!==e.length-1||(0===t[0]?n[n.length-1]=n[0]:t[0]===e.length-1&&(n[0]=n[n.length-1])),n}return[...e.slice(0,t[0]),ce(e[t[0]],t.slice(1,t.length),o),...e.slice(t[0]+1)]}function pe(e,t,o,n){if(!t)return e;if(0===t.length)throw Error("Must specify the index of the position to remove");if(1===t.length){return[...e.slice(0,t[0]),o,...e.slice(t[0])]}return[...e.slice(0,t[0]),pe(e[t[0]],t.slice(1,t.length),o,n),...e.slice(t[0]+1)]}function ge(e,t){return e[t].length<=3&&(e.splice(t,1),!0)}const ue={type:"FeatureCollection",features:[]},he=[];class me{constructor(){this._clickSequence=[]}getGuides(e){return ue}getTooltips(e){return he}getSelectedFeature(e){return 1===e.selectedIndexes.length?e.data.features[e.selectedIndexes[0]]:null}getSelectedGeometry(e){const t=this.getSelectedFeature(e);return t?t.geometry:null}getSelectedFeaturesAsFeatureCollection(e){const{features:t}=e.data;return{type:"FeatureCollection",features:e.selectedIndexes.map((e=>t[e]))}}getClickSequence(){return this._clickSequence}addClickSequence(e){let{mapCoords:t}=e;this._clickSequence.push(t)}resetClickSequence(){this._clickSequence=[]}getTentativeGuide(e){return this.getGuides(e).features.find((e=>e.properties&&"tentative"===e.properties.guideType))}isSelectionPicked(e,t){if(!e.length)return!1;const o=function(e){return e&&e.filter((e=>!e.isGuide))}(e).map((e=>{let{index:t}=e;return t})),n=ne(e).map((e=>{let{properties:t}=e;return t.featureIndex})),i=new Set([...o,...n]);return t.selectedIndexes.some((e=>i.has(e)))}rewindPolygon(e){const{geometry:t}=e;return"Polygon"===t.type||"MultiPolygon"===t.type?(0,K.A)(e):e}getAddFeatureAction(e,t){const o=e,n="Feature"===o.type?o:{type:"Feature",properties:{},geometry:o},i=this.rewindPolygon(n),r=new ae(t).addFeature(i).getObject();return{updatedData:r,editType:"addFeature",editContext:{featureIndexes:[r.features.length-1]}}}getAddManyFeaturesAction(e,t){let{features:o}=e,n=new ae(t);const i=n.getObject().features.length,r=[];for(const s of o){const{properties:e,geometry:t}=s,o=t;n=n.addFeature({type:"Feature",properties:e,geometry:o}),r.push(i+r.length)}return{updatedData:n.getObject(),editType:"addFeature",editContext:{featureIndexes:r}}}getAddFeatureOrBooleanPolygonAction(e,t){const o=e,n=this.getSelectedFeature(t),{modeConfig:i}=t;if(i&&i.booleanOperation){if(!n||"Polygon"!==n.geometry.type&&"MultiPolygon"!==n.geometry.type)return console.warn("booleanOperation only supported for single Polygon or MultiPolygon selection"),null;const e="Feature"===o.type?o:{type:"Feature",geometry:o};let r;if("union"===i.booleanOperation)r=(0,B.A)(n,e);else if("difference"===i.booleanOperation)r=(0,a.A)(n,e);else{if("intersection"!==i.booleanOperation)return console.warn("Invalid booleanOperation "+i.booleanOperation),null;r=(0,J.A)(n,e)}if(!r)return console.warn("Canceling edit. Boolean operation erased entire polygon."),null;const s=t.selectedIndexes[0];return{updatedData:new ae(t.data).replaceGeometry(s,r.geometry).getObject(),editType:"unionGeometry",editContext:{featureIndexes:[s]}}}return this.getAddFeatureAction(e,t.data)}createTentativeFeature(e){return null}handleClick(e,t){}handlePointerMove(e,t){const o=this.createTentativeFeature(t);o&&t.onEdit({updatedData:t.data,editType:"updateTentativeFeature",editContext:{feature:o}})}handleStartDragging(e,t){}handleStopDragging(e,t){}handleDragging(e,t){}handleKeyUp(e,t){"Escape"===e.key&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}}function fe(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}class ye extends me{}var xe=o(7083),Ce=o(5903),ve=o(7743),be=o(8664),Se=o(7861);class Pe extends me{constructor(){super(...arguments),this._isTranslatable=void 0}handleDragging(e,t){if(this._isTranslatable){if(this._geometryBeforeTranslate){const o=this.getTranslateAction(e.pointerDownMapCoords,e.mapCoords,"translating",t);o&&t.onEdit(o)}e.cancelPan()}}handlePointerMove(e,t){this._isTranslatable=this.isSelectionPicked(e.pointerDownPicks||e.picks,t),this.updateCursor(t)}handleStartDragging(e,t){this._isTranslatable&&(this._geometryBeforeTranslate=this.getSelectedFeaturesAsFeatureCollection(t))}handleStopDragging(e,t){if(this._geometryBeforeTranslate){const o=this.getTranslateAction(e.pointerDownMapCoords,e.mapCoords,"translated",t);o&&t.onEdit(o),this._geometryBeforeTranslate=null}}updateCursor(e){this._isTranslatable?e.onUpdateCursor("move"):e.onUpdateCursor(null)}getTranslateAction(e,t,o,i){if(!this._geometryBeforeTranslate)return null;let r=new ae(i.data);const s=i.selectedIndexes,{viewport:a,screenSpace:d}=i.modeConfig||{};if(a&&d){const o=a.project?a:new h.Ay(a),n=o.project(e),i=o.project(t),l=i[0]-n[0],d=i[1]-n[1];for(let e=0;e<s.length;e++){const t=s[e],n=this._geometryBeforeTranslate.features[e];let i=n.geometry.coordinates;i&&(i=se(i,(e=>{const t=o.project(e);return t?(t[0]+=l,t[1]+=d,o.unproject(t)):null})),r=r.replaceGeometry(t,{type:n.geometry.type,coordinates:i}))}}else{const o=(0,n.zx)(e),i=(0,n.zx)(t),a=(0,l.A)(o,i),d=(0,g.A)(o,i),c=this._geometryBeforeTranslate.features.map((e=>function(e,t,o){const n=(0,Ce.A)(e),i=(0,Se.A)(n,t,o),r=se(e.geometry.coordinates,(e=>{const t=(0,be.A)(n.geometry.coordinates,e),o=(0,ve.A)(n.geometry.coordinates,e);return(0,Se.A)(i.geometry.coordinates,t,o).geometry.coordinates}));return e.geometry.coordinates=r,e}((0,xe.A)(e),a,d)));for(let e=0;e<s.length;e++){const t=s[e],o=c[e];r=r.replaceGeometry(t,o.geometry)}}return{updatedData:r.getObject(),editType:o,editContext:{featureIndexes:s}}}}class we extends me{getGuides(e){const t=[],{data:o,lastPointerMoveEvent:i}=e,{features:r}=o,s=i&&i.picks,a=i&&i.mapCoords;for(const n of e.selectedIndexes)if(n<r.length){const{geometry:e}=r[n];t.push(...ie(e,n))}else console.warn("selectedFeatureIndexes out of range "+n);if(s&&s.length&&a){var l;const o=!te(s)&&s.find((e=>!e.isGuide));if(o&&!o.object.geometry.type.includes("Point")&&(null==(l=e.modeConfig)||!l.lockRectangles||"Rectangle"!==o.object.properties.shape)&&e.selectedIndexes.includes(o.index)){let i=null,r=[];const s=(0,n.zx)(a);if(Z(o.object.geometry.coordinates,[],((t,o)=>{const a=(0,n.wi)(t),l=this.getNearestPoint(a,s,e.modeConfig&&e.modeConfig.viewport);(!i||l.properties.dist<i.properties.dist)&&(i=l,r=o)})),i){const{geometry:{coordinates:e},properties:{index:n}}=i;t.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:o.index,positionIndexes:[...r,n+1]},geometry:{type:"Point",coordinates:e}})}}}return{type:"FeatureCollection",features:t}}getNearestPoint(e,t,o){const{coordinates:i}=e.geometry;if(i.some((e=>e.length>2))){if(o)return Q(e,t,o);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return function(e,t,o){var i,r;let s;o&&(s=new h.Ay(o));let a=(0,n.zx)([1/0,1/0],{dist:1/0});return null==(i=e.geometry)||!i.coordinates.length||(null==(r=e.geometry)?void 0:r.coordinates.length)<2||(0,V.iw)(e,(e=>{const o=(0,$.$R)(e),i=(0,$.$R)(t);let r,l,d,c,p,g,u;if(o.length>1&&i.length){let e,t;s?(e=o.map((e=>s.project(e))),t=s.project(i)):(e=o,t=i);for(let o=1;o<e.length;o++){if(e[o][0]!==e[o-1][0]){const n=(e[o][1]-e[o-1][1])/(e[o][0]-e[o-1][0]),i=e[o][1]-n*e[o][0];u=Math.abs(n*t[0]+i-t[1])/Math.sqrt(n*n+1)}else u=Math.abs(t[0]-e[o][0]);const n=Math.pow(e[o][1]-e[o-1][1],2)+Math.pow(e[o][0]-e[o-1][0],2),i=Math.pow(e[o][1]-t[1],2)+Math.pow(e[o][0]-t[0],2),s=Math.pow(e[o-1][1]-t[1],2)+Math.pow(e[o-1][0]-t[0],2),a=Math.pow(u,2),c=i-a+s-a;c>n&&(u=Math.sqrt(Math.min(i,s))),(null==r||r>u)&&(c>n?s<i?(l=0,d=1):(d=0,l=1):(l=Math.sqrt(s-a)/Math.sqrt(n),d=Math.sqrt(i-a)/Math.sqrt(n)),r=u,g=o)}const n=e[g-1][0]-e[g][0],a=e[g-1][1]-e[g][1];c=e[g-1][0]-n*l,p=e[g-1][1]-a*l}let h={x:c,y:p,idx:g-1,to:l,from:d};if(s){const e=s.unproject([h.x,h.y]);h={x:e[0],y:e[1],idx:g-1,to:l,from:d}}a=(0,n.zx)([h.x,h.y],{dist:Math.abs(h.from-h.to),index:h.idx})})),a}(e,t,o)}handleClick(e,t){const o=te(e.picks),n=oe(e.picks);if(o){const{featureIndex:e,positionIndexes:n}=o.properties;let i;try{i=new ae(t.data).removePosition(e,n).getObject()}catch(r){}i&&t.onEdit({updatedData:i,editType:"removePosition",editContext:{featureIndexes:[e],positionIndexes:n,position:o.geometry.coordinates}})}else if(n){var i;const{featureIndex:e,positionIndexes:o}=n.properties,r=t.data.features[e];if(!(null!=(i=t.modeConfig)&&i.lockRectangles&&"Rectangle"===(null==r?void 0:r.properties.shape))){const i=new ae(t.data).addPosition(e,o,n.geometry.coordinates).getObject();i&&t.onEdit({updatedData:i,editType:"addPosition",editContext:{featureIndexes:[e],positionIndexes:o,position:n.geometry.coordinates}})}}}handleDragging(e,t){const o=ee(e.pointerDownPicks);o&&(e.cancelPan(),this._dragEditHandle("movePosition",t,o,e))}_dragEditHandle(e,t,o,n){var i;const r=o.properties,s=t.data.features[r.featureIndex];let a;if(null!=(i=t.modeConfig)&&i.lockRectangles&&"Rectangle"===s.properties.shape){const e=function(e,t,o){const n=e.geometry.coordinates;if(!n)return null;const i=n[0].slice(0,4);i[t%4]=o;const r=i[(t+2)%4],s=i[t%4];return i[(t+1)%4]=[s[0],r[1]],i[(t+3)%4]=[r[0],s[1]],[[...i,i[0]]]}(s,r.positionIndexes[1],n.mapCoords);a=new ae(t.data).replaceGeometry(r.featureIndex,{coordinates:e,type:"Polygon"}).getObject()}else a=new ae(t.data).replacePosition(r.featureIndex,r.positionIndexes,n.mapCoords).getObject();t.onEdit({updatedData:a,editType:e,editContext:{featureIndexes:[r.featureIndex],positionIndexes:r.positionIndexes,position:n.mapCoords}})}handlePointerMove(e,t){const o=this.getCursor(e);t.onUpdateCursor(o)}handleStartDragging(e,t){const o=t.selectedIndexes,n=oe(e.picks);if(o.length&&n){const o=n.properties,i=new ae(t.data).addPosition(o.featureIndex,o.positionIndexes,e.mapCoords).getObject();t.onEdit({updatedData:i,editType:"addPosition",editContext:{featureIndexes:[o.featureIndex],positionIndexes:o.positionIndexes,position:e.mapCoords}})}}handleStopDragging(e,t){const o=t.selectedIndexes,n=ee(e.picks);o.length&&n&&this._dragEditHandle("finishMovePosition",t,n,e)}getCursor(e){return ne(e&&e.picks||[]).length?"cell":null}}var ke=o(7450),Ae=o(5875),_e=o(1349);class Ie extends me{constructor(){super(...arguments),this._cornerGuidePoints=[],this._isScaling=!1,this._isSinglePointGeometrySelected=e=>{const{features:t}=e||{};if(Array.isArray(t)&&1===t.length){const{type:e}=(0,$.bg)(t[0]);return"Point"===e}return!1},this._getOppositeScaleHandle=e=>{const t=e&&e.properties&&Array.isArray(e.properties.positionIndexes)&&e.properties.positionIndexes[0];if("number"!=typeof t)return null;const o=this._cornerGuidePoints.length,n=(t+o/2)%o;return this._cornerGuidePoints.find((e=>!!Array.isArray(e.properties.positionIndexes)&&e.properties.positionIndexes[0]===n))||null},this._getUpdatedData=(e,t)=>{let o=new ae(e.data);const n=e.selectedIndexes;for(let i=0;i<n.length;i++){const e=n[i],r=t.features[i];o=o.replaceGeometry(e,r.geometry)}return o.getObject()},this.isEditHandleSelected=()=>Boolean(this._selectedEditHandle),this.getScaleAction=(e,t,o,n)=>{if(!this._selectedEditHandle)return null;const i=this._getOppositeScaleHandle(this._selectedEditHandle),r=(0,$.uG)(i),s=function(e,t,o){const n=(0,l.A)(e,t),i=(0,l.A)(e,o);return i/n}(r,e,t),a=(0,_e.A)(this._geometryBeingScaled,s,{origin:r});return{updatedData:this._getUpdatedData(n,a),editType:o,editContext:{featureIndexes:n.selectedIndexes}}},this.updateCursor=e=>{if(this._selectedEditHandle){this._cursor&&e.onUpdateCursor(this._cursor);const t=this.getSelectedFeaturesAsFeatureCollection(e),o=(0,ke.A)(t),n=(0,g.A)(o,this._selectedEditHandle),i=n<0?n+180:n;i>=0&&i<=90||i>=180&&i<=270?(this._cursor="nesw-resize",e.onUpdateCursor("nesw-resize")):(this._cursor="nwse-resize",e.onUpdateCursor("nwse-resize"))}else e.onUpdateCursor(null),this._cursor=null}}handlePointerMove(e,t){if(!this._isScaling){const o=ee(e.picks);this._selectedEditHandle=o&&"scale"===o.properties.editHandleType?o:null,this.updateCursor(t)}}handleStartDragging(e,t){this._selectedEditHandle&&(this._isScaling=!0,this._geometryBeingScaled=this.getSelectedFeaturesAsFeatureCollection(t))}handleDragging(e,t){if(!this._isScaling)return;t.onUpdateCursor(this._cursor);const o=this.getScaleAction(e.pointerDownMapCoords,e.mapCoords,"scaling",t);o&&t.onEdit(o),e.cancelPan()}handleStopDragging(e,t){if(this._isScaling){const o=this.getScaleAction(e.pointerDownMapCoords,e.mapCoords,"scaled",t);o&&t.onEdit(o),t.onUpdateCursor(null),this._geometryBeingScaled=null,this._selectedEditHandle=null,this._cursor=null,this._isScaling=!1}}getGuides(e){this._cornerGuidePoints=[];const t=this.getSelectedFeaturesAsFeatureCollection(e);if(this._isSinglePointGeometrySelected(t))return{type:"FeatureCollection",features:[]};const o=(0,r.A)((0,i.A)(t));o.properties.mode="scale";const s=[];return(0,V.Fh)(o,((e,t)=>{if(t<4){const o=(0,n.zx)(e,{guideType:"editHandle",editHandleType:"scale",positionIndexes:[t]});s.push(o)}})),this._cornerGuidePoints=s,(0,n.Lr)([(0,Ae.Ay)(o),...this._cornerGuidePoints])}}var je=o(5486);class Me extends me{constructor(){super(...arguments),this._isRotating=!1,this._isSinglePointGeometrySelected=e=>{const{features:t}=e||{};if(Array.isArray(t)&&1===t.length){const{type:e}=(0,$.bg)(t[0]);return"Point"===e}return!1},this.getIsRotating=()=>this._isRotating}getGuides(e){const t=this._geometryBeingRotated||this.getSelectedFeaturesAsFeatureCollection(e);if(this._isSinglePointGeometrySelected(t))return{type:"FeatureCollection",features:[]};if(this._isRotating)return(0,n.Lr)([(0,ke.A)(t)]);const o=(0,r.A)((0,i.A)(t));let s=null,a=null,d=0;(0,V.Fh)(o,(e=>{if(s){const t=fe(e,s);(!a||t[1]>a[1])&&(a=t);const o=(0,l.A)(e,s);d=Math.max(d,o)}s=e}));const c=a&&[a[0],a[1]+d/1e3],p=(0,n.wi)([a,c]),g=(0,n.zx)(c,{guideType:"editHandle",editHandleType:"rotate"}),u=[(0,Ae.Ay)(o),g,p];return(0,n.Lr)(u)}handleDragging(e,t){if(!this._isRotating)return;const o=this.getRotateAction(e.pointerDownMapCoords,e.mapCoords,"rotating",t);o&&t.onEdit(o),e.cancelPan()}handlePointerMove(e,t){if(!this._isRotating){const t=ee(e.picks);this._selectedEditHandle=t&&"rotate"===t.properties.editHandleType?t:null}this.updateCursor(t)}handleStartDragging(e,t){this._selectedEditHandle&&(this._isRotating=!0,this._geometryBeingRotated=this.getSelectedFeaturesAsFeatureCollection(t))}handleStopDragging(e,t){if(this._isRotating){const o=this.getRotateAction(e.pointerDownMapCoords,e.mapCoords,"rotated",t);o&&t.onEdit(o),this._geometryBeingRotated=null,this._selectedEditHandle=null,this._isRotating=!1}}updateCursor(e){this._selectedEditHandle?e.onUpdateCursor("crosshair"):e.onUpdateCursor(null)}getRotateAction(e,t,o,n){if(!this._geometryBeingRotated)return null;const i=(0,ke.A)(this._geometryBeingRotated),r=function(e,t,o){const n=(0,g.A)(e,t),i=(0,g.A)(e,o);return i-n}(i,e,t),s=(0,je.A)(this._geometryBeingRotated,r,{pivot:i});let a=new ae(n.data);const l=n.selectedIndexes;for(let d=0;d<l.length;d++){const e=l[d],t=s.features[d];a=a.replaceGeometry(e,t.geometry)}return{updatedData:a.getObject(),editType:o,editContext:{featureIndexes:l}}}}class Ee extends Pe{handleStartDragging(e,t){super.handleStartDragging(e,t),this._geometryBeforeTranslate&&t.onEdit(this.getAddManyFeaturesAction(this._geometryBeforeTranslate,t.data))}updateCursor(e){this._isTranslatable?e.onUpdateCursor("copy"):e.onUpdateCursor(null)}}var Te=o(2608),Fe=o(5085),De=o(7028);class Le extends me{calculateMapCoords(e,t,o){const i=o.modeConfig;if(!i||!i.lock90Degree||!e.length)return t;if(1===e.length){const n=e[0],i=this.getSelectedGeometry(o),r=(0,Ae.Ay)(i),s="FeatureCollection"===r.type?r.features:[r];let a=Number.MAX_SAFE_INTEGER,d=null;if(s.forEach((e=>{const t=(0,De.A)(e,n),o=(0,l.A)(t,n);a>o&&(a=o,d=t)})),d){const e=(0,g.A)(n,d),o=(0,l.A)(n,t,{units:"meters"});return(0,p.A)(n,o,e,{units:"meters"}).geometry.coordinates}return t}const r=e[e.length-1],[s]=X(e[e.length-2],r,t);return(0,De.A)((0,n.wi)([r,s]),t).geometry.coordinates}getGuides(e){const t=this.getClickSequence(),o={type:"FeatureCollection",features:[]};if(0===t.length||!e.lastPointerMoveEvent)return o;const{mapCoords:n}=e.lastPointerMoveEvent;return o.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...t,this.calculateMapCoords(t,n,e)]}}),o}handleClick(e,t){const o=this.getTentativeGuide(t),n=this.getSelectedGeometry(t);if(!n)return void console.warn("A polygon must be selected for splitting");const i=this.getClickSequence();o&&"LineString"===o.geometry.type?i.push(o.geometry.coordinates[o.geometry.coordinates.length-1]):this.addClickSequence(e);const r={type:"Point",coordinates:i[i.length-1]},s=(0,Te.A)(r,n);if(i.length>1&&o&&!s){this.resetClickSequence();if(0===(0,Fe.A)(o,n).features.length)return;const e=this.splitPolygon(o,t);e&&t.onEdit(e)}}handlePointerMove(e,t){t.onUpdateCursor("cell")}splitPolygon(e,t){const o=this.getSelectedGeometry(t),n=t.selectedIndexes[0],i=t.modeConfig||{};let{gap:r=.1,units:l="centimeters"}=i;0===r&&(r=.1,l="centimeters");const d=(0,s.A)(e,r,{units:l}),c=(0,a.A)(o,d);if(!c)return console.warn("Canceling edit. Split Polygon erased"),null;const{type:p,coordinates:g}=c.geometry;let u=[];u="Polygon"===p?g.map((e=>[e])):g.reduce(((e,t)=>(t.forEach((t=>{e.push([t])})),e)),[]);return{updatedData:new ae(t.data).replaceGeometry(n,{type:"MultiPolygon",coordinates:u}).getObject(),editType:"split",editContext:{featureIndexes:[n]}}}}class He extends we{constructor(){super(...arguments),this.isPointAdded=!1}handleDragging(e,t){const o=ee(e.pointerDownPicks);if(o){const{featureIndex:n}=o.properties;let{positionIndexes:i}=o.properties;const r=this.coordinatesSize(i,n,t.data);i=this.isPointAdded?this.nextPositionIndexes(i,r):i;const s=this.getPointForPositionIndexes(this.prevPositionIndexes(i,r),n,t.data),a=this.getPointForPositionIndexes(i,n,t.data);if(s&&a){const[o,l]=X(s,a,e.mapCoords),d=new ae(t.data).replacePosition(n,this.prevPositionIndexes(i,r),l).replacePosition(n,i,o).getObject();t.onEdit({updatedData:d,editType:"extruding",editContext:{featureIndexes:[n],positionIndexes:this.nextPositionIndexes(i,r),position:o}}),e.cancelPan()}}}handleStartDragging(e,t){const o=t.selectedIndexes,n=oe(e.picks);if(o.length&&n){const{positionIndexes:e,featureIndex:o}=n.properties,i=this.coordinatesSize(e,o,t.data),r=this.getPointForPositionIndexes(this.prevPositionIndexes(e,i),o,t.data),s=this.getPointForPositionIndexes(e,o,t.data);if(r&&s){let n=new ae(t.data);this.isOrthogonal(e,o,i,t.data)||(n=n.addPosition(o,e,s)),this.isOrthogonal(this.prevPositionIndexes(e,i),o,i,t.data)||(n=n.addPosition(o,e,r),this.isPointAdded=!0),t.onEdit({updatedData:n.getObject(),editType:"startExtruding",editContext:{featureIndexes:[o],positionIndexes:e,position:r}})}}}handleStopDragging(e,t){const o=t.selectedIndexes,n=ee(e.pointerDownPicks);if(o.length&&n){const{featureIndex:o}=n.properties;let{positionIndexes:i}=n.properties;const r=this.coordinatesSize(i,o,t.data);i=this.isPointAdded?this.nextPositionIndexes(i,r):i;const s=this.getPointForPositionIndexes(this.prevPositionIndexes(i,r),o,t.data),a=this.getPointForPositionIndexes(i,o,t.data);if(s&&a){const[n,l]=X(s,a,e.mapCoords),d=new ae(t.data).replacePosition(o,this.prevPositionIndexes(i,r),l).replacePosition(o,i,n).getObject();t.onEdit({updatedData:d,editType:"extruded",editContext:{featureIndexes:[o],positionIndexes:i,position:n}})}}this.isPointAdded=!1}coordinatesSize(e,t,o){let{features:n}=o,i=0;if(Array.isArray(e)){const o=n[t].geometry.coordinates;if(3===e.length){const[t,n]=e;o.length&&o[t].length&&(i=o[t][n].length)}else{const[t]=e;o.length&&o[t].length&&(i=o[t].length)}}return i}getBearing(e,t){const o=(0,g.A)(e,t);return o<0?Math.floor(360+o):Math.floor(o)}isOrthogonal(e,t,o,n){if(!Array.isArray(e))return!1;e[e.length-1]===o-1&&(e[e.length-1]=0);const i=this.getPointForPositionIndexes(this.prevPositionIndexes(e,o),t,n),r=this.getPointForPositionIndexes(this.nextPositionIndexes(e,o),t,n),s=this.getPointForPositionIndexes(e,t,n),a=this.getBearing(s,i),l=this.getBearing(s,r);return[89,90,91,269,270,271].includes(Math.abs(a-l))}nextPositionIndexes(e,t){if(!Array.isArray(e))return[];const o=[...e];return o.length&&(o[o.length-1]=o[o.length-1]===t-1?0:o[o.length-1]+1),o}prevPositionIndexes(e,t){if(!Array.isArray(e))return[];const o=[...e];return o.length&&(o[o.length-1]=0===o[o.length-1]?t-2:o[o.length-1]-1),o}getPointForPositionIndexes(e,t,o){let n,{features:i}=o;if(Array.isArray(e)){const o=i[t].geometry.coordinates;if(3===e.length){const[t,i,r]=e;o.length&&o[t].length&&(n=o[t][i][r])}else{const[t,i]=e;o.length&&o[t].length&&(n=o[t][i])}}return n}}function Re(e){let{pointerDownScreenCoords:t,screenCoords:o}=e;return 10*(t[1]-o[1])}class ze extends we{makeElevatedEvent(e,t,o){const{minElevation:n=0,maxElevation:i=2e4,calculateElevationChange:r=Re}=o.modeConfig||{};if(!e.pointerDownScreenCoords)return e;let s=3===t.length?t[2]:0;return s+=r({pointerDownScreenCoords:e.pointerDownScreenCoords,screenCoords:e.screenCoords}),s=Math.min(s,i),s=Math.max(s,n),Object.assign({},e,{mapCoords:[t[0],t[1],s]})}handlePointerMove(e,t){const o=ee(e.pointerDownPicks),n=o?o.geometry.coordinates:e.mapCoords;super.handlePointerMove(this.makeElevatedEvent(e,n,t),t)}handleStopDragging(e,t){const o=ee(e.picks),n=o?o.geometry.coordinates:e.mapCoords;super.handleStopDragging(this.makeElevatedEvent(e,n,t),t)}getCursor(e){let t=super.getCursor(e);return"cell"===t&&(t="ns-resize"),t}static calculateElevationChangeWithViewport(e,t){let{pointerDownScreenCoords:o,screenCoords:n}=t;return 156543.03392*Math.cos(e.latitude*Math.PI/180)/Math.pow(2,e.zoom)*(o[1]-n[1])/2}}class Ne extends me{createTentativeFeature(e){const{lastPointerMoveEvent:t}=e;return{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Point",coordinates:(t?[t.mapCoords]:[])[0]}}}handleClick(e,t){let{mapCoords:o}=e;const n={type:"Point",coordinates:o};t.onEdit(this.getAddFeatureAction(n,t.data))}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}}function Oe(e,t){if(e===t)return!0;if(Array.isArray(e)){const o=e.length;if(!t||t.length!==o)return!1;for(let n=0;n<o;n++)if(e[n]!==t[n])return!1;return!0}return!1}function Ge(e){let t,o={};return n=>{for(const i in n)if(!Oe(n[i],o[i])){t=e(n),o=n;break}return t}}class qe extends me{constructor(){super(...arguments),this.dist=0,this.position=null,this.elems=[],this._getTooltips=Ge((e=>{let{modeConfig:t,dist:o}=e,n=[];const{formatTooltip:i}=t||{};let r;return o&&(r=i?i(o):"Distance: "+parseFloat(o).toFixed(2)+" kilometers",n=[{position:this.position,text:r}]),n}))}handleClick(e,t){const{picks:o}=e,n=ee(o);let i=!1;n||(this.addClickSequence(e),i=!0);const r=this.getClickSequence();if(n||this.calculateInfoDraw(r),r.length>1&&n&&Array.isArray(n.properties.positionIndexes)&&n.properties.positionIndexes[0]===r.length-1){this.dist=0;const e={type:"LineString",coordinates:[...r]};this.resetClickSequence();const o=this.getAddFeatureAction(e,t.data);o&&t.onEdit(o)}else i&&t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}handleKeyUp(e,t){const{key:o}=e;if("Enter"===o){const e=this.getClickSequence();if(e.length>1){const o={type:"LineString",coordinates:[...e]};this.resetClickSequence();const n=this.getAddFeatureAction(o,t.data);n&&t.onEdit(n)}}else"Escape"===o&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}getGuides(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[],i={type:"FeatureCollection",features:[]};let r;o.length>0&&(r={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...o,...n]}}),r&&i.features.push(r);const s=o.map(((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}})));return i.features.push(...s),i}handlePointerMove(e,t){t.onUpdateCursor("cell")}getTooltips(e){return this._getTooltips({modeConfig:e.modeConfig,dist:this.dist})}calculateInfoDraw(e){e.length>1&&(this.position=e[e.length-1],this.dist+=(0,l.A)(e[e.length-2],e[e.length-1]))}}class Ue extends me{createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[];let i;return 1===o.length||2===o.length?i={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...o,...n]}}:o.length>2&&(i={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[...o,...n,o[0]]]}}),i}getGuides(e){const t=this.getClickSequence(),o={type:"FeatureCollection",features:[]},n=this.createTentativeFeature(e);n&&o.features.push(n);const i=t.map(((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}})));return o.features.push(...i),o}handleClick(e,t){const{picks:o}=e,i=ee(o),r=this.getClickSequence();let s=!1;if(r.length>2&&t.modeConfig&&t.modeConfig.preventOverlappingLines){const t=(0,n.wi)([r[r.length-1],e.mapCoords]),o=(0,n.wi)([...r.slice(0,r.length-1)]);(0,Fe.A)(t,o).features.length>0&&(s=!0)}let a=!1;if(i||s||(this.addClickSequence(e),a=!0),r.length>2&&i&&Array.isArray(i.properties.positionIndexes)&&(0===i.properties.positionIndexes[0]||i.properties.positionIndexes[0]===r.length-1)){const e={type:"Polygon",coordinates:[[...r,r[0]]]};this.resetClickSequence();const o=this.getAddFeatureOrBooleanPolygonAction(e,t);o&&t.onEdit(o)}else a&&t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}handleKeyUp(e,t){if("Enter"===e.key){const e=this.getClickSequence();if(e.length>2){const o={type:"Polygon",coordinates:[[...e,e[0]]]};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(o,t);n&&t.onEdit(n)}}else"Escape"===e.key&&(this.resetClickSequence(),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}}class We extends me{handleClick(e,t){t.modeConfig&&t.modeConfig.dragToDraw||(this.addClickSequence(e),this.checkAndFinishPolygon(t))}handleStartDragging(e,t){t.modeConfig&&t.modeConfig.dragToDraw&&(this.addClickSequence(e),e.cancelPan())}handleStopDragging(e,t){t.modeConfig&&t.modeConfig.dragToDraw&&(this.addClickSequence(e),this.checkAndFinishPolygon(t))}checkAndFinishPolygon(e){const t=this.getClickSequence(),o=this.getTentativeGuide(e);if(t.length>1&&o&&"Polygon"===o.geometry.type){const t={type:"Feature",properties:{shape:o.properties.shape},geometry:{type:"Polygon",coordinates:o.geometry.coordinates}},n=this.getAddFeatureOrBooleanPolygonAction(t,e);this.resetClickSequence(),n&&e.onEdit(n)}}getGuides(e){const{lastPointerMoveEvent:t,modeConfig:o}=e,n=this.getClickSequence(),i={type:"FeatureCollection",features:[]};if(0===n.length||!t)return i;const r=n[0],s=t.mapCoords,a=this.getTwoClickPolygon(r,s,o);return a&&i.features.push({type:"Feature",properties:{shape:a.properties&&a.properties.shape,guideType:"tentative"},geometry:a.geometry}),i}getTwoClickPolygon(e,t,o){return null}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[];let i;return 1===o.length&&(i=this.getTwoClickPolygon(o[0],n[0],e.modeConfig)),i}}class Be extends We{getTwoClickPolygon(e,t,o){const n=(0,r.A)([e[0],e[1],t[0],t[1]]);return n.properties=n.properties||{},n.properties.shape="Rectangle",n}}var Je=o(491);class Ke extends We{getTwoClickPolygon(e,t,o){const i=[t[0],e[1]],s=[e[0],t[1]],a=(0,l.A)((0,n.zx)(i),(0,n.zx)(e)),d=(0,l.A)((0,n.zx)(s),(0,n.zx)(e)),c=a<=d?a:d,p=a<=d?i:s,g=(0,n.wi)([p,t]),u=(0,Je.A)(g,c).geometry.coordinates,h=(0,r.A)([e[0],e[1],u[0],u[1]]);return h.properties=h.properties||{},h.properties.shape="Square",h}}class Ve extends We{getTwoClickPolygon(e,t,o){const n=e[0]>t[0]?e[0]+Math.abs(e[0]-t[0]):e[0]-Math.abs(e[0]-t[0]),i=e[1]>t[1]?e[1]+Math.abs(e[1]-t[1]):e[1]-Math.abs(e[1]-t[1]),s=(0,r.A)([n,i,t[0],t[1]]);return s.properties=s.properties||{},s.properties.shape="Rectangle",s}}class $e extends We{getTwoClickPolygon(e,t,o){const i=[t[0],e[1]],s=[e[0],t[1]],a=(0,l.A)((0,n.zx)(i),(0,n.zx)(e)),d=(0,l.A)((0,n.zx)(s),(0,n.zx)(e)),c=a<=d?a:d,p=a<=d?i:s,g=(0,n.wi)([p,t]),u=(0,Je.A)(g,c).geometry.coordinates,h=e[0]>u[0]?e[0]+Math.abs(e[0]-u[0]):e[0]-Math.abs(e[0]-u[0]),m=e[1]>u[1]?e[1]+Math.abs(e[1]-u[1]):e[1]-Math.abs(e[1]-u[1]),f=(0,r.A)([h,m,u[0],u[1]]);return f.properties=f.properties||{},f.properties.shape="Square",f}}var Ze=o(6338),Xe=o(999);class Ye extends We{constructor(){super(...arguments),this.radius=null,this.position=null,this.areaCircle=null,this._getTooltips=Ge((e=>{let{modeConfig:t,radius:o,areaCircle:n}=e,i=[];const{formatTooltip:r}=t||{};let s;return o&&n&&(s=r?r(o):"Radius: "+parseFloat(o).toFixed(2)+" kilometers\n      \n Area: "+parseFloat(n).toFixed(2),i=[{position:this.position,text:s}]),i}))}getTwoClickPolygon(e,t,o){const{steps:n=64}=o||{},i={steps:n};this.position=t,n<4&&(console.warn("Minimum steps to draw a circle is 4 "),i.steps=4),this.radius=Math.max((0,l.A)(e,t),.001);const r=(0,Ze.A)(e,this.radius,i);return r.properties=r.properties||{},r.properties.shape="Circle",this.areaCircle=(0,Xe.A)(r),r}getTooltips(e){return this._getTooltips({modeConfig:null==e?void 0:e.modeConfig,radius:this.radius,areaCircle:this.areaCircle})}}class Qe extends We{constructor(){super(...arguments),this.radius=null,this.position=null,this.areaCircle=null,this.diameter=null,this._getTooltips=Ge((e=>{let{modeConfig:t,radius:o,areaCircle:n,diameter:i}=e,r=[];const{formatTooltip:s}=t||{};let a;return o&&n&&(a=s?s(o):"Radius: "+parseFloat(o).toFixed(2)+" kilometers\n      \n Area: "+parseFloat(n).toFixed(2)+"\n      \n Diameter: "+parseFloat(i).toFixed(2)+" kilometers",r=[{position:this.position,text:a}]),r}))}getTwoClickPolygon(e,t,o){const{steps:n=64}=o||{},i={steps:n};n<4&&(console.warn("Minimum steps to draw a circle is 4 "),i.steps=4);const r=fe(e,t);this.radius=Math.max((0,l.A)(e,r),.001),this.diameter=Math.max((0,l.A)(e,t),.001),this.position=r;const s=(0,Ze.A)(r,this.radius,i);return s.properties=s.properties||{},s.properties.shape="Circle",this.areaCircle=(0,Xe.A)(s),s}getTooltips(e){return this._getTooltips({modeConfig:e.modeConfig,radius:this.radius,areaCircle:this.areaCircle,diameter:this.diameter})}}var et=o(3416);class tt extends We{getTwoClickPolygon(e,t,o){const i=Math.min(e[0],t[0]),s=Math.min(e[1],t[1]),a=Math.max(e[0],t[0]),d=Math.max(e[1],t[1]),c=(0,r.A)([i,s,a,d]).geometry.coordinates[0],p=fe(e,t),g=Math.max((0,l.A)((0,n.zx)(c[0]),(0,n.zx)(c[1])),.001),u=Math.max((0,l.A)((0,n.zx)(c[0]),(0,n.zx)(c[3])),.001);return(0,et.A)(p,g,u)}}class ot extends me{handleClick(e,t){this.addClickSequence(e);const o=this.getClickSequence(),n=this.getTentativeGuide(t);if(o.length>2&&n&&"Polygon"===n.geometry.type){const e=this.getAddFeatureOrBooleanPolygonAction(n.geometry,t);this.resetClickSequence(),e&&t.onEdit(e)}}getGuides(e){const{lastPointerMoveEvent:t,modeConfig:o}=e,n=this.getClickSequence(),i={type:"FeatureCollection",features:[]};if(0===n.length)return i;const r=t.mapCoords;if(1===n.length)i.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[0],r]}});else{const e=this.getThreeClickPolygon(n[0],n[1],r,o);e&&i.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:e.geometry})}return i}getThreeClickPolygon(e,t,o,n){return null}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}createTentativeFeature(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t?[t.mapCoords]:[];let i;return 2===o.length&&(i=this.getThreeClickPolygon(o[0],o[1],n[0],e.modeConfig)),i}}class nt extends ot{getThreeClickPolygon(e,t,o,n){const[i,r]=X(e,t,o);return{type:"Feature",properties:{shape:"Rectangle"},geometry:{type:"Polygon",coordinates:[[e,t,i,r,e]]}}}}class it extends ot{getThreeClickPolygon(e,t,o,i){const r=fe(e,t),s=Math.max((0,l.A)(r,(0,n.zx)(o)),.001),a=Math.max((0,l.A)(e,t),.001)/2,d={angle:(0,g.A)(e,t)};return(0,et.A)(r,s,a,d)}}class rt extends me{createTentativeFeature(e){const t=this.getClickSequence(),{mapCoords:o}=e.lastPointerMoveEvent;let n,i;if(1===t.length)n=o;else{const e=t[t.length-2],i=t[t.length-1];[n]=X(e,i,o)}return i=t.length<3?{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...t,n]}}:{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[...t,n,t[0]]]}},i}getGuides(e){const t={type:"FeatureCollection",features:[]};if(0===this.getClickSequence().length||!e.lastPointerMoveEvent)return t;const o=this.createTentativeFeature(e);return t.features.push(o),t.features=t.features.concat(ie(o.geometry,-1)),t.features=t.features.slice(0,-1),t}handlePointerMove(e,t){t.onUpdateCursor("cell"),super.handlePointerMove(e,t)}handleClick(e,t){const{picks:o}=e,n=this.getTentativeGuide(t);this.addClickSequence(e);const i=this.getClickSequence();if(!n)return;if(3===i.length&&"LineString"===n.geometry.type){const e=n.geometry;i[i.length-1]=e.coordinates[e.coordinates.length-1]}else if(i.length>3&&"Polygon"===n.geometry.type){const e=n.geometry;i[i.length-1]=e.coordinates[0][e.coordinates[0].length-2];const r=ee(o);if(r&&Array.isArray(r.properties.positionIndexes)&&(0===r.properties.positionIndexes[1]||r.properties.positionIndexes[1]===e.coordinates[0].length-3)){const o={type:"Polygon",coordinates:this.finalizedCoordinates([...e.coordinates[0]])};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(o,t);n&&t.onEdit(n)}}const r={screenCoords:[-1,-1],mapCoords:e.mapCoords,picks:[],pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,cancelPan:()=>{},sourceEvent:null};this.handlePointerMove(r,t)}finalizedCoordinates(e){let t=[[...e.slice(0,-2),e[0]]],o=this.getIntermediatePoint([...e]);if(o)t=[[...e.slice(0,-2),o,e[0]]];else{const n=[...e];n.splice(-3,1),o=this.getIntermediatePoint([...n]),o&&(t=[[...e.slice(0,-3),o,e[0]]])}return t}getIntermediatePoint(e){let t=null;if(e.length>4){const[o,i]=[...e],r=(0,g.A)(o,i),s=e[e.length-3],a=e[e.length-4],d=(0,g.A)(s,a),c={first:[],second:[]};[1,2,3].forEach((e=>{const t=r+90*e;c.first.push(t>180?t-360:t);const o=d+90*e;c.second.push(o>180?o-360:o)}));const u=(0,l.A)((0,n.zx)(o),(0,n.zx)(s));[0,1,2].forEach((e=>{const i=(0,n.wi)([o,(0,p.A)(o,u,c.first[e]).geometry.coordinates]);[0,1,2].forEach((e=>{const o=(0,n.wi)([s,(0,p.A)(s,u,c.second[e]).geometry.coordinates]),r=(0,Fe.A)(i,o);r&&r.features.length&&(t=r.features[0].geometry.coordinates)}))}))}return t}}var st=o(8550),at=o.n(st);class lt extends Ue{constructor(){super(...arguments),this.handleDraggingThrottled=null}handleClick(e,t){}handleStartDragging(e,t){e.cancelPan(),t.modeConfig&&t.modeConfig.throttleMs?this.handleDraggingThrottled=at()(this.handleDraggingAux,t.modeConfig.throttleMs):this.handleDraggingThrottled=this.handleDraggingAux}handleStopDragging(e,t){this.addClickSequence(e);const o=this.getClickSequence();if(this.handleDraggingThrottled&&this.handleDraggingThrottled.cancel&&this.handleDraggingThrottled.cancel(),o.length>2){const e={type:"Polygon",coordinates:[[...o,o[0]]]},n=this.getAddFeatureOrBooleanPolygonAction(e,t);n&&t.onEdit(n)}this.resetClickSequence()}handleDraggingAux(e,t){const{picks:o}=e;ee(o)||(this.addClickSequence(e),t.onEdit({updatedData:t.data,editType:"addTentativePosition",editContext:{position:e.mapCoords}}))}handleDragging(e,t){this.handleDraggingThrottled&&this.handleDraggingThrottled(e,t)}handleKeyUp(e,t){if("Enter"===e.key){const e=this.getClickSequence();if(e.length>2){const o={type:"Polygon",coordinates:[[...e,e[0]]]};this.resetClickSequence();const n=this.getAddFeatureOrBooleanPolygonAction(o,t);n&&t.onEdit(n)}}else"Escape"===e.key&&(this.resetClickSequence(),this.handleDraggingThrottled&&(this.handleDraggingThrottled=null),t.onEdit({updatedData:t.data,editType:"cancelFeature",editContext:{}}))}}class dt extends me{constructor(e){super(),this._handler=e}_getSnappedMouseEvent(e,t,o){return Object.assign(e,{mapCoords:o.geometry.coordinates,pointerDownMapCoords:t&&t.geometry.coordinates})}_getPickedSnapTarget(e){return ne(e).find((e=>"snap-target"===e.properties.editHandleType))}_getPickedSnapSource(e){return ne(e).find((e=>"snap-source"===e.properties.editHandleType))}_getUpdatedSnapSourceHandle(e,t){const{featureIndex:o,positionIndexes:n}=e.properties;if(!Array.isArray(n))return e;const i=t.features[o],r=n.reduce(((e,t)=>e[t]),i.geometry.coordinates);return{...e,geometry:{type:"Point",coordinates:r}}}_getSnapTargets(e){let{additionalSnapTargets:t}=e.modeConfig||{};t=t||[];return[...e.data.features,...t]}_getSnapTargetHandles(e){const t=[],o=this._getSnapTargets(e);for(let n=0;n<o.length;n++){if(!e.selectedIndexes.includes(n)){const{geometry:e}=o[n];t.push(...ie(e,n,"snap-target"))}}return t}getGuides(e){const{modeConfig:t,lastPointerMoveEvent:o}=e,{enableSnapping:n}=t||{},i={type:"FeatureCollection",features:[...this._handler.getGuides(e).features]};if(!n)return i;const r=o&&this._getPickedSnapSource(o.pointerDownPicks);if(r)return i.features.push(...this._getSnapTargetHandles(e),this._getUpdatedSnapSourceHandle(r,e.data)),i;const{features:s}=e.data;for(const a of e.selectedIndexes)if(a<s.length){const{geometry:e}=s[a];i.features.push(...ie(e,a,"snap-source"))}return i}_getSnapAwareEvent(e,t){const o=this._getPickedSnapSource(t.lastPointerMoveEvent.pointerDownPicks),n=this._getPickedSnapTarget(e.picks);return o&&n?this._getSnappedMouseEvent(e,o,n):e}handleStartDragging(e,t){this._handler.handleStartDragging(e,t)}handleStopDragging(e,t){this._handler.handleStopDragging(this._getSnapAwareEvent(e,t),t)}handleDragging(e,t){this._handler.handleDragging(this._getSnapAwareEvent(e,t),t)}handlePointerMove(e,t){this._handler.handlePointerMove(this._getSnapAwareEvent(e,t),t)}}class ct extends me{constructor(e){super(),this._modes=e}_coalesce(e,t){void 0===t&&(t=null);let o=null;for(let n=0;n<this._modes.length&&(o=e(this._modes[n]),!(t?t(o):o));n++);return o}handleClick(e,t){this._coalesce((o=>o.handleClick(e,t)))}handlePointerMove(e,t){return this._coalesce((o=>o.handlePointerMove(e,t)))}handleStartDragging(e,t){return this._coalesce((o=>o.handleStartDragging(e,t)))}handleStopDragging(e,t){return this._coalesce((o=>o.handleStopDragging(e,t)))}handleDragging(e,t){return this._coalesce((o=>o.handleDragging(e,t)))}getGuides(e){const t=[];for(const o of this._modes)t.push(...o.getGuides(e).features);return{type:"FeatureCollection",features:t}}}class pt extends ct{constructor(){super([new Pe,new Ie,new Me])}handlePointerMove(e,t){let o=null;super.handlePointerMove(e,{...t,onUpdateCursor:e=>{o=e||o}}),t.onUpdateCursor(o)}handleStartDragging(e,t){let o=null,n=null;const i=[];this._modes.forEach((e=>{e instanceof Pe?n=e:(e instanceof Ie&&(o=e),i.push(e))})),o instanceof Ie&&!o.isEditHandleSelected()&&i.push(n),i.filter(Boolean).forEach((o=>o.handleStartDragging(e,t)))}getGuides(e){let t=super.getGuides(e);const o=(this._modes||[]).find((e=>e instanceof Me));if(o instanceof Me){const e=t.features.filter((e=>{const{editHandleType:t,mode:n}=e.properties||{},i=[n];return o.getIsRotating()&&i.push(t),!i.includes("scale")}));t=(0,n.Lr)(e)}return t}}const gt=["anyclick","pointermove","panstart","panmove","panend","keyup"];class ut extends m.A{constructor(){super(...arguments),this.state=void 0}onLayerClick(e){}onStartDragging(e){}onStopDragging(e){}onDragging(e){}onPointerMove(e){}onLayerKeyUp(e){}initializeState(){this.setState({_editableLayerState:{pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,eventHandler:this._forwardEventToCurrentLayer.bind(this)}}),this._addEventHandlers()}finalizeState(){this._removeEventHandlers()}_addEventHandlers(){const{eventManager:e}=this.context.deck,{eventHandler:t}=this.state._editableLayerState;for(const o of gt)e.on(o,t,{priority:100})}_removeEventHandlers(){const{eventManager:e}=this.context.deck,{eventHandler:t}=this.state._editableLayerState;for(const o of gt)e.off(o,t)}_forwardEventToCurrentLayer(e){const t=this.getCurrentLayer(),o=t["_on"+e.type].bind(t);o?o(e):console.warn("no handler for mjolnir.js event "+e.type)}_onanyclick(e){let{srcEvent:t}=e;const o=this.getScreenCoords(t),n=this.getMapCoords(o),i=this.getPicks(o);this.onLayerClick({mapCoords:n,screenCoords:o,picks:i,sourceEvent:t})}_onkeyup(e){let{srcEvent:t}=e;this.onLayerKeyUp(t)}_onpanstart(e){const t=this.getScreenCoords(e.srcEvent),o=this.getMapCoords(t),n=this.getPicks(t);this.setState({_editableLayerState:{...this.state._editableLayerState,pointerDownScreenCoords:t,pointerDownMapCoords:o,pointerDownPicks:n}}),this.onStartDragging({picks:n,screenCoords:t,mapCoords:o,pointerDownScreenCoords:t,pointerDownMapCoords:o,cancelPan:e.stopImmediatePropagation,sourceEvent:e.srcEvent})}_onpanmove(e){const{srcEvent:t}=e,o=this.getScreenCoords(t),n=this.getMapCoords(o),{pointerDownPicks:i,pointerDownScreenCoords:r,pointerDownMapCoords:s}=this.state._editableLayerState,a=this.getPicks(o);this.onDragging({screenCoords:o,mapCoords:n,picks:a,pointerDownPicks:i,pointerDownScreenCoords:r,pointerDownMapCoords:s,sourceEvent:t,cancelPan:e.stopImmediatePropagation})}_onpanend(e){let{srcEvent:t}=e;const o=this.getScreenCoords(t),n=this.getMapCoords(o),{pointerDownPicks:i,pointerDownScreenCoords:r,pointerDownMapCoords:s}=this.state._editableLayerState,a=this.getPicks(o);this.onStopDragging({picks:a,screenCoords:o,mapCoords:n,pointerDownPicks:i,pointerDownScreenCoords:r,pointerDownMapCoords:s,sourceEvent:t}),this.setState({_editableLayerState:{...this.state._editableLayerState,pointerDownScreenCoords:null,pointerDownMapCoords:null,pointerDownPicks:null}})}_onpointermove(e){const{srcEvent:t}=e,o=this.getScreenCoords(t),n=this.getMapCoords(o),{pointerDownPicks:i,pointerDownScreenCoords:r,pointerDownMapCoords:s}=this.state._editableLayerState,a=this.getPicks(o);this.onPointerMove({screenCoords:o,mapCoords:n,picks:a,pointerDownPicks:i,pointerDownScreenCoords:r,pointerDownMapCoords:s,sourceEvent:t,cancelPan:e.stopImmediatePropagation})}getPicks(e){return this.context.deck.pickMultipleObjects({x:e[0],y:e[1],layerIds:[this.props.id],radius:this.props.pickingRadius,depth:this.props.pickingDepth})}getScreenCoords(e){return[e.clientX-this.context.gl.canvas.getBoundingClientRect().left,e.clientY-this.context.gl.canvas.getBoundingClientRect().top]}getMapCoords(e){return this.context.viewport.unproject([e[0],e[1]])}}ut.layerName="EditableLayer";const ht={...b.A.defaultProps,pickingLineWidthExtraPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER}};class mt extends b.A{getShaders(){var e;const t=super.getShaders();return t.vs=function(e,t,o){const n=e.indexOf(t);return n<0?e:e.slice(0,n)+o+e.slice(n)}(t.vs,"vec3 width;","\n       if(bool(picking.isActive)){\n        widthPixels.xy += pickingLineWidthExtraPixels;\n       }\n      "),{...t,inject:{...t.inject||{},"vs:#decl":((null==(e=t.inject)?void 0:e["vs:#decl"])||"").concat("uniform float pickingLineWidthExtraPixels;")}}}draw(e){super.draw({...e,uniforms:{...e.uniforms,pickingLineWidthExtraPixels:this.props.pickingLineWidthExtraPixels}})}}mt.defaultProps=ht,mt.layerName="EditablePathLayer";const ft=[0,0,0,153],yt=[0,0,0,144],xt=[0,0,0,255],Ct=[0,0,144,144],vt=[144,144,144,255],bt=[144,144,144,144],St=[192,0,0,255],Pt=[0,0,0,128],wt=[124,0,192,255],kt=[255,255,255,255],At=Ue;function _t(e){return e&&"function"==typeof e?t=>e(function(e){if(e.__source)return e.__source.object;if(e.sourceFeature)return e.sourceFeature.feature;return e}(t)):e}function It(e){switch(e.properties.editHandleType){case"existing":return St;case"snap-source":return wt;default:return Pt}}const jt={mode:At,onEdit:()=>{},pickable:!0,pickingRadius:10,pickingDepth:5,fp64:!1,filled:!0,stroked:!0,lineWidthScale:w,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,pickingLineWidthExtraPixels:0,lineWidthUnits:"pixels",lineJointRounded:!1,lineCapRounded:!1,lineMiterLimit:4,pointRadiusScale:1,pointRadiusMinPixels:2,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:(e,t,o)=>t?xt:ft,getFillColor:(e,t,o)=>t?Ct:yt,getRadius:e=>e&&e.properties&&e.properties.radius||e&&e.properties&&e.properties.size||1,getLineWidth:e=>e&&e.properties&&e.properties.lineWidth||3,getTentativeLineColor:e=>vt,getTentativeFillColor:e=>bt,getTentativeLineWidth:e=>e&&e.properties&&e.properties.lineWidth||3,editHandleType:"point",editHandlePointRadiusScale:1,editHandlePointOutline:!0,editHandlePointStrokeWidth:2,editHandlePointRadiusUnits:"pixels",editHandlePointRadiusMinPixels:4,editHandlePointRadiusMaxPixels:8,getEditHandlePointColor:It,getEditHandlePointOutlineColor:function(e){return kt},getEditHandlePointRadius:function(e){switch(e.properties.editHandleType){case"existing":return 5;case"snap":return 7;default:return 3}},editHandleIconAtlas:null,editHandleIconMapping:null,editHandleIconSizeScale:1,editHandleIconSizeUnits:"pixels",getEditHandleIcon:e=>e.properties.editHandleType,getEditHandleIconSize:10,getEditHandleIconColor:It,getEditHandleIconAngle:0,billboard:!0},Mt={view:ye,modify:we,translate:new dt(new Pe),transform:new dt(new pt),scale:Ie,rotate:Me,duplicate:Ee,split:Le,extrude:He,elevation:ze,drawPoint:Ne,drawLineString:qe,drawPolygon:Ue,drawRectangle:Be,drawSquare:Ke,drawRectangleFromCenter:Ve,drawSquareFromCenter:$e,drawCircleFromCenter:Ye,drawCircleByBoundingBox:Qe,drawEllipseByBoundingBox:tt,drawRectangleUsing3Points:nt,drawEllipseUsing3Points:it,draw90DegreePolygon:rt,drawPolygonByDragging:lt};class Et extends ut{constructor(){super(...arguments),this.state=void 0}renderLayers(){const e=this.getSubLayerProps({id:"geojson",data:this.props.data,fp64:this.props.fp64,filled:this.props.filled,stroked:this.props.stroked,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,pointRadiusScale:this.props.pointRadiusScale,pointRadiusMinPixels:this.props.pointRadiusMinPixels,pointRadiusMaxPixels:this.props.pointRadiusMaxPixels,getLineColor:this.selectionAwareAccessor(this.props.getLineColor),getFillColor:this.selectionAwareAccessor(this.props.getFillColor),getPointRadius:this.selectionAwareAccessor(this.props.getRadius),getLineWidth:this.selectionAwareAccessor(this.props.getLineWidth),_subLayerProps:{linestrings:{billboard:this.props.billboard,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}},"polygons-stroke":{billboard:this.props.billboard,pickingLineWidthExtraPixels:this.props.pickingLineWidthExtraPixels,type:mt,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}}},updateTriggers:{getLineColor:[this.props.selectedFeatureIndexes,this.props.mode],getFillColor:[this.props.selectedFeatureIndexes,this.props.mode],getPointRadius:[this.props.selectedFeatureIndexes,this.props.mode],getLineWidth:[this.props.selectedFeatureIndexes,this.props.mode]}});let t=[new U.A(e)];return t=t.concat(this.createGuidesLayers(),this.createTooltipsLayers()),t}initializeState(){super.initializeState(),this.setState({selectedFeatures:[],editHandles:[]})}shouldUpdateState(e){return super.shouldUpdateState(e)||e.changeFlags.stateChanged}updateState(e){let{props:t,oldProps:o,changeFlags:n,context:i}=e;if(super.updateState({oldProps:o,props:t,changeFlags:n,context:i}),n.propsOrDataChanged){if(0===Object.keys(o).length||t.mode!==o.mode){let e;if("function"==typeof t.mode){e=new(0,t.mode)}else"string"==typeof t.mode?(e=Mt[t.mode],console.warn("Deprecated use of passing `mode` as a string. Pass the mode's class constructor instead.")):e=t.mode;e||(console.warn("No mode configured for "+String(t.mode)),e=new At),e!==this.state.mode&&this.setState({mode:e,cursor:null})}}let r=[];if(Array.isArray(t.selectedFeatureIndexes)&&"object"==typeof t.data&&"features"in t.data){const e=t.data;r=t.selectedFeatureIndexes.map((t=>e.features[t]))}this.setState({selectedFeatures:r})}getModeProps(e){return{modeConfig:e.modeConfig,data:e.data,selectedIndexes:e.selectedFeatureIndexes,lastPointerMoveEvent:this.state.lastPointerMoveEvent,cursor:this.state.cursor,onEdit:t=>{this.setNeedsUpdate(),e.onEdit(t)},onUpdateCursor:e=>{this.setState({cursor:e})}}}selectionAwareAccessor(e){return"function"!=typeof e?e:t=>e(t,this.isFeatureSelected(t),this.props.mode)}isFeatureSelected(e){return!(!this.props.data||!this.props.selectedFeatureIndexes)&&(!!this.props.selectedFeatureIndexes.length&&this.state.selectedFeatures.includes(e))}getPickingInfo(e){let{info:t,sourceLayer:o}=e;return o.id.endsWith("guides")&&(t.isGuide=!0),t}_updateAutoHighlight(e){if(null!=e&&e.sourceLayer)if(e.isGuide)for(const t of e.sourceLayer.getSubLayers())t.updateAutoHighlight(e);else e.sourceLayer.updateAutoHighlight(e)}createGuidesLayers(){const e=this.getActiveMode().getGuides(this.getModeProps(this.props));if(!e||!e.features.length)return[];const t={linestrings:{billboard:this.props.billboard,autoHighlight:!1},"polygons-fill":{autoHighlight:!1},"polygons-stroke":{billboard:this.props.billboard}};"icon"===this.props.editHandleType?t["points-icon"]={type:W.A,iconAtlas:this.props.editHandleIconAtlas,iconMapping:this.props.editHandleIconMapping,sizeUnits:this.props.editHandleIconSizeUnits,sizeScale:this.props.editHandleIconSizeScale,getIcon:_t(this.props.getEditHandleIcon),getSize:_t(this.props.getEditHandleIconSize),getColor:_t(this.props.getEditHandleIconColor),getAngle:_t(this.props.getEditHandleIconAngle),billboard:this.props.billboard}:t["points-circle"]={type:f.A,radiusScale:this.props.editHandlePointRadiusScale,stroked:this.props.editHandlePointOutline,getLineWidth:this.props.editHandlePointStrokeWidth,radiusUnits:this.props.editHandlePointRadiusUnits,radiusMinPixels:this.props.editHandlePointRadiusMinPixels,radiusMaxPixels:this.props.editHandlePointRadiusMaxPixels,getRadius:_t(this.props.getEditHandlePointRadius),getFillColor:_t(this.props.getEditHandlePointColor),getLineColor:_t(this.props.getEditHandlePointOutlineColor),billboard:this.props.billboard};return[new U.A(this.getSubLayerProps({id:"guides",data:e,fp64:this.props.fp64,_subLayerProps:t,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,getLineColor:_t(this.props.getTentativeLineColor),getLineWidth:_t(this.props.getTentativeLineWidth),getFillColor:_t(this.props.getTentativeFillColor),pointType:"icon"===this.props.editHandleType?"icon":"circle",iconAtlas:this.props.editHandleIconAtlas}))]}createTooltipsLayers(){const e=this.getActiveMode().getTooltips(this.getModeProps(this.props));return[new x.A({getSize:21.333333333333332,...this.getSubLayerProps({id:"tooltips",data:e})})]}onLayerClick(e){this.getActiveMode().handleClick(e,this.getModeProps(this.props))}onLayerKeyUp(e){this.getActiveMode().handleKeyUp(e,this.getModeProps(this.props))}onStartDragging(e){this.getActiveMode().handleStartDragging(e,this.getModeProps(this.props))}onDragging(e){this.getActiveMode().handleDragging(e,this.getModeProps(this.props))}onStopDragging(e){this.getActiveMode().handleStopDragging(e,this.getModeProps(this.props))}onPointerMove(e){this.setState({lastPointerMoveEvent:e}),this.getActiveMode().handlePointerMove(e,this.getModeProps(this.props))}getCursor(e){let{isDragging:t}=e;if(null===this.state||void 0===this.state)return null;let{cursor:o}=this.state;return o||(o=t?"grabbing":"grab"),o}getActiveMode(){return this.state.mode}}Et.layerName="EditableGeoJsonLayer",Et.defaultProps=jt;var Tt=o(2448);const Ft={type:"FeatureCollection",features:[]},Dt={mode:ye,...Et.defaultProps,data:[],selectedIndexes:[],filled:!1,stroked:!0,lineWidthScale:w,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineWidthUnits:"pixels",getHexagons:e=>e.hexIds,getEditedCluster:(e,t)=>t?{...t,hexIds:e}:{hexIds:e},resolution:9};class Lt extends ut{constructor(){super(...arguments),this.state=void 0}initializeState(){super.initializeState(),this.setState({tentativeHexagonIDs:[]})}getDerivedHexagonIDs(e){throw new Error("not implemented")}getDerivedHexagonID(e){throw new Error("not implemented")}renderLayers(){return[new Et(this.getSubLayerProps({id:"editable-geojson",mode:this.props.mode,data:Ft,selectedFeatureIndexes:[],onEdit:e=>{const{editType:t,editContext:o}=e;switch(t){case"updateTentativeFeature":if("Polygon"===o.feature.geometry.type){const e=o.feature.geometry.coordinates,t=this.getDerivedHexagonIDs(e);this.setState({tentativeHexagonIDs:t})}else if("Point"===o.feature.geometry.type){const e=o.feature.geometry.coordinates,t=this.getDerivedHexagonID(e);this.setState({tentativeHexagonIDs:[t]})}break;case"addFeature":const e=[...this.props.data],{modeConfig:t}=this.props;if(t&&t.booleanOperation)if(1!==this.props.selectedIndexes.length)console.warn("booleanOperation only supported for single cluster selection");else{let o;const n=new Set(this.getSelectedHexIDs()),i=new Set(this.state.tentativeHexagonIDs);switch(t.booleanOperation){case"union":default:o=[...new Set([...n,...i])];break;case"intersection":o=[...n].filter((e=>i.has(e)));break;case"difference":o=[...n].filter((e=>!i.has(e)))}const r=this.props.selectedIndexes[0],s=this.props.data[r];e[r]=this.props.getEditedCluster(o,s)}else e.push(this.props.getEditedCluster(this.state.tentativeHexagonIDs,null));this.setState({tentativeHexagonIDs:[]}),this.props.onEdit({updatedData:e})}}})),new Tt.A(this.getSubLayerProps({id:"hexagons",data:this.props.data,getHexagons:this.props.getHexagons})),new Tt.A(this.getSubLayerProps({id:"tentative-hexagons",data:[{hexIds:this.state.tentativeHexagonIDs}],getHexagons:e=>e.hexIds}))]}getSelectedHexIDs(){let e=[];return this.props.selectedIndexes.forEach((t=>{const o=this.props.data[t],n=this.props.getHexagons(o);e=e.concat(n)})),e}getCursor(e){let{isDragging:t}=e,{cursor:o}=this.state||{};return o||(o=t?"grabbing":"grab"),o}}Lt.layerName="EditableH3ClusterLayer",Lt.defaultProps=Dt;var Ht=o(9751);const Rt="rectangle",zt="polygon",Nt={[Rt]:Be,[zt]:Ue},Ot={[Rt]:{dragToDraw:!0}},Gt={selectionType:Rt,layerIds:[],onSelect:()=>{}},qt={type:"FeatureCollection",features:[]},Ut="selection-blocker",Wt=["lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","lineWidthUnits","lineJointRounded","lineCapRounded","lineMiterLimit","pointRadiusScale","pointRadiusMinPixels","pointRadiusMaxPixels","lineDashJustified","getLineColor","getFillColor","getRadius","getLineWidth","getLineDashArray","getTentativeLineDashArray","getTentativeLineColor","getTentativeFillColor","getTentativeLineWidth"];class Bt extends m.A{constructor(){super(...arguments),this.state=void 0}_selectRectangleObjects(e){const{layerIds:t,onSelect:o}=this.props,[n,i]=this.context.viewport.project(e[0][0]),[r,s]=this.context.viewport.project(e[0][2]);o({pickingInfos:this.context.deck.pickObjects({x:Math.min(n,r),y:Math.min(i,s),width:Math.abs(r-n),height:Math.abs(s-i),layerIds:t})})}_selectPolygonObjects(e){const{layerIds:t,onSelect:o}=this.props,i=e[0].map((e=>this.context.viewport.project(e))),r=i.map((e=>e[0])),l=i.map((e=>e[1])),d=Math.min(...r),c=Math.min(...l),p=Math.max(...r),g=Math.max(...l),u=(0,n.n1)(e),h=(0,s.A)(u,50);let m;try{m=(0,a.A)(h,u)}catch(y){return void console.log("turfDifference() error",y)}this.setState({pendingPolygonSelection:{bigPolygon:m}});const f=this.props.id+"-"+Ut;setTimeout((()=>{const e=this.context.deck.pickObjects({x:d,y:c,width:p-d,height:g-c,layerIds:[f,...t]});o({pickingInfos:e.filter((e=>e.layer.id!==this.props.id))})}),250)}renderLayers(){const{pendingPolygonSelection:e}=this.state,t=Nt[this.props.selectionType]||ye,o=Ot[this.props.selectionType],n={};Wt.forEach((e=>{void 0!==this.props[e]&&(n[e]=this.props[e])}));const i=[new Et(this.getSubLayerProps({id:"selection-geojson",pickable:!0,mode:t,modeConfig:o,selectedFeatureIndexes:[],data:qt,onEdit:e=>{let{updatedData:t,editType:o}=e;if("addFeature"===o){const{coordinates:e}=t.features[0].geometry;this.props.selectionType===Rt?this._selectRectangleObjects(e):this.props.selectionType===zt&&this._selectPolygonObjects(e)}},...n}))];if(e){const{bigPolygon:t}=e;i.push(new Ht.A(this.getSubLayerProps({id:Ut,pickable:!0,stroked:!1,opacity:1,data:[t],getLineColor:e=>[0,0,0,1],getFillColor:e=>[0,0,0,1],getPolygon:e=>e.geometry.coordinates})))}return i}shouldUpdateState(e){let{changeFlags:{stateChanged:t,propsOrDataChanged:o}}=e;return t||o}}Bt.layerName="SelectionLayer",Bt.defaultProps=Gt;var Jt=o(772);class Kt extends m.A{renderLayers(){return[new f.A(Object.assign({},this.props,{id:this.props.id+"-ScatterplotLayer",data:this.props.data})),new Jt.A(Object.assign({},this.props,{id:this.props.id+"-LineLayer",data:this.props.data,pickable:!1,getSourcePosition:e=>{let{position:t}=e;return[t[0],t[1],0]},getTargetPosition:e=>{let{position:t}=e;return[t[0],t[1],t[2]||0]},getColor:[150,150,150,200],getStrokeWidth:3}))]}}Kt.layerName="ElevatedEditHandleLayer",Kt.defaultProps={};class Vt extends me{constructor(){super(...arguments),this._isResizing=!1}getGuides(e){const t=[],o=e.selectedIndexes,{lastPointerMoveEvent:i}=e,r=i&&i.picks,s=i&&i.mapCoords;if(r&&r.length&&s&&1===o.length&&!this._isResizing){const o=r.find((e=>!e.isGuide));if(o&&o.object.properties.shape&&o.object.properties.shape.includes("Circle")&&e.selectedIndexes.includes(o.index)){let i=null,r=[];const a=(0,n.zx)(s);if(Z(o.object.geometry.coordinates,[],((t,o)=>{const s=(0,n.wi)(t),l=this.getNearestPoint(s,a,e.modeConfig&&e.modeConfig.viewport);(!i||l.properties.dist<i.properties.dist)&&(i=l,r=o)})),i){const{geometry:{coordinates:e},properties:{index:n}}=i;t.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:o.index,positionIndexes:[...r,n+1]},geometry:{type:"Point",coordinates:e}})}}}return{type:"FeatureCollection",features:t}}getNearestPoint(e,t,o){const{coordinates:n}=e.geometry;if(n.some((e=>e.length>2))){if(o)return Q(e,t,o);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return(0,De.A)(e,t)}handleDragging(e,t){const o=ee(e.pointerDownPicks);if(o){e.cancelPan();const n=o.properties,i=this.getSelectedFeature(t),r=(0,Ce.A)(i).geometry.coordinates,s=Object.entries(i.geometry.coordinates[0]).length-1,a=Math.max((0,l.A)(r,e.mapCoords),.001),{steps:d=s}={},c={steps:d},p=(0,Ze.A)(r,a,c).geometry,g=new ae(t.data).replaceGeometry(n.featureIndex,p).getObject();t.onEdit({updatedData:g,editType:"unionGeometry",editContext:{featureIndexes:[n.featureIndex]}})}}handlePointerMove(e,t){if(!this._isResizing){const t=ee(e.picks);this._selectedEditHandle=t&&"intermediate"===t.properties.editHandleType?t:null}const o=this.getCursor(e);t.onUpdateCursor(o)}handleStartDragging(e,t){this._selectedEditHandle&&(this._isResizing=!0)}handleStopDragging(e,t){this._isResizing&&(this._selectedEditHandle=null,this._isResizing=!1)}getCursor(e){return ne(e&&e.picks||[]).length?"cell":null}}class $t extends me{getSingleSelectedLineString(e){const t=this.getSelectedGeometry(e);return t&&"LineString"===t.type?t:null}handleClick(e,t){const{selectedIndexes:o}=t,n=this.getSingleSelectedLineString(t);if(!n)return void console.warn("ExtendLineStringMode only supported for single LineString selection");let i=[n.coordinates.length];const r=t.modeConfig;r&&r.drawAtFront&&(i=[0]);const s=o[0],a=new ae(t.data).addPosition(s,i,e.mapCoords).getObject();t.onEdit({updatedData:a,editType:"addPosition",editContext:{featureIndexes:[s],positionIndexes:i,position:e.mapCoords}})}getGuides(e){const t={type:"FeatureCollection",features:[]},o=this.getSingleSelectedLineString(e);if(!o)return t;const n=e.lastPointerMoveEvent&&e.lastPointerMoveEvent.mapCoords;let i=null;const{modeConfig:r}=e;return i=r&&r.drawAtFront?o.coordinates[0]:o.coordinates[o.coordinates.length-1],t.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[i,n]}}),t}handlePointerMove(e,t){t.onUpdateCursor("cell")}}var Zt=o(3922);class Xt extends me{constructor(){super(...arguments),this._isMeasuringSessionFinished=!1,this._currentTooltips=[],this._currentDistance=0,this._calculateDistanceForTooltip=e=>{let{positionA:t,positionB:o,modeConfig:n}=e;const{turfOptions:i,measurementCallback:r}=n||{},s=(0,l.A)(t,o,i);return r&&r(s),s}}_formatTooltip(e,t){const{formatTooltip:o,turfOptions:n}=t||{},i=n&&n.units||"kilometers";let r;return r=o?o(e):parseFloat(e).toFixed(2)+" "+i,r}handleClick(e,t){const{modeConfig:o,data:n,onEdit:i}=t,{centerTooltipsOnLine:r=!1}=o||{};this._isMeasuringSessionFinished&&(this._isMeasuringSessionFinished=!1,this.resetClickSequence(),this._currentTooltips=[],this._currentDistance=0);const{picks:s}=e,a=ee(s);let l=!1;a||(this.addClickSequence(e),l=!0);const d=this.getClickSequence();if(d.length>1&&a&&Array.isArray(a.properties.positionIndexes)&&a.properties.positionIndexes[0]===d.length-1)this._isMeasuringSessionFinished=!0;else if(l){if(d.length>1){this._currentDistance+=this._calculateDistanceForTooltip({positionA:d[d.length-2],positionB:d[d.length-1],modeConfig:o});const t=r?(0,Zt.A)(d[d.length-2],d[d.length-1]).geometry.coordinates:e.mapCoords;this._currentTooltips.push({position:t,text:this._formatTooltip(this._currentDistance,o)})}i({updatedData:n,editType:"addTentativePosition",editContext:{position:e.mapCoords}})}}handleKeyUp(e,t){if(this._isMeasuringSessionFinished)return;e.stopPropagation();const{key:o}=e,n=this.getClickSequence().length;switch(o){case"Escape":this._isMeasuringSessionFinished=!0,1===n&&(this.resetClickSequence(),this._currentTooltips=[]),t.onUpdateCursor("cell");break;case"Enter":this.handleClick(t.lastPointerMoveEvent,t),this._isMeasuringSessionFinished=!0}}getGuides(e){const{lastPointerMoveEvent:t}=e,o=this.getClickSequence(),n=t&&!this._isMeasuringSessionFinished?[t.mapCoords]:[],i={type:"FeatureCollection",features:[]};o.length>0&&i.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[...o,...n]}});const r=o.map(((e,t)=>({type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[t]},geometry:{type:"Point",coordinates:e}})));return i.features.push(...r),i}handlePointerMove(e,t){t.onUpdateCursor("cell")}getTooltips(e){const{lastPointerMoveEvent:t,modeConfig:o}=e,{centerTooltipsOnLine:n=!1}=o||{},i=this.getClickSequence();if(i.length>0&&t&&!this._isMeasuringSessionFinished){const r=this._calculateDistanceForTooltip({positionA:i[i.length-1],positionB:t.mapCoords,modeConfig:e.modeConfig}),s=n?(0,Zt.A)(i[i.length-1],t.mapCoords).geometry.coordinates:t.mapCoords;return[...this._currentTooltips,{position:s,text:this._formatTooltip(this._currentDistance+r,o)}]}return this._currentTooltips}}const Yt=[];class Qt extends Ue{handleClick(e,t){const o={...t,onEdit:()=>{}};super.handleClick(e,o)}handleKeyUp(e,t){const o={...t,onEdit:()=>{}};super.handleKeyUp(e,o)}getTooltips(e){const t=this.getTentativeGuide(e);if(t&&"Polygon"===t.geometry.type){const{modeConfig:o}=e,{formatTooltip:n,measurementCallback:i}=o||{},r="sq. m",s=(0,ke.A)(t),a=(0,Xe.A)(t);let l;return l=n?n(a):parseFloat(a).toFixed(2)+" "+r,i&&i(a),[{position:s.geometry.coordinates,text:l}]}return Yt}}const eo=[];class to extends me{constructor(){super(...arguments),this._getTooltips=Ge((e=>{let{modeConfig:t,vertex:o,point1:n,point2:i}=e,r=eo;if(o&&n&&i){const{formatTooltip:e,measurementCallback:s}=t||{},a="deg",l=(0,g.A)(o,n),d=(0,g.A)(o,i);let c,p=Math.abs(l-d);p>180&&(p=360-p),c=e?e(p):parseFloat(p).toFixed(2)+" "+a,s&&s(p);r=[{position:(0,Ce.A)({type:"FeatureCollection",features:[n,i].map((e=>({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{}})))}).geometry.coordinates,text:c}]}return r}))}handleClick(e,t){this.getClickSequence().length>=3&&this.resetClickSequence(),this.addClickSequence(e)}handlePointerMove(e,t){t.onUpdateCursor("cell")}getPoints(e){const t=this.getClickSequence(),o=[...t];return t.length<3&&e.lastPointerMoveEvent&&o.push(e.lastPointerMoveEvent.mapCoords),o}getGuides(e){const t={type:"FeatureCollection",features:[]},{features:o}=t,n=this.getPoints(e);return n.length>2?o.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[1],n[0],n[2]]}}):n.length>1&&o.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[n[1],n[0]]}}),t}getTooltips(e){const t=this.getPoints(e);return this._getTooltips({modeConfig:e.modeConfig,vertex:t[0],point1:t[1],point2:t[2]})}}},676:(e,t,o)=>{o.d(t,{Ys:()=>O,ww:()=>V,xv:()=>T});var n=o(6540),i=o(3724);const r=e=>"@media screen and (max-width: 480px)",s=i.Ay.div.withConfig({displayName:"styled__PanelContainer",componentId:"sc-oqnqzc-0"})(["font-size:14px;position:absolute;top:0;right:0;width:344px;background:var(--ifm-background-surface-color);box-shadow:var(--ifm-global-shadow-lw);margin:24px;padding:10px 24px;max-height:96%;overflow-x:hidden;overflow-y:auto;overflow-y:overlay;outline:none;z-index:1;","{width:auto;left:0;}"],r),a=i.Ay.div.withConfig({displayName:"styled__PanelExpander",componentId:"sc-oqnqzc-1"})(["display:none;width:16px;height:16px;font-family:serif;font-size:0.8em;text-align:center;line-height:16px;border-radius:50%;background:",";color:",";","{display:block;}"],(e=>e.$expanded?"none":"var(--ifm-color-gray-900)"),(e=>e.$expanded?"var(--ifm-color-black)":"var(--ifm-color-white)"),r),l=i.Ay.div.withConfig({displayName:"styled__PanelTitle",componentId:"sc-oqnqzc-2"})(["display:flex;align-items:center;justify-content:space-between;font:bold 1.25em var(--ifm-font-family-base);margin:8px 0;","{cursor:pointer;}"],r),d=i.Ay.div.withConfig({displayName:"styled__PanelContent",componentId:"sc-oqnqzc-3"})(["div > *{vertical-align:middle;white-space:nowrap;}div > label{display:inline-block;width:40%;margin-right:10%;color:var(--ifm-color-content-secondary);margin-top:2px;margin-bottom:2px;}div > input,div > a,div > button,div > select{font:normal 11px/16px var(--ifm-font-family-base);line-height:20px;text-transform:none;text-overflow:ellipsis;overflow:hidden;display:inline-block;padding:0 4px;width:50%;height:20px;text-align:left;}div > button{color:initial;}div > button:disabled{color:var(--ifm-color-gray-300);cursor:default;background:var(--ifm-color-gray-300);}div > input{border:solid 1px var(--ifm-color-gray-300);&:disabled{background:var(--ifm-color-white);}&[type='checkbox']{height:auto;}}p{margin-bottom:12px;white-space:initial;}","{display:",";}"],r,(e=>e.$expanded?"block":"none")),c=i.Ay.a.withConfig({displayName:"styled__SourceLink",componentId:"sc-oqnqzc-4"})(["display:block;text-align:right;margin-top:8px;font:bold 12px/20px var(--ifm-font-family-base);color:var(--ifm-color-content-secondary);","{display:",";}"],r,(e=>e.$expanded?"block":"none"));var p=o(4848);const g=i.Ay.div.withConfig({displayName:"input__InputContainer",componentId:"sc-1myx0c6-0"})(["position:relative;width:100%;&:last-child{margin-bottom:20px;}> *{vertical-align:middle;white-space:nowrap;}label{display:inline-block;width:40%;margin-right:10%;margin-top:2px;margin-bottom:2px;}input,a,button{background:var(--ifm-background-surface-color);font-size:0.9em;text-transform:none;text-overflow:ellipsis;overflow:hidden;display:inline-block;padding:0 4px;margin:0;width:50%;height:20px;line-height:1.833;text-align:left;}button{color:initial;}button:disabled{color:var(--ifm-color-gray-500);cursor:default;background:var(--ifm-color-gray-300);}input{border:solid 1px var(--ifm-color-gray-500);&:disabled{background:var(--ifm-color-gray-300);}&[type='checkbox']{height:auto;}}.tooltip{left:50%;top:24px;opacity:0;pointer-events:none;transition:opacity 200ms;}&:hover .tooltip{opacity:1;}"]);function u(e){let{name:t,min:o,max:i,step:r,displayName:s,displayValue:a,onChange:l}=e;const d=(0,n.useCallback)((e=>{const{value:n}=e.target;let r=Number(n);void 0!==o&&(r=Math.max(o,r)),void 0!==i&&(r=Math.min(i,r)),l(t,r)}),[o,i,l]);return(0,p.jsxs)(g,{children:[(0,p.jsx)("label",{children:s}),(0,p.jsxs)("div",{className:"tooltip",children:[s,": ",String(a)]}),(0,p.jsx)("input",{type:"range",min:o,max:i,value:a,step:r,onChange:d})]})}function h(e){let{name:t,value:o,displayName:i,displayValue:r,onChange:s}=e;const a=(0,n.useCallback)((e=>{const o=e.target.checked;s(t,o)}),[s]);return(0,p.jsxs)(g,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsxs)("div",{className:"tooltip",children:[i,": ",String(r)]}),(0,p.jsx)("input",{type:"checkbox",checked:o,onChange:a})]})}function m(e){const{name:t,onChange:o,displayName:i,altValue:r,displayValue:s,...a}=e,l=(0,n.useCallback)((e=>{o(t,e.target.value)}),[o]),d=(0,n.useCallback)((()=>{o(t,r)}),[r,o]),c=a;switch(e.type){case"link":return(0,p.jsxs)(g,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsx)("a",{href:s,target:"_new",children:s})]});case"function":case"json":const t=Boolean(r);return(0,p.jsxs)(g,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsx)("button",{type:"text",disabled:!t,onClick:d,children:s})]});case"select":return(0,p.jsxs)(g,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsx)("select",{onChange:l,value:s,children:e.options.map(((e,t)=>(0,p.jsx)("option",{value:e,children:e},t)))})]});case"checkbox":return(0,p.jsx)(h,{...e});case"range":return(0,p.jsx)(u,{...e});default:return(0,p.jsxs)(g,{children:[(0,p.jsx)("label",{children:i}),(0,p.jsxs)("div",{className:"tooltip",children:[i,": ",String(s)]}),(0,p.jsx)("input",{...c,value:s,onChange:l})]})}}const f=i.Ay.div.withConfig({displayName:"spinner__SpinnerContainer",componentId:"sc-ok6n2c-0"})(["height:18px;line-height:18px;font-size:10px;> div{white-space:nowrap;left:0;bottom:0;position:absolute;height:18px;padding-left:20px;transition:width 0.5s;}.spinner--fill{background:$primary;color:$white;overflow:hidden;}.spinner--text{color:$black-40;}&.done{height:0 !important;line-height:0;font-size:0;transition:height 0.5s 1s;> div{height:0 !important;transition:height 0.5s 1s;}}"]);function y(e){let{meta:t}=e;if(!Number.isFinite(t.progress)&&!Number.isFinite(t.progressAlt))return null;const o=(t.progress||0)+(t.progressAlt||0),n=Math.round(1e3*o)/10,i="Loading... "+n+"%";return(0,p.jsxs)(f,{className:o>=1?"done":"",children:[(0,p.jsx)("div",{className:"spinner--text",children:i}),(0,p.jsx)("div",{className:"spinner--fill",style:{width:n+"%"},children:i})]})}const x=i.Ay.div.withConfig({displayName:"info-panel__InfoPanelContent",componentId:"sc-1qy2onu-0"})(["hr{margin:12px -24px;}a{text-decoration:none;display:inline;color:var(--ifm-color-primary);}p{margin-bottom:16px;}.legend{display:inline-block;width:12px;height:12px;}.stat{text-transform:uppercase;font-size:0.833em;b{display:block;font-size:3em;font-weight:bold;line-height:1.833;}}hr{border:none;background:var(--ifm-color-gray-400);height:1px;}.layout{display:table;width:100%;> *{display:table-cell !important;}.col-1-3{width:33.33%;}.col-1-2{width:50%;}.text-right{text-align:right;}.text-center{text-align:center;}}"]);function C(e){let{title:t,children:o,sourceLink:i}=e;const[r,g]=(0,n.useState)(!1);return(0,p.jsxs)(s,{children:[(0,p.jsxs)(l,{onClick:()=>g(!r),children:[(0,p.jsx)("div",{children:t}),(0,p.jsx)(a,{$expanded:r,children:r?"\u2715":"i"})]}),(0,p.jsx)(d,{$expanded:r,children:o}),(0,p.jsx)(c,{$expanded:r,href:i,target:"_new",children:"View Code \u2197"})]})}function v(e){let{title:t,sourceLink:o,params:n,meta:i,children:r,updateParam:s}=e;return(0,p.jsxs)(C,{title:t,sourceLink:o,children:[(0,p.jsxs)(x,{children:[r,Object.keys(n).length>0&&(0,p.jsx)("hr",{}),Object.keys(n).sort().map(((e,t)=>(0,p.jsx)(m,{name:e,...n[e],onChange:s},t+"-"+e)))]}),(0,p.jsx)(y,{meta:i})]})}var b=o(4684);const S={};function P(e,t){let o=0;S[e]&&S[e].terminate();const n=new Worker(e);S[e]=n;let i=[];n.onmessage=e=>{const{action:o,data:r,meta:s}=e.data;"end"===o?n.terminate():"add"===o&&r&&r.length&&(i=i.concat(r),t(i,s))},this.onProgress=e=>{const{responseText:t}=e.target,i=t.lastIndexOf("\n")+1;n.postMessage({event:"progress",text:t.slice(o,i)}),o=i},this.onLoad=e=>{const{responseText:t}=e;n.postMessage({event:"load",text:t.slice(o)})}}function w(e,t,o){if(t){const n=(0,b.Em)(e),i=new P(t,((e,t)=>{o(e,t)}));n.on("progress",i.onProgress).on("load",i.onLoad).get()}else/\.(json|geojson)$/.test(e)?(0,b.Pq)(e,((e,t)=>{e||o(t,{})})):(0,b.Qq)(e,((e,t)=>{e||o(t,{})}))}function k(e,t){return t.match(/^\w+:\/\//)?t:e.replace(/\/$/,"")+"/"+t.replace(/^\//,"")}var A=o(6420);const _=e=>{if("function"===e.type){let t=String(e.value);if(Array.isArray(e.value)&&(t="["+t+"]"),"function"==typeof e.value)return t=t.replace(/^function (\w+)?\((\w*?)\)/,"$2 =>"),t=t.replace(/^function (\w+)?(\(.*?\))/,"$2 =>"),t=t.replace(/\{\s*return\s*(.*?);?\s*\}$/,"$1"),{...e,displayValue:t};if(!e.altType)return{...e,displayValue:t};e.type=e.altType}if("json"===e.type)return{...e,displayValue:JSON.stringify(e.value)};if("color"===e.type){const o=function(e){if(!e)return[255,255,255,0];if(Array.isArray(e))return e.slice(0,4);const t=(0,A.Qh)(e);return[t.r,t.g,t.b,255]}(e.value);return{...e,value:o,displayValue:(t=o,t.slice(0,3).reduce(((e,t)=>e+(t<16?"0":"")+t.toString(16)),"#"))}}var t;return{...e,displayValue:String(e.value)}};var I=o(1175),j=o(6025);const M=i.Ay.div.withConfig({displayName:"make-example__DemoContainer",componentId:"sc-is6oih-0"})([".tooltip,.deck-tooltip{position:absolute;padding:4px 12px;background:rgba(0,0,0,0.8);color:var(--ifm-color-white);max-width:300px;font-size:12px;z-index:9;pointer-events:none;white-space:nowrap;}"]),E=i.Ay.div.withConfig({displayName:"make-example__MapTip",componentId:"sc-is6oih-1"})(["position:absolute;right:12px;bottom:20px;color:var(--ifm-color-white);mix-blend-mode:difference;font-size:14px;@media screen and (max-width:480px){display:none;}"]);function T(e,t){let{isInteractive:o=!0,style:i}=void 0===t?{}:t;const{parameters:r={},mapStyle:s}=e,a=Object.keys(r).reduce(((e,t)=>(e[t]=_(r[t]),e)),{}),l=Array.isArray(e.data)?e.data.map((e=>null)):null;return function(){const[t,r]=(0,n.useState)(l),[d,c]=(0,n.useState)(a),[g,u]=(0,n.useState)({}),h=(0,j.A)("/"),m=(0,n.useCallback)((e=>{const t=Object.keys(e).reduce(((t,o)=>(t[o]=_(e[o]),t)),{});c((e=>({...e,...t})))}),[]),f=(0,n.useCallback)((e=>{u((t=>({...t,...e})))}),[]);(0,n.useEffect)((()=>{let t=e.data;if(!t)return;const o=Array.isArray(t);o||(t=[t]);for(let e=0;e<t.length;e++){const{url:n,worker:i}=t[e];w(k(h,n),i&&k(h,i),((t,n)=>{r(o?o=>{const n=o.slice();return n[e]=t,n}:t),n&&u((e=>({...e,...n})))}))}}),[]);return(0,p.jsxs)(M,{style:i,children:[(0,p.jsx)(e,{data:t,mapStyle:s||I.Vi.BLANK,params:d,useParam:m,onStateChange:f}),o&&(0,p.jsx)(v,{title:e.title,params:d,meta:g,updateParam:(e,t)=>{const o=d[e];o&&c({...d,[e]:_({...o,value:t})})},sourceLink:e.code,children:e.renderInfo(g)}),o&&s&&(0,p.jsx)(E,{children:"Hold down shift to rotate"})]})}}var F=o(6588);const D=i.Ay.div.withConfig({displayName:"styled__ExampleHeader",componentId:"sc-1dgi8sb-0"})(["font:bold 20px/28px var(--ifm-font-family-base);color:var(--ifm-color-content-secondary);margin:0 20px;border-bottom:1px solid 20px;display:inline-block;padding:20px 20px 4px 0;"]),L=i.Ay.main.withConfig({displayName:"styled__MainExamples",componentId:"sc-1dgi8sb-1"})(["padding:16px 0;"]),H=i.Ay.main.withConfig({displayName:"styled__ExamplesGroup",componentId:"sc-1dgi8sb-2"})(["display:flex;flex-wrap:wrap;padding:16px;"]),R=i.Ay.a.withConfig({displayName:"styled__ExampleCard",componentId:"sc-1dgi8sb-3"})(["cursor:pointer;text-decoration:none;width:50%;max-width:240px;line-height:0;outline:none;padding:4px;position:relative;img{transition-property:filter;transition-duration:var(--ifm-transition-slow);transition-timing-function:var(--ifm-transition-timing-default);}&:hover{box-shadow:var(--ifm-global-shadow-md);}&:hover img{filter:contrast(0.2);}","{width:33%;min-width:200px;}@media screen and (max-width:632px){width:50%;}"],r),z=i.Ay.div.withConfig({displayName:"styled__ExampleTitle",componentId:"sc-1dgi8sb-4"})(["position:absolute;display:flex;justify-content:center;flex-direction:column;color:var(--ifm-color-white);font-size:1.5em;text-align:center;line-height:initial;width:90%;height:90%;top:5%;left:5%;border:solid 1px var(--ifm-color-white);opacity:0;transition-property:opacity;transition-duration:var(--ifm-transition-slow);transition-timing-function:var(--ifm-transition-timing-default);&:hover{opacity:1;}"]);function N(e,t){let{label:o,items:n}=e;return[(0,p.jsx)(D,{children:o},o+"-header"),(0,p.jsx)(H,{children:n.map((e=>function(e,t){const o=(0,j.A)(t(e)),{label:n,href:i}=e;return(0,p.jsxs)(R,{href:i,children:[(0,p.jsx)("img",{width:"100%",src:o,alt:n}),(0,p.jsx)(z,{children:(0,p.jsx)("span",{children:n})})]},n)}(e,t)))},o)]}function O(e){let{getThumbnail:t}=e;const o=(0,F.t)();return(0,p.jsx)(L,{children:o.items.map((e=>"category"===e.type?N(e,t):null))})}var G=o(4586);const q=i.Ay.section.withConfig({displayName:"styled__Banner",componentId:"sc-exnbu5-0"})(["position:relative;height:30rem;background:var(--ifm-color-gray-400);color:var(--ifm-color-gray-900);z-index:0;","{height:80vh;}"],r),U=i.Ay.div.withConfig({displayName:"styled__Container",componentId:"sc-exnbu5-1"})(["position:relative;padding:2rem;max-width:80rem;width:100%;height:100%;margin:0;"]),W=(0,i.Ay)(U).withConfig({displayName:"styled__BannerContainer",componentId:"sc-exnbu5-2"})(["position:absolute;bottom:0;height:auto;padding-left:4rem;z-index:0;pointer-events:none;"]),B=i.Ay.div.withConfig({displayName:"styled__HeroExampleContainer",componentId:"sc-exnbu5-3"})(["position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;"]),J=(i.Ay.section.withConfig({displayName:"styled__Section",componentId:"sc-exnbu5-4"})(["&:nth-child(2n + 1){background:var(--ifm-color-gray-300);}"]),i.Ay.h1.withConfig({displayName:"styled__ProjectName",componentId:"sc-exnbu5-5"})(["font-size:5em;line-height:1;text-transform:uppercase;letter-spacing:4px;font-weight:700;margin:0;margin-bottom:16px;"])),K=i.Ay.a.withConfig({displayName:"styled__GetStartedLink",componentId:"sc-exnbu5-6"})(["pointer-events:all;font-size:12px;line-height:44px;letter-spacing:2px;font-weight:bold;margin:24px 0;padding:0 4rem;pointer-events:all;display:inline-block;text-decoration:none;transition:background-color 250ms ease-in,color 250ms ease-in;border:solid 2px var(--ifm-color-primary);color:var(--ifm-color-gray-900);border-image:linear-gradient( to right,var(--ifm-color-gray-700) 0%,var(--ifm-color-gray-400) 100% );border-image-slice:2;&:visited{color:var(--ifm-color-gray-900);}&:active{color:var(--ifm-color-white);}&:hover{color:var(--ifm-color-white);background-color:var(--ifm-color-primary);}"]);function V(e){let{HeroExample:t,children:o}=e;const{siteConfig:n}=(0,G.A)();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(q,{children:[(0,p.jsx)(B,{children:t&&(0,p.jsx)(t,{})}),(0,p.jsxs)(W,{children:[(0,p.jsx)(J,{children:n.title}),(0,p.jsx)("p",{children:n.tagline}),(0,p.jsx)(K,{href:"./docs",children:"GET STARTED"})]})]}),o]})}},1175:(e,t,o)=>{o.d(t,{Vi:()=>n,lP:()=>i});const n={LIGHT:"https://deck.gl/mapstyle/deck-light.json",LIGHT_LABEL:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",DARK:"https://deck.gl/mapstyle/deck-dark.json",BLANK:{version:8,sources:{},layers:[]}},i="https://github.com/visgl/deck.gl-community/tree/master"}}]);